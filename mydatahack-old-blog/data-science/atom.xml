<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science</id>
    <title>MyDatahack Blog</title>
    <updated>2018-05-07T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://takahirohonda.github.io/mydatahack-old-blog/data-science"/>
    <subtitle>MyDatahack Blog</subtitle>
    <icon>https://takahirohonda.github.io/mydatahack-old-blog/img/icon-circle.png</icon>
    <entry>
        <title type="html"><![CDATA[Building AlexNet with Keras]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/deep-learning/building-alexnet-with-keras</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/deep-learning/building-alexnet-with-keras"/>
        <updated>2018-05-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[As the legend goes, the deep learning networks created by Alex Krizhevsky, Geoffrey Hinton and Ilya Sutskever (now largely know as AlexNet) blew everyone out of the water and won Image Classification Challenge (ILSVRC) in 2012. This heralded the new era of deep learning. AlexNet is the most influential modern deep learning networks in machine vision that use multiple convolutional and dense layers and distributed computing with GPU.]]></summary>
        <content type="html"><![CDATA[<p>As the legend goes, the deep learning networks created by Alex Krizhevsky, Geoffrey Hinton and Ilya Sutskever (now largely know as AlexNet) blew everyone out of the water and won Image Classification Challenge (ILSVRC) in 2012. This heralded the new era of deep learning. AlexNet is the most influential modern deep learning networks in machine vision that use multiple convolutional and dense layers and distributed computing with GPU.</p>
<p>Along with LeNet-5, AlexNet is one of the most important &amp; influential neural network architectures that demonstrate the power of convolutional layers in machine vision. So, let’s build AlexNet with Keras first, them move onto building it in .</p>
<p>Dataset</p>
<p>We are using OxfordFlower17 in the tflearn package. The dataset consists of 17 categories of flowers with 80 images for each class. It is a three dimensional data with RGB colour values per each pixel along with the width and height pixels.</p>
<p>AlexNet Architecture</p>
<p>AlexNet consist of 5 convolutional layers and 3 dense layers. The data gets split into to 2 GPU cores. The image below is from the first reference the AlexNet Wikipedia page here.</p>
<p><img decoding="async" loading="lazy" alt="AlexNet Architecture" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/alexnet-architecture-be16abb393baa6c357e3d698298e3d99.png" width="932" height="448" class="img_ev3q"></p>
<p>AlexNet with Keras</p>
<p>I made a few changes in order to simplify a few things and further optimise the training outcome. First of all, I am using the sequential model and eliminating the parallelism for simplification. For example, the first convolutional layer has 2 layers with 48 neurons each. Instead, I am combining it to 98 neurons.</p>
<p>The original architecture did not have batch normalisation after every layer (although it had normalisation between a few layers) and dropouts. I am putting the batch normalisation before the input after every layer and dropouts between the fully-connected layers to reduce over-fitting.</p>
<p>When to use batch normalisation is difficult. Everyone seems to have opinions or evidence that supports their opinions. Without going into too much details, I decided to normalise before the input as it seems to make sense statistically.</p>
<p><strong>Code</strong></p>
<p>Here is the code example. The input data is 3-dimensional and then you need to flatten the data before passing it into the dense layer. Using cross-entropy for the loss function, adam for optimiser and accuracy for performance metrics.</p>
<p>As the network is complex, it takes a long time to run. It took about 10 hours to run 250 epochs on my cheap laptop with CPU. The test dataset accuracy is not great. This is probably because we do not have enough datasets. I don’t think 80 images each is enough for convolutional neural networks. But, it still runs.</p>
<p>It’s pretty amazing that what was the-state-of-the-art in 2012 can be done with a very little programming and run on your $700 laptops!</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># (1) Importing dependency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> keras</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Sequential</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Dense</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Activation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Dropout</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Flatten</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> Conv2D</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MaxPooling2D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normalization </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> BatchNormalization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (2) Get Data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">oxflower17 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> oxflower17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> oxflower17</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">one_hot</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (3) Create a sequential model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Sequential</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1st Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filters</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">96</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input_shape</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">224</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">224</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'valid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Pooling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MaxPooling2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pool_size</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'valid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation before passing it to the next layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BatchNormalization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2nd Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filters</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'valid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Pooling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MaxPooling2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pool_size</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'valid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BatchNormalization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3rd Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filters</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">384</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'valid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BatchNormalization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 4th Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filters</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">384</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'valid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BatchNormalization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 5th Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">filters</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'valid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Pooling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MaxPooling2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pool_size</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'valid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BatchNormalization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Passing it to a dense layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Flatten</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1st Dense Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input_shape</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">224</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">224</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Add Dropout to prevent overfitting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dropout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BatchNormalization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2nd Dense Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Add Dropout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dropout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BatchNormalization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3rd Dense Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'relu'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Add Dropout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dropout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">BatchNormalization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Output Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">17</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'softmax'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">summary</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (4) Compile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loss</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'categorical_crossentropy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> optimizer</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'adam'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> metrics</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'accuracy'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (5) Train</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">64</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> epochs</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verbose</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validation_split</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shuffle</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Deep Learning" term="Deep Learning"/>
        <category label="AlexNet" term="AlexNet"/>
        <category label="Convolutional Neural Networks" term="Convolutional Neural Networks"/>
        <category label="Image Classification" term="Image Classification"/>
        <category label="Keras" term="Keras"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building AlexNet with TensorFlow and Running it with AWS SageMaker]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/deep-learning/building-alexnet-with-tensorflow-and-running-it-with-aws-sagemaker</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/deep-learning/building-alexnet-with-tensorflow-and-running-it-with-aws-sagemaker"/>
        <updated>2018-05-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In the last post, we built AlexNet with Keras. This is the second part of AlexNet building. Let’s rewrite the Keras code from the previous post (see Building AlexNet with Keras) with TensorFlow and run it in AWS SageMaker instead of the local machine.]]></summary>
        <content type="html"><![CDATA[<p>In the last post, we built AlexNet with Keras. This is the second part of AlexNet building. Let’s rewrite the Keras code from the previous post (see Building AlexNet with Keras) with TensorFlow and run it in AWS SageMaker instead of the local machine.</p>
<p>AlexNet is in fact too heavy for a regular commercial laptop to handle it. It only runs on a small dataset and takes for ages. By using the cloud service like AWS, we can access to much better computers without any hardware investment. AWS already has a series of deep learning specialised instances (P2 Instances). The smallest with one GPU (p2.xlarge) costs 90 cent per hour. It is much faster than CPU machines. You can experiment on computing capacities as you will be charged only by usage hours. If you are thinking about buying a more expensive GPU laptop for deep learning, the cloud services would be a better option.</p>
<p>AWS recently released SageMaker, which enables you to develop and deploy deep learning code with no hustle. To run Tensorflow code in SageMaker, all you need is to create a notebook instance (check out the getting started video here).</p>
<p><strong>Importing OxfordFlower17 Data</strong></p>
<p>You can creates a notebook instance with a chosen EC2 instance with SageMaker. Once the instance is created, you can access to the instance through Jupyter notebook for development and deployment. Many deep learning frameworks are already installed. Once you train the model, you can deploy it into the AWS environment without much hustle. The caveat is that you won’t be able to install or update the preinstalled packages as you do not have access to the underlining instance. If you need to have special environmental requirements, you need to bring it in with a Docker container.</p>
<p>In fact, SageMaker does not have tflearn installed. As in the previous post, we are importing 17 category flower dataset (OxfordFlower17) from tflearn. If you try to import it in SageMaker, it will give you the module not found error.</p>
<p>The strategy I took here is to upload the dataset as numpy array files to S3 and retrieve them in SageMaker.</p>
<p>(1) Create the numpy files and Upload to S3</p>
<p>I first created npy files and uploaded to S3 bucket where SageMaker has the access policy.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># (1) Get dataset from s3 bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">oxflower17 </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> oxflower17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> oxflower17</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">one_hot</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (2) save data as .npy files</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'/tmp/oxford_flower_17_x.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_path</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'/tmp/oxford_flower_17_y.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (3) push file to s3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> boto3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> botocore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> boto3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'s3'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_bucket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'sagemaker.mydh'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'data/oxford_flower_17_x.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'data/oxford_flower_17_y.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Uploading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upload_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Filename</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">x_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Bucket</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target_bucket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">x_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Completed Uploading {} to {}/{}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target_bucket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upload_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Filename</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">y_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Bucket</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target_bucket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">y_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Completed Uploading {} to {}/{}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target_bucket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(2) Import numpy files into the SageMaker instance.</p>
<p>You can get the file from S3 into the Notebook instance and simply load them as numpy objects.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> boto3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> botocore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">download_file_with_resource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> local_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> boto3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">resource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'s3'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Bucket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">download_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> local_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Downloaded {}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bucket_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'sagemaker.mydh'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_key</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'data/oxford_flower_17_x.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_key</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'data/oxford_flower_17_y.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_local_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./data/oxford_flower_17_x.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_local_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./data/oxford_flower_17_y.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># download_file_with_resource(bucket_name, 'data/check.csv', './data/check.csv')</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">download_file_with_resource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_local_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">download_file_with_resource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_local_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (3) Load data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_local_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./data/oxford_flower_17_x.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_local_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./data/oxford_flower_17_y.npy'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_local_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_local_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Shape of features: '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Type: '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Shape of classes: '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Type: '</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">type</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Code</p>
<p>Strictly speaking, it is slightly different from the original AlexNet. The code is sequential and has no parallel computing components for simplicity. I am doing batch normalisation before every input and doing dropouts in the Dense layer. The network architecture is the same as the previous post.</p>
<p>With TensorFlow, you really need to be careful about the dimensions. The original dataset is 3-dimentional. After the convolution layers, the dimension is compressed from pooling. So, you need to specify the right dimension (7 x 7 in this case). Otherwise, the code will not run.</p>
<p>In the model, I purposely included the weights and biases with hard-coded values so that it is easy to follow. Apart from the model, the same code used in building Dense Net for Iris works. If you need to understand other part of the codes you should read the previous post (Introduction to Dense Net with TensorFlow).</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tensorflow </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_random_seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (1) Create Training (80%), test (20%) and validation (20%) dataset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#     Datasets (x and y) are loaded as numpy object from the previous step</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_test_pre</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test_pre </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_validation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_validation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_test_pre</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test_pre</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Check Shapes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Shape: x_train={}, y_train={}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Shape: x_test={}, y_test={}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Shape: x_validation={}, y_validation={}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_validation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_validation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (2) Define the placeholder tensors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">placeholder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">224</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">224</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">placeholder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># no of flower speces in the dataset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (3) Define Layers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Convolutional Layer with Relu activation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> W</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xW </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">conv2d</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> W</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'SAME'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bias_add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xW</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">relu</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Max Pooling Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">maxPooling2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">max_pool</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ksize</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         strides</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">padding</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'SAME'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Dense Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> W</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matmul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> W</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">relu</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (4) Define AlexNet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Setting some parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w_init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xavier_initializer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">epochs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">progress </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n_classes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Function, x is the input features</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">alexNet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img_input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 1st Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_c1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_c1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">96</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_c1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">96</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">img_input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_c1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_c1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Pooling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> maxPooling2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bn1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">batch_norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 2nd Convolutional layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_c2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_c2'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">96</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_c2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bn1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_c2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_c2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Pooling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> maxPooling2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bn2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">batch_norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 3rd Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_c3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_c3'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">384</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_c3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">384</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bn2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_c3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_c3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bn3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">batch_norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 4th Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_c4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_c4'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">384</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">384</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_c4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">384</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bn3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_c4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_c4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bn4 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">batch_norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 5th Convolutional Layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_c5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_c5'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">384</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_c5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conv2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bn4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_c5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_c5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Pooling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> maxPooling2D</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kernel_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> stride_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Batch Normalisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bn5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">batch_norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Flatten the conv layer - features has been reduced by pooling 3 times: 224/2*2*2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flattened </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reshape</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bn5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">28</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">28</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 1st Dense layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_d1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_d1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">28</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">28</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">256</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_d1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    d1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">flattened</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_d1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_d1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Dropout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dropout_d1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dropout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 2nd Dense layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_d2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_d2'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_d2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    d2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dropout_d1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_d2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_d2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Dropout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dropout_d2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dropout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 3rd Dense layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_d3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_d3'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_d3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    d3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dropout_d2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_d3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_d3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Dropout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dropout_d3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dropout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">d3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Output layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    w_out </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_out'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_classes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">w_init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    b_out </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n_classes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    out </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matmul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dropout_d3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w_out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (5) Build model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predictions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> alexNet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (6) Define model's cost and optimizer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reduce_mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">softmax_cross_entropy_with_logits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logits</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labels</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optimizer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AdamOptimizer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">minimize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (7) Defining evaluation metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">correct_prediction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">equal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accuracy_pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reduce_mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">correct_prediction</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (8) initialize</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">initializer_op </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">global_variables_initializer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (9) Run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initializer_op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Training for"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> epochs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"epochs."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># looping over epochs:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> epoch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epochs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># To monitor performance during training</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avg_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avg_acc_pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># loop over all batches of the epoch- 1088 records</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># batch_size = 128 is already defined</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        n_batches </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1088</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> batch_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        counter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n_batches</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Get the random int for batch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            random_indices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1088</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 1088 is the no of training set records</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            feed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">random_indices</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">random_indices</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># feed batch data to run optimization and fetching cost and accuracy:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_cost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">optimizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> accuracy_pct</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   feed_dict</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">feed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Print batch cost to see the code is working (optional)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># print('Batch no. {}: batch_cost: {}, batch_acc: {}'.format(counter, batch_cost, batch_acc))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Get the average cost and accuracy for all batches:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            avg_cost </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> batch_cost </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> n_batches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            avg_acc_pct </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> batch_acc </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> n_batches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            counter </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Get cost and accuracy after one iteration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        test_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        test_acc_pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_pct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># output logs at end of each epoch of training:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Epoch {}: Training Cost = {:.3f}, Training Acc = {:.2f} -- Test Cost = {:.3f}, Test Acc = {:.2f}"</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoch </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avg_cost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> avg_acc_pct</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_cost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_acc_pct</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Getting Final Test Evaluation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'\n'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Training Completed. Final Evaluation on Test Data Set.\n"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_accy_pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_pct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Test Cost:"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{:.3f}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Test Accuracy: "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{:.2f}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_accy_pct</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'\n'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Getting accuracy on Validation set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x_validation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_validation</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val_acc_pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_pct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> x_validation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_validation</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Evaluation on Validation Data Set.\n"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Evaluation Cost:"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{:.3f}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val_cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Evaluation Accuracy: "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{:.2f}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val_acc_pct</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Deep Learning" term="Deep Learning"/>
        <category label="AlexNet" term="AlexNet"/>
        <category label="Convolutional Neural Networks" term="Convolutional Neural Networks"/>
        <category label="Image Classification" term="Image Classification"/>
        <category label="SageMaker" term="SageMaker"/>
        <category label="TensorFlow" term="TensorFlow"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Introduction to Dense Layers for Deep Learning with Keras]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/deep-learning/introduction-to-dense-net-with-keras/</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/deep-learning/introduction-to-dense-net-with-keras/"/>
        <updated>2018-05-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[The most basic neural network architecture in deep learning is the dense neural networks consisting of dense layers (a.k.a. fully-connected layers).]]></summary>
        <content type="html"><![CDATA[<p>The most basic neural network architecture in deep learning is the dense neural networks consisting of dense layers (a.k.a. fully-connected layers).</p>
<p>In this layer, all the inputs and outputs are connected to all the neurons in each layer. Keras is the high-level APIs that runs on TensorFlow (and CNTK or Theano) which makes coding easier. Writing code in the low-level TensorFlow APIs is difficult and time-consuming. When I build a deep learning model, I always start with Keras so that I can quickly experiment with different architectures and parameters. Then, move onto TensorFlow to further fine tune it. When it comes to the first deep learning code, I think Dense Net with Keras is a good place to start. So, let’ get started.</p>
<p>Dataset</p>
<p>Deep learning 101 dataset is the classic MNIST, which is used for hand-written digit recognition. With the code below, you can certainly use MNIST.</p>
<p>In this example, I am using the machine learning classic Iris dataset. The dataset will be imported from a csv file. This gives you an idea on how to import csv into the deep learning model, rather than porting example data from the build-in package.</p>
<p>Deep learning on Iris certainly feels like cracking a nut with a sledge hammer. However, you can apply the knowledge and the same code to more appropriate datasets once you understand how it works.</p>
<p>There are many ways to get a csv version of Iris. I got it from R.</p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">path = '/tmp/iris.csv'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data(iris)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write.csv(iris, path,row.names=FALSE)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Steps</p>
<p>(1) Import required modules</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">21</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> keras</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Sequential</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Dense</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Activation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Dropout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> keras </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> regularizers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optimizers </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SGD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(2) Preprocessing</p>
<p>Both Keras and TensorFlow takes numpy arrays as features and classes. When the prediction is categorical, the outcome needs to be one-hot encoded (see one-hot encoding explanation from the Kaggle’s website). For one-hot encoding, the class needs to be indexes (starting from 0). Once they are transformed, you can use keras.utils.to_categorical() for conversion.</p>
<p>It uses sklearn.model_selection.train_test_split to create training and test dataset.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iris </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/tmp/iris.csv'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Species</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Species'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Species'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">'setosa'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Species'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">'versicolor'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Species'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">'virginica'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Species</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># convert df to features and targets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feature_cols </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Sepal.Length'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Sepal.Width'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Petal.Length'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Petal.Width'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">feature_cols</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> iris</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Species</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Normalise features</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">features_norm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">features</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Checking normalised features: \n{}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">features_norm</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Train Test Split</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">features_norm</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Convert y into one hot encoded variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n_classes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_train_e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_classes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_test_e </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_classes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train_e</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(3) Design Networks</p>
<p>I am using the sequential model with 2 fully-connected layers. ReLU is more popular in many deep neural networks, but I am using Tanh for activation because it actually performed better. You almost never use Sigmoid because it is slow to train. Softmax is used for the output layer.</p>
<p>Adding the 3rd layer degrades the performance. This makes sense as the data set is fairly simple. I am using Dropout to reduce over-fitting. L2 regularizer can be used. But, it did not perform well in this case and I commented out the line.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Sequential</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># for l2 regularizer. this doesn't perform as good as dropouts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># model.add(Dense(32, activation='relu', input_dim=4, kernel_regularizer=regularizers.l2(0.01)))</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># tanh is better than relu in this case</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> activation</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'tanh'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input_shape</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dropout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> activation</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'tanh'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dropout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> activation</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'softmax'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(4) Model Compilation</p>
<p>You need to define the loss function, optimizer and evaluation metrics. Cross-entropy is the gold standard for the cost function. You will almost never use quadratic. On the other hand, there are many options for optimisers. In this example, I have Adam as well as SGD with learning rate of 0.01. Both works fine.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Compared to mean_squared_error, cross entropy does faster learning,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># model.compile(loss='mean_squared_error', optimizer=SGD(lr=0.01), metrics=['accuracy'])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># We can use SGD with a specific learning rate for optimizer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># model.compile(loss='categorical_crossentropy', optimizer=SGD(lr=0.01), metrics=['accuracy'])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">compile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loss</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'categorical_crossentropy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> optimizer</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'adam'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> metrics</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'accuracy'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(5) Execution</p>
<p>The testing accuracy goes up to 96.7% after 120 epochs. With this dataset, a regular machine learning algorithm like random forest or logistic regression can achieve the similar results. The first rule of deep learning is that if the simpler machine learning algorithm can achieve the same outcome, use machine learning and look for a more complicated problem. Here, the purpose is to learn the actual programming process so that you can apply it to more complex problems.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">epoch_n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train_e</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> epochs</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">epoch_n</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> verbose</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> validation_data</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test_e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next Step</p>
<p>(1) Try using MNIST dataset on this code.</p>
<p>MNIST is included in Keras and you can imported it as keras.datasets.mnist. It’s already split into training and test datasets. In preprocessing, you need to flatten the data (from 28 x 28 to 784) and convert y into one-hot encoded values. Here is the code to process the data.</p>
<p>(2) Replicate the same code with low-level TensorFlow code.</p>
<p>TenorFlow is much more complicated than Keras. The way to code is quite unique. It will be difficult at first, but it will be worthwhile.</p>
<p>For the actual code example, go to Introduction to Dense Net with TensorFlow.</p>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Deep Learning" term="Deep Learning"/>
        <category label="Dense Net" term="Dense Net"/>
        <category label="Iris" term="Iris"/>
        <category label="Keras" term="Keras"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Introduction to Dense Layers for Deep Learning with TensorFlow]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/deep-learning/introduction-to-dense-net-with-tensorflow</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/deep-learning/introduction-to-dense-net-with-tensorflow"/>
        <updated>2018-05-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[TensorFlow offers both high- and low-level APIs for Deep Learning. Coding in TensorFlow is slightly different from other machine learning frameworks.]]></summary>
        <content type="html"><![CDATA[<p>TensorFlow offers both high- and low-level APIs for Deep Learning. Coding in TensorFlow is slightly different from other machine learning frameworks.</p>
<p>You first need to define the variables and architectures. This is because the entire code is executed outside of Python with C++ and the python code itself is just a bunch of definitions.</p>
<p>The aim of this post is to replicate the previous Keras code into TensorFlow. Before writing code in TensorFlow, it is better to use high-level APIs like Keras to build the model (read Introduction to Dense Net with Keras for a preparation).</p>
<p>Steps</p>
<p>(1) Import Modules</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tensorflow </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> tf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_random_seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reset_default_graph</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> keras</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(2) Data Preparation</p>
<p>As in the previous post, we are importing the Iris dataset from a csv file. This step is the same as before.</p>
<p>You can also check the official TensorFlow documents about deep learning on Iris dataset here. The way the dataset is preprocessed is quite different from what I did and will be an interesting read.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iris </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'/tmp/iris.csv'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Species</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Species'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Species'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">'setosa'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Species'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">'versicolor'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Species'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">==</span><span class="token string" style="color:#e3116c">'virginica'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">iris</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Species</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># convert df to features and targets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feature_cols </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Sepal.Length'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Sepal.Width'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Petal.Length'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Petal.Width'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">features </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> iris</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">feature_cols</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> iris</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Species</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Train Test Split</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">features</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Convert y into one hot encoded variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n_classes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_classes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keras</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_categorical</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_classes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(3) Defining Variables and Models</p>
<p>Before running the code, we need to define variables and models. The model is the same as the one defined in the previous post with Keras.</p>
<p>Even for more complicated models (e.g. with added convolutional layers), you can use the same steps.</p>
<p>Set hyperparameters
Set layers
Define placeholders
Define layers
Define architecture
Define variable dictionary
Build Model
Define loss &amp; optimizer
Define evaluation metrics
Here is the code from the steps above.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># (1) Set hyperparameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">epochs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">weight_initializer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">contrib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">layers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xavier_initializer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (2) Set layers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n_dense </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n_classes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (3) Define placeholders</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">placeholder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_input</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">placeholder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_classes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (4) Define layers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matmul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">relu</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">z</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (5) Define architecture</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">network</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weights</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> biases</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dense1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dense</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weights</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'w1'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> biases</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    out_layer_z </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">matmul</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dense1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weights</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'w_out'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> biases</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'b_out'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> out_layer_z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (6) Define variable dictionary</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bias_dict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n_dense</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'b_out'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n_classes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">weight_dict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'w1'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w1'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n_input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_dense</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> weight_initializer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'w_out'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_variable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'w_out'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">n_dense</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_classes</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> initializer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> weight_initializer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (7) Build Model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">predictions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> network</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weights</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">weight_dict</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> biases</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bias_dict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (8) Define loss &amp; optimizer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reduce_mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">softmax_cross_entropy_with_logits</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">logits</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> labels</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optimizer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">train</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">GradientDescentOptimizer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">learning_rate</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">lr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">minimize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (9) Define evaluation metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">correct_prediction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">equal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">accuracy_pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">reduce_mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">correct_prediction</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">float32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(4) Initialise and Run</p>
<p>Once everything is set up, initialise variables and execute the code in session! After 1000 epochs, you will see the test accuracy of 96%.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># (10) Initialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">initializer_op </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">global_variables_initializer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (11) Train the network in a session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> tf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">initializer_op</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Training for"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> epochs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"epochs."</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Go through epochs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> epoch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epochs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># monitoring each epochs on training cost and accuracy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avg_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        avg_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># loop over all batches of the epoch:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        n_batches </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">120</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> batch_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n_batches</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Get the random int for batch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            random_indices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">120</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">batch_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 120 is the no of training set records</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            feed </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> X_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">random_indices</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">random_indices</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># feed batch data to run optimization and fetching cost and accuracy:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_cost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batch_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">optimizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> accuracy_pct</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                   feed_dict</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">feed</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># accumulate mean loss and accuracy over epoch:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            avg_cost </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> batch_cost </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> n_batches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            avg_acc </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> batch_acc </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> n_batches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Training cost and accuracy at end of each epoch of training:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Epoch "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'%03d'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoch</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">": cost = "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{:.3f}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">avg_cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">", accuracy = "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{:.2f}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">avg_acc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Training Complete. Testing Model.\n"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cost</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_pct</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Test Cost:"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{:.3f}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_cost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Test Accuracy: "</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{:.2f}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_acc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Deep Learning" term="Deep Learning"/>
        <category label="Dense Net" term="Dense Net"/>
        <category label="Iris" term="Iris"/>
        <category label="TensorFlow" term="TensorFlow"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How To Create Your Own Personal Data Science Computing Environment In AWS]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/infra/how-to-create-your-personal-data-science-computing-environment-in-aws</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/infra/how-to-create-your-personal-data-science-computing-environment-in-aws"/>
        <updated>2018-01-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Running a training algorithm is such a time-consuming task when you are building a machine learning application. If you are developing it with your computer, you cannot do anything else for a long period of time (hours and maybe days) on that machine. Especially when we do parallel processing using all the CPU cores, your CPU will be peaking at 100%.]]></summary>
        <content type="html"><![CDATA[<p>Running a training algorithm is such a time-consuming task when you are building a machine learning application. If you are developing it with your computer, you cannot do anything else for a long period of time (hours and maybe days) on that machine. Especially when we do parallel processing using all the CPU cores, your CPU will be peaking at 100%.</p>
<p>So, here is what we can do. We create our personal data science computing environments in the cloud and do training there. We can simply let the script run as long as it needs. Running it in the cloud computer has lesser chance of interruptions. In the cloud, you can quickly provision resources and terminate them as you require without the need of managing physical devices. It gives you flexibility. You can start the script before going to bed and it will be finished by the time you come back from work on the next day. You can also set up your own database to get data and write the result back to a table. Sounds good, doesn’t it?</p>
<p>Amazone Web Services (AWS) offers easy to use cloud computing services. The computing and database resources are charged by hour. AWS is a mature cloud computing service provider and you can get all the benefits of cloud computing. When you sign up, you have access to heaps of free services for the first 12 months (including Linux and database services) as part of free tier.</p>
<p>Before going into this post, you should need basic knowledge of AWS. There are heaps of AWS courses out there. I recommend AWS Cloud Practitioner Essentials, which is the official training material from AWS. It will give you the enough foundation knowledge to get it started.</p>
<p>Architecture</p>
<p>We are going to using Linux EC2 instance for program execution and Postgres RDS for Database. We install Anaconda in EC2 instance. EC2 can read and write to Postgres. If your application produces images, you can write it to S3 (not the scope of this post, but it is very easy to do).</p>
<p>We are going to have two subnets across two availability zones. Our local machine needs to have access to both EC2 and Postgres RDS instances.</p>
<p><img decoding="async" loading="lazy" alt="AWS DS Env" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/aws-ds-env-3fe07249a9b405a98a719af2544933e6.png" width="1177" height="949" class="img_ev3q"></p>
<p><strong>Steps</strong></p>
<p>This is going to be an epic!</p>
<p>(1) Create AWS account</p>
<p>First of all, you need to create an AWS account (if you don’t have it already). AWS offers a free tier service for 12 months so that you can experiment and gain some practical experience.</p>
<p>(2) Create Admin User</p>
<p>The best practice is not to use root account credential (the user who created the account). Use IAM to create an admin group attached with the AdministratorAccess policy. Then, create a user attached to the group.</p>
<p>To understand IAM identities and how to create admin user, go to How To Create Admin User In AWS.</p>
<p>Log back into AWS management console with the admin user credential.</p>
<p>(3) Create and Configure VPC and Subnets</p>
<p>According to the plan, you need to create and configure VPC and Subnets. Then, attach Internet Gateway to the VPC.</p>
<p>For detailed steps, refer to this blog entry: How To Create and Configure VPC and Subnets In AWS.</p>
<p>(4) Create Network ACLs for both subnets and Security Groups for EC2 and RDS instances</p>
<p>Go to VPC Dashoard and create Network ACLs for subnets and Security Groups for instances according to the plan. Problems with connecting to resources are usually resolved by fixing NACLs or Security Group.</p>
<p>I have the detailed set up examples for this use case: How To Configure Network Access Control Lists (NACLs) and Security Groups in AWS.</p>
<p>(5) Launch Linux EC2 Instance In Subnet A</p>
<p>You need to launch the instance with correct role in to the correct subnet. Create Elastic IP and attach it to the instance. Once you have the instance, make sure you can SSH to it. Here is the detailed steps: How To Launch an EC2 Instance From AMI in AWS.</p>
<p>(6) Attach an EBC volume to EC2 Instance</p>
<p>This step is optional, but fun. You can get 30GB of free EBC for the first 12 months. So, why not? Here is the detailed steps: How To Attach EBS Volume to EC2 Linux Instance In AWS.</p>
<p>(7) Launch Postgres RDS instance in Subnet B.</p>
<p>When you launch an RDS instance, you cannot choose a subnet. Instead, you have to choose Availability Zone. According to our diagram, Subnet B sits in AZ2. So, you have to launch it into AZ2. Then, Subnet B becomes where the database sits. Using subnet group doesn’t really work for this use case.</p>
<p>Apart from that, launching RDS is very easy. Here is the detailed steps: How To Launch a RDS Instance In a Specific Subnet.</p>
<p>(8) Install Anaconda to EC2 instance</p>
<p>We are almost there. Let’s install Anaconda to EC2 instance. Linux has Python 2.7 pre-installed. However, upgrading their Python version is not a good idea. Linux has some dependency on Python and it may break it.</p>
<p>Instead, we create a special folder /anaconda/ and install it there. When we call python, we create a variable called $python3 with the path to Python 3 in Anaconda and use it.</p>
<p>You can obtain the installation path from Anaconda website here. The example url below will be quickly outdated.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo mkdir anaconda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd anaconda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo wget https://repo.continuum.io/archive/Anaconda3-5.0.1-Linux-x86_64.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo bash Anaconda3-5.0.1-Linux-x86_64.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Make sure to change the default installation path to /anaconda/anaconda3/. Then, export a variable python3 as below. Type $python3 to see if it works.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export python3=/anaconda/anaconda3/bin/python</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$python3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(9) Install psycopg2</p>
<p>Make sure to use the pip path for the anaconda. If you just use pip, it will install it to OS’s Python. pycopg2 enables Python to connect to Postgres.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo /anaconda/anaconda3/bin/pip install --upgrade pip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo /anaconda/anaconda3/bin/pip install psycopg2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(10) Test to see if the EC2 can connect to the Postgres RDS instance with the script below.</p>
<p>Test to see if the EC2 can connect to the Postgres RDS instance with the script below.</p>
<p>I usually copy and paste the script directly into vi editor. Make sure to run the script with $python3 to use the correct Python. You also need to chmod to excute the script.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> psycopg2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dbname</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">host</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">password</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">conn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> psycopg2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"dbname={} user={} host={} password={}"</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dbname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cur </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> conn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cursor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cur</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Select NOW();'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">record </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cur</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fetchall</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now you have your own AWS environments to run a heavy training algorithm or do whatever you want. Once you finish computing, you can stop instances. While they are not running, you won’t be charged. When you need them again, you just restart them.</p>
<p>Epic!</p>
<p>Next Frontier</p>
<p>Infrastracture as Code</p>
<p>I think the most important philosophy of AWS (or any cloud computing platform) is Infrastracture as Code. The entire infrastructure and resources can be coded. Bringing up environments becomes running code. It sounds cool, right? This is the next frontier you should explore.</p>
<p>Resources like EC2 and RDS can be a piece of code. You can even install software and configure it while launching them. In this example, we launched EC2 and installed Anaconda with psycopg2. The whole step can be coded and repeated again and again by running the script (called Bootstrap). You can check out how it can be done here: How To Launch EC2 With Bootstrapping in AWS.</p>
<p>The same goes with RDS. You can launch it with a piece of code. Check it out how to do it here: How To Launch Postgres RDS With AWS Command Line Interface (CLI).</p>
<p>You can use a tool like CloudFormation to code up the entire infrastructure including VPC, subnet, routing and securities. Learning how to bootstrap EC2 or RDS is the first step toward coding the entire AWS environment. It is also very satisfying to create and terminate resources with a piece of code.</p>
<p>Good Times!</p>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Tools and Infrastructure" term="Tools and Infrastructure"/>
        <category label="AWS" term="AWS"/>
        <category label="Cloud Computing" term="Cloud Computing"/>
        <category label="Data Science Development" term="Data Science Development"/>
        <category label="EC2" term="EC2"/>
        <category label="Infrastructure" term="Infrastructure"/>
        <category label="RDS" term="RDS"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Predict Internet Popularity By Optimising Neural Networks With Python]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-python</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-python"/>
        <updated>2018-01-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In the previous post, we used grid search to find the best hyper parameter for the neural network model with R’s caret package. Here, let’s use Python and scikit-learn package to optimise a neural network model.]]></summary>
        <content type="html"><![CDATA[<p>In the previous post, we used grid search to find the best hyper parameter for the neural network model with R’s caret package. Here, let’s use Python and scikit-learn package to optimise a neural network model.</p>
<p>Just like the caret package, scikit-learn has a pre-built function for hyper parameter search. As for dataset, we will use Online News Popularity Data Set from the UCI Machine Learning repository, which is the same dataset used in the previous post. It was originally used in this publication.</p>
<p>The nnet package from previous post is a single hidden layer back-propagation network. Therefore, there is only one size parameter for the layer to tune. Here, we will use MLPClassifier that implements a multi-layer perceptron algorithm. Having a multiple hidden layers enables us to specify the number of layers as well as the number of neurons for each layer.</p>
<p>As for parameter optimisation, we will use GridSearchCV with 10-fold cross validation. Optimising multi-layer neural networks can be lengthy because you can try different layer numbers and neuron size in each layer. Here, let’s use 2 layers and try to optimise the neuron size per layer for simplicity. Generally speaking, stating small works fine with neural networks in terms of both layer and neuron sizes.</p>
<p>We will also search for the best alpha parameter for L2 regularisation (you can read more about regularisation here). In short, regularisation prevents over-fitting by penalising it. With no regularisation term, you will get a great accuracy on training set, but not so great on test. Neural networks are often called as a black box method, which makes the method fancy and magical. In realisty, they are a variation of nonlinear statistical models. So, regularisation terms work just like logistic regression. Scikit-learn has a great documentation on MPL here for more detail.</p>
<p>As in the previous post, we are dealing with the prediction of binary classifier (‘popular’ or ‘unpopular’) based on the attributes comes with online news paper articles (see details here).</p>
<p>OK, let’s code!</p>
<p>Summary Steps</p>
<p>Get data and prep it (by selecting the right columns, splitting them to training and test and normalising the data).
Do hyperparameter search.
Model &amp; predict with the best hyper parameter.
Calculate performance metrics and draw ROC curve.
Code</p>
<p>(1) First of all, we have to load the data (after downloading data from here) and do data prep. I normalised it after splitting into training and test set, but you can do it prior to the split. Note that you have to use the scaler function fitted with training data for the test data set to keep consistency if you are doing this way.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> train_test_split</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">preprocessing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> StandardScaler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (1) Get data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shares </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"/tmp/OnlineNewsPopularity.csv"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (2) Check data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shares</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shares</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># (3) Prepare data (train_test split and normalise)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> shares</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">59</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> shares</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">where</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">y </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1400</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Popular'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> train_test_split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scaler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> StandardScaler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Fit only to the training data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scaler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Now apply the transformations to the data:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> scaler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> scaler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_x</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(2) I created a grid_search function so that I can reuse it for other models. It takes a scikit-learn model, feature matrix, label array and parameter grids and return the best parameters.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model_selection </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> GridSearchCV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grid_search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> param_grid</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">'''Takes a sklearn model, feature matrix, label array and parameter grid dictionary.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Returns the dictionary of best parameters'''</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> GridSearchCV</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> param_grid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> param_grid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_jobs</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cv</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> scoring</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'f1_weighted'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">X</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Best F1 Score is: {}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_score_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Best Parameter is: {}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_params_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">best_params_</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(3) See the range of the alpha and neuron size for each layer that I choose. For some reason, neuron size (5, 2) appear in many places (including the official documentation). So, I chose my parameter grid range around them. The bigger the neuron size is, the more complex the models become. Generally speaking, a smaller neuron size works for most of the time. But, of course, you have to experiment it a lot to find the best size. You can read this post for more details. It is a good starting point to know about layer and neuron size.</p>
<p>I picked lbfgs for a solver. You can try to use different ones. Again, you have to experiment it to see which one works best for your use case.</p>
<p>As I did with R code here, you can do parallel computing by adding the n_jobs=-1. As the grid search is an iterative CPU intense process, it is always faster to do parallel.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">neural_network </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> MLPClassifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alpha </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1e-5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3e-5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1e-4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3e-4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1e-3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3e-3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">3e-2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hidden_layer_sizes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">param_grid </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'alpha'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpha</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'hidden_layer_sizes'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">hidden_layer_sizes</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">estimator </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MLPClassifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">solver</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'lbfgs'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">best_param </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> grid_search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">estimator</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> param_grid</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Best F1 Score is: <code>0.6631095339771439</code>
Best Parameter is: <code>{‘alpha’: 3e-05, ‘hidden_layer_sizes’: (5, 2)}</code></p>
<p>(4) Now, we got the best hyperparameter set, let’s model the neural net and do prediction.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MLPClassifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">solver</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'lbfgs'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> alpha</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">best_param</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'alpha'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hidden_layer_sizes</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">best_param</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'hidden_layer_sizes'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pred_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pred_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pred_train_prob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict_proba</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pred_test_prob </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict_proba</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(5) I created two functions to get all the evaluation metrics. The calculate_auc function also produces ROC. I used pandas magic to create a data frame for the easy summary of performance metrics. These metrics are the same one use in the publication.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> accuracy_score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> precision_score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> recall_score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> f1_score</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">metrics </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> auc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> roc_curve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">%</span><span class="token plain">matplotlib inline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">evaluation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_precision </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> precision_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos_label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_precision </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> precision_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos_label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_recall </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> recall_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos_label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_recall </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> recall_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos_label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_f1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> f1_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos_label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_f1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> f1_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos_label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'Accuracy'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">train_acc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Precision'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">train_precision</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token string" style="color:#e3116c">'Recall'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">train_recall</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'F1'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">train_f1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'Accuracy'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">test_acc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Precision'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">test_precision</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             </span><span class="token string" style="color:#e3116c">'Recall'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">test_recall</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'F1'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">test_f1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> train_df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_df</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">traindf1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> testdf1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> evaluation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Neural Network'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">calculate_auc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train_prob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test_prob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fpr_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tpr_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> thresholds_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> roc_curve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train_prob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos_label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fpr_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tpr_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> thresholds_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> roc_curve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test_prob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos_label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Unpopular'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_auc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> auc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fpr_train</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tpr_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_auc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> auc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fpr_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tpr_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Draw ROC curve</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lw </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fpr_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tpr_test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'darkorange'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">lw</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">lw</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> label</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'ROC curve (area = %0.2f)'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> test_auc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">plot</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'navy'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lw</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">lw</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> linestyle</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'--'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.05</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">xlabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'False Positive Rate'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ylabel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'True Positive Rate'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">title</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Test Data ROC Curve With Neural Network'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">legend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">loc</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"lower right"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">show</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'AUC'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">train_auc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'AUC'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">test_auc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> train_df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_df</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">traindf2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> testdf2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> calculate_auc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train_prob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test_prob</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Neural Network'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">traindf1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> traindf2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">concat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">testdf1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> testdf2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"Training Data Performance Metrics\n"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"\nTest Data Performance Metrics\n"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">round</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_df</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here is the output.</p>
<p><img decoding="async" loading="lazy" alt="ROC Curve" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/roc-for-neural-net-with-python-4284f3565e35a7ff88e9f5a4d60ed35f.webp" width="668" height="669" class="img_ev3q"></p>
<p>Comparing it With Default MLP Classifier Model</p>
<p>If you don’t set any parameter, the default alpha is 0.0001 and hidden_layer_sizes is 100 neurons in a single layer. The default model is over-fitting, which happens a lot for neural networks. You can see the power of simple parameter tuning!</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MLPClassifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">solver</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'lbfgs'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># default alpha=1e-5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pred_train </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pred_test </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> clf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_train</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> accuracy_score</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pred_test</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Neural Network Model Train Accuracy: {}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_acc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Neural Network Model Test Accuracy: {}'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_acc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Neural Network Model Train Accuracy: 0.77
Neural Network Model Test Accuracy: 0.62</p>
<p>Let’s Benchmark!</p>
<p>Below is the performance metric table from the paper (Fernandes et al. 2015). Our neural net model was comparable to the second best method (AdaBoost) in terms of accuracy and AUC. The model is still over-fitting slightly and has lower recall. So, I think there are more room for optimisation. All in all, pretty good outcome considering how simple the whole modelling process was.</p>
<p><img decoding="async" loading="lazy" alt="Benchmark" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/performance-benchmark-python-ea38c24d2c5f25bf7d3e11d4a48a41bd.webp" width="1030" height="243" class="img_ev3q"></p>
<p>Your Turn</p>
<p>In the publication, they also used grid search to find the best hyper parameter set in a few different methods. In the paper, SCV was optimised with C ∈ <!-- -->4<!-- --> , RF and AdaBoost was with number of trees ∈ <!-- -->400<!-- --> and KNN was number of neighbors ∈ <!-- -->20<!-- -->. Now that we have a custom grid_search function, you can try finding the best hyper parameters for all these methods in a streamlined manner.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">svm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> SVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">svc_model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SVC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">kernel</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'rbf'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">23</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">svc_param </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'C'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">**</span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> yy</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> grid_search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">svc_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> svc_param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ensemble </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> RandomForestClassifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># n_estimator is the number of trees</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rf_param </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'n_estimators'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RandomForestClassifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n_jobs</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> random_state</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> yy</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> grid_search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rf_param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sklearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">neighbors </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> KNeighborsClassifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">knn_param </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'n_neighbors'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">400</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">knn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> KNeighborsClassifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n_jobs</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> yy</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zz </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> grid_search</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">knn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> knn_param</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Machine Learning" term="Machine Learning"/>
        <category label="caret" term="caret"/>
        <category label="Hyper Parameter Search" term="Hyper Parameter Search"/>
        <category label="Neural Networks" term="Neural Networks"/>
        <category label="nnet" term="nnet"/>
        <category label="Python" term="Python"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Predict Internet Popularity By Optimising Neural Networks With R]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r"/>
        <updated>2018-01-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Writing code to do machine learning is easy. What makes it difficult is the optimisation. By large, there are two ways to optimise your model.]]></summary>
        <content type="html"><![CDATA[<p>Writing code to do machine learning is easy. What makes it difficult is the optimisation. By large, there are two ways to optimise your model.</p>
<ul>
<li>Feature selection &amp; transformation</li>
<li>Model parameter optimisation</li>
</ul>
<p>Both are hard-core topics and neither can be covered in this post. Feature selection and transformation often require subject matter expertise on top of statistical computation.</p>
<p>In this blog, I want to focus on parameter optimisation by using the power of the caret package. The caret package makes it easy to do hyper parameter search. The model parameter optimisation is often called hyperparameter optimisation. We search and optimise over all possible parameter values for the model and pick the ones perform the best (the best hyperparameter set).</p>
<p>Here are some of the commonly used for hyperparameter search strategies.</p>
<p>Grid Search (Not as efficient, but easy)
Random Search (Efficient in certain scenarios)
Bayesian Optimisation (Efficient in general)
The default search method for caret is grid search which will be used here. Another question is which parameters to search. This depends on the method or package you use.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="neural-networks-hyperparameter-search">Neural Networks Hyperparameter Search<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r#neural-networks-hyperparameter-search" class="hash-link" aria-label="Direct link to Neural Networks Hyperparameter Search" title="Direct link to Neural Networks Hyperparameter Search">​</a></h3>
<p>Neural networks has many different flavours. I chose the nnet package because it uses the often-called vanilla neural net (a.k.a the single layer back-propagation network or single layer perceptron) and is simpler to tune hyperparameters compared to other more complicated neural networks. In this method, you don’t need to determine the number of layers as it has only one. What you need to do is to choose the size of the neurons in the hidden layer.</p>
<p>The bigger neuron size you use, the more complicated the model become. Therefore, more neurons tend to become over-fitting. Of course, this is dependent on the dataset. It is only determined by experimentation. However, smaller size is a good rule of thumb.</p>
<p>Neural networks sound complicated and magical. But, if you deconstruct them, they are basically non-linear statistical model. Hence, we should try to optimise the regularisation parameter. <code>nnet</code> has a parameter called decay for regularisation. In short, regularisation prevent over-fitting by penalising over-fitted training models.</p>
<p>We will set hyperparameter ranges for size and decay for <code>nnet</code> optimisation.</p>
<p><strong>Sampling</strong></p>
<p>Another thing you have to consider is sampling. Again, there are a few different ways like Random Sub Sampling, Stratified Sampling or Cross Validation. In this example, I will use the classic k-fold cross validation method (where k = 10). A sampling method and parameters can be specified in the trControl parameter in the train function in caret.</p>
<p>K-fold Cross Validation split the training data into k pieces. Then, it uses k minus 1 folds to estimate a model and test it on the remaining 1 fold (called validation set) for each candidate parameter values. With grid search, it will calculate the average accuracy per parameter set to produce the best set.</p>
<p>The drawback of grid search is that you are assuming a possible range for the hyperparameter set. Therefore, you cannot reach it when it exists outside of your pre-defined set. But, it’s a good place to start.</p>
<p><strong>Dataset</strong></p>
<p>I am using the data set Online News Popularity Data Set from the UCI Machine Learning repository. The dataset was used in the publication here. Each row is an online news article containing a bunch of attributes as well as the numbers of social media shares. There are 58 features and what you predict is a binary classifier of the article, ‘popular’ or ‘unpopular’. The classification category was made by setting the threshold of 1400 shares. This number was chosen in the paper because it produced a balanced popular/unpopular class distribution (Fernandes et al. 2015). The goal is to predict if the article is popular or not by using the available features.</p>
<p>In the paper, they used Python’s <code>scikit-learn</code> to do Random Forest, Adaptive Boosting, Support Vector Machine, K_Nearest Neighbour and Naïve Bayes. We can use their results as a benchmark to test our neural networks model performance.</p>
<p><strong>Code</strong></p>
<p>(1) Install and import required libraries.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(caret)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(nnet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(e1071)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(NeuralNetTools)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(doParallel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(ROCR)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(2) Download csv file here. Load the data and create a target field which contains a binary classifier(popular and unpopular). I used 1400 as the threshold as in Fernandes et al. 2015. I removed non-predictors according to the article.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shares &lt;- read.csv("/tmp/OnlineNewsPopularity.csv")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shares$Popularity &lt;- as.factor(ifelse(shares$shares &gt;= 1400, "popular", "unpopular"))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shares2 &lt;- shares[, -c(1, 2, 61)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(3) Split the data set into training and testing with seed for repeatability.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set.seed(1000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inTrain &lt;- createDataPartition(shares2$Popularity, p=0.7, list=F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train &lt;- shares2[inTrain, ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test &lt;- shares2[-inTrain, ]]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(4) Now, it’s time for training and predicting! You can set the sampling methods with the trainControl function and pass it as the trControl parameter in the train function. I defined the tuneGrid as 3 size and 3 decay options. The caret package will conduct the accuracy search to find the best combo. The final values used for the model were size = 1 and decay = 0.1 (you can see this by typing model_nnet in the console).</p>
<p>The caret package supports parallel processing. R by default uses only a single UPC. Parallel processing will enable you to do computation with all the CPUs in your computer. It is easy to set it up. For Windows, you need to use the doParallel package. Once you register the cores with the registerDoParallel function, caret will execute it automatically.</p>
<p>You can visualise the model by the plotnet function from NeuralNetTools.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set.seed(1000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set up Parallel Computing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cl &lt;- makeCluster(4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">registerDoParallel(cl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Train with caret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">numFolds &lt;- trainControl(method = 'cv', number = 10, classProbs = TRUE, verboseIter = TRUE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         preProcOptions = list(thresh = 0.75, ICAcomp = 3, k = 5))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model_nnet&lt;- train(Popularity~., data=train, method='nnet', trace=F,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   preProcess = c('center', 'scale'), trControl = numFolds,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   tuneGrid=expand.grid(.size=c(1,5,10), .decay=c(0,0.001,0.1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Plot model and predict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plotnet(model_nnet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_pred &lt;- predict(model_nnet, newdata=train, type="raw")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_pred &lt;- predict(model_nnet, newdata=test, type="raw")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Here are some notes for errors and warnings when you are training the model.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The linout parameter cannot be True. You will get the error message, ‘entropy fit only for logistic units’. The default value for linout is FALSE.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In trainControl(), summaryFunction=twoClassSummary will result in a warning: The metric “Accuracy” was not in the result set. ROC will be used instead.” This parameter can be omitted. It will use Accuracy by default for categorical prediction.</p>
<p>(5) In R, you can use confusionMatrix() to evaluate the model. It will give you the performance metrics such as accuracy, balanced accuracy, sensitivity, specificity and so on. I created a custom function for evaluation because accuracy, precision, recall, F1 and AUC were used in the paper and I wanted to get the same metrics for benchmarking.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">evaluate &lt;- function(pred, actual){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tab &lt;- table(pred, actual$Popularity)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tp &lt;- tab[1,1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tn &lt;- tab[2,2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fp &lt;- tab[2,1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fn &lt;- tab[1,2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accuracy &lt;- (tp + tn)/(tp + tn + fp + fn)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  precision &lt;- tp/(tp+fp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  recall &lt;- tp/(tp + fn)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  F1 &lt;- 2*(precision*recall)/(precision+recall)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  actual_label &lt;- ifelse(actual$Popularity=='popular', 1, 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pred_label &lt;- ifelse(pred=='popular', 1, 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pred_OCR= ROCR::prediction(pred_label, actual_label)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  perf = performance(pred_OCR, 'tpr', 'fpr')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  plot(perf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  AUC &lt;- as.numeric(performance(pred_OCR, "auc")@y.values)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print("Prediction Evaluation Outcome")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  eval &lt;- as.data.frame(cbind(round(accuracy, 2), round(precision, 2), round(recall, 2), round(F1, 2), round(AUC, 2)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  colnames(eval) = c('accuracy','precision','recall','F1','AUC')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print(eval)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evaluate(train_pred, train)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evaluate(test_pred, test)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Confusion Matrix from caret package for evaluation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Only for accuracy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">confusionMatrix(train_pred, train$Popularity)$overall[1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">confusionMatrix(test_pred, test$Popularity)$overall[1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># confusion matrix and all the metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">confusionMatrix(train_pred, train$Popularity)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">confusionMatrix(test_pred, test$Popularity)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Output</li>
</ul>
<p><img decoding="async" loading="lazy" alt="nnet model" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/nnet-model-82b4005ac1614715c54615b93bdbd010.webp" width="1114" height="747" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="evaluation" src="data:image/webp;base64,UklGRu4KAABXRUJQVlA4TOEKAAAvX4ElAAfktrZtRdkzg3vsGUWQeqf05PIiJsKhAIpw2tq2rCzNu3kFMCt6QNE3mkL+PMmf+yWJw0gACOSzF7Abot1bxLbtu/mvQr5t6jEQcIUpAwENFAzAVLRQcDbFlAYKrpGiIHgmDiRPSJgTNCFQEDQhcfDJK8YYOqDoTaDQhIACyRNd/N/nn+ELYwf83Kk8dpi6gRjnNxHjCQMa5F8HkurpoViTKkKK8afwPKCvkuSQ3CCwYIcaQsag6lffaGlCQJbkuS9UXgc+Q1N44soIblChZwA3KNETmIACA94EBqbW/Zgfnm2uHAc00OHJoUHLBqumCR7//3PUNtu2WdKx0BHEpjfSE/emcKCaXrHaMnC4yhUOd3vNcQj5WMTxt8/+ft+Z/c0IlB7Rf1qQJIttm0GKNGiaNXcPeATeRbp//dv79kYcxyfboiy/Nb9VlJW5k21fOSjoKxGsRePY5gR5QZartcNtHTSLr8TxqY0A0J0r9bXJx8pcy85SbY0rhZqAxe915426w39egr1a35jEvHFEBw47eFp+cMlRoCw4TRxLr8bx4TY7lDqvremld+I4bgFIzuj7qBKRiPNtfotr82eolJteqsUn2ywQ9kViEsqMDtuG5Uot9we2MCLjcez1AogHG/hT5/L7n7Xts8k5vTx3hB14S2e39PJPWl+sbzjBlehxirVBqpCSoX64vXSijQPpvEapf96+WlvD1M/lY4ZsUURX43N6scbYdtiRD5bpBfvXnTfr4A8sZjZ823nm3miBOdwBpESxaevt+S07RyxfCpgjlpmESFB/YmuJCITG82FFPlhPc6fwxZv5g8sZTZKw8sFGfnK9Ykyc4EoMizbAIXc8EAstV+jEYksIGHLnvxcNdp9yBH7XbJNDtP6T6wNXYmBtuuMGCEQUS0QA59GQD3b/7YArk6vz3729QUN34mrcypXgDtdGn+UGDUQEKkXgEfEBphBpF+SD3XdvuZpfG3QutPPwz5xs04R23kQ7JC/txXdrLahkFI62sTa/1mJKCBBIYeY39cV4jelYInpjfrNzJT7Zxp+wHYMhlg92/33Q4qtxXD+R+2zTNCy9Gr/305W4BdBXa/GpL+daFqWlXHcDapMLDa2BEh8hZFuQ46/G5kOQDoqo81Zc/4V8wcb51rIjHiy/r5kcWzj35UUul+N43hw10hPAa9KeemLdl2ut/a0rSY+wONvH/C4zHdvUE3zzyR/ktm5ZKdW3e1hoRkNdTUcSVO4mhtXS3cQNpuSRilIKahcKLTzcRkGSIRP46HlmoKt9a6qCw+cLE4HVkh+6FfVcVIBMNwZjvVpSZrudFEu7cyYkk6byLSuG99D0+RcfvHB/T1bbbRREH0BwCKsagYp9FPWDoZiiF2THRTcfjfzRLYeFNXqa29zg5YhMws1nlOolBuNx+yVDhX1tUKW0l7BTYTDmSlQyvcn1e2400hHLYfN5ozsEEDf6PqAkHFqVHBuVPvBH2iBXQLsx+CLqNaN7Y55h8JZw6ZYJJvjmnUQ3o119vmQ0G2pXfxTdTUgkhEaehe7/ExAQUqqkT41xP9e/lTSizAIWaD4c6/NPtf4wHTkBlIRCs3lVB2Puz7Rxrrh2LnLt0e2vShnPcPh0Z1WmDX2eJJptJgCg408CskI9eGb7fE5wiT3XrjCLZpQ5gJREQyMO7Ly0AnKFtc0EZKYwc/qCxAaOUur+HlLkZzQ5Bi3QoXcDDEVDZZYRgoFwudXHI+P6j2eVUk4ApcKhiQFyhbUBYO4KfAcrWhIRChaJSp/Ez6YIJ7iSEE47woA07iOsJ7KfnYI0Bt8cGlETJxpqCJRkQnN/S0PJ7dxN9hvwi+jjRFcGe91ZZXtL3yj9TET+nTh+6TnDHR/cTWiuuzNoh8gnHz0XDYGSTGguHwT8mTbMFdIGgAx7o1tW9I5CGv1RfiF1x0T8okp38AO7auslml1tjYgSvmhzhERPpw6VaSr95OmsGgJ0I1L3vi4NkZJIaA73NdAfaLNcoQ9CgAz7ecAb5QC8rvQnzE1mPb7QCr33agsouxxAwatBFRlgFWkabvsDl7sqWkVyBt7L87v8D59VKh0ejBhihyJT3d0EQm7i9SdPpQB1ClBEABUQcI8L6iYOkt+W+7YMEsfZSBl9h2oLCg3VO84TEa1FKiCFAuEJCZTmwy/SEYQXWYUAxQhUROACCFA3cZHM60l0nQ2R7pJiukO1BdRW8GofWYwSKrIUCgQkJEyqfbOYgvhWfkWPjUuX+SIBTL+AZJ+uPbpUC92qLcbPup7ZS7RckcU1EEtCgqRbzvIsAr4qyX4mKEaAsUMClh1nSW2eyNKjncHYrdrS1xA6CaW7iVgRwDEQS/Y8QGsjDPf9cZ4GhPCKPy9GCOAgicYnfy4EisgKvyBLd6RwDARlL9iHCr22Ed/B8RTcaSiKiyR4um6eLdAx4tgiwqBTz6kCUgTnFAUG9MloHrrlIaueqUxynRQUI0ARAQjwQgPFVZIurN5NLAz29IcqQ6kCNQhuizh/w3iYc0ymAlIoEF5tCZKGcaeHTHUwYvWXdIdeHYhsqBgBighAgBcaSNAFJMmkaOE/z6h0F6YK1CCALeJQREvjEhWQgoGAaosPLFUkp/0hyMnLEcknu6/pJfvsNsIygR4oNzIFHWSp5qeqA39K2UIvEDSfUfdGNv8ZpZ78DwjYf37Fc2h4cWPoMSEfRirdkZQ0SgGkmhYIPEDWIT9MR7bbzT19fh0I2H88yG9o+K2PR74SQu/2P1SZmGT+v/GlozBSvVoa+rp1qfQR4Cch3H8kwl9oVmaG/hJCFru65UxG0vjRtRrhVAcDXuuBYfe5gOsqodfQ8MF7J/GYkEZKlimEJFdLGb0Blkt1UKC1ynQE5W/N5OsNQMC+7zE023PmLyG5dPrf5zK57JGHwVg21UHiUHwCVahAafZ8JkR3Z55E90ZiktX8SyIajGVTHTp3E7I6DASCpHto5DMh+cvdssqkJHV+JszeTYRTHfDL5DuIfsEAgSBfbvS8JoRNNXcTGUk+n0unOsB/Zjep3k2AQJD/rJJ5TYhJL12zlcke/zDpVAsjc3lLrNMRNRnqZmkIBOzX3WGE9nDsNyGVwV4+O0tJ/mtPnzf1PK+pthYIPN3UMbhJuoMEwrlvhDT6PhPCbu7SXTHJfz6bX4lIp/oPyNvvPn03fLfbCO63ME6lvhve220E91tEp1XfjZW5VpjtNgorXa1vTAfeOKJF8NhuwwsoIy5M6r4bjkrLr8Zx/TBUCqPdhlyMBZ4mdd8NFyXya8115wd0mAfSbkMsxiK/RX9S991wUlqZI2crIpB2GzIxFvytxpO674ab0qVa/VwbEki7jWIxCjGp+244KnUW36n/ggik3UbBGGV2JnXfDbsSHHVAIO025GIs8JZJ3XfDSWn507bumHMDKAXSbkMoxkIfNLn7brgoLb9di+PTm1ApkHYbYjFOwC4b0vfl+6DdxhTqsiG+rhR+u43p32XDI3+90nfjb//7bvztf9+Nv/3vuwG0Q+y7QUMajKd83w2gHWDfDZCMKd53w6IdYN8NwnTvu2HTDqzvBuAA0HeDa4fYdyN/mSzMTPm+G1w7yL4bWtOflpv2fTe4doh9N7RmZ/iU77sBtAPsuwHGfcr33QDaAfbdAA/Tve8G0A6y70Z3XZ8v3U2me98NoB1m341miVyp/Vlw+/HHP5excLh9gEUDAA==" width="352" height="151" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="comparing-it-with-default-nn-model">Comparing It With Default NN Model<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r#comparing-it-with-default-nn-model" class="hash-link" aria-label="Direct link to Comparing It With Default NN Model" title="Direct link to Comparing It With Default NN Model">​</a></h3>
<p>What if we used the model without any optimisation? Check out the outcome. It is pretty much as good as random picks. Now, you see the power of the simple caret optimisation!</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model_default &lt;- nnet(Popularity~., data=train, size=1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plotnet(model_default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_pred_default &lt;- predict(model_default, newdata=train, type="class")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_pred_default &lt;- predict(model_default, newdata=test, type="class")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evaluate(train_pred_default, train)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evaluate(test_pred_default, test)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="evaluation 2" src="data:image/webp;base64,UklGRkAKAABXRUJQVlA4TDMKAAAvX8EkAO/jNrZtVVnf8K85LkUQ0TgZjTAOkXsjbhvblpORiCw/uYANaIMGaIFeqYRw34ms6xx2IwAEq6vN38aapft2AK9hG89M5j/O31M33NnACGvubOAMZV2wtrlA2doaa85QdqoULYp7sCDcIbClSKHQokghWHjlFUvMMWOLDbYMYYQGd5xZIjl9syD8xVCXpEi4w0zDzcc7HbcZ1i4gRv9NxdjCjDPyzxNCiu4fUwrFBYJgxp4ZPn8agY6Pf4oUWv5NSLUqEShTpBD2SJWlUKQQXk2GI5suQ/F/9ny6b41D32jLYuwyQZ0bXZigyo0N5qDMHTtY2yhb3SZgcdsnx22bPbhDghpOvcHdFNKLDbCm4hLxiCWpBvXGGBSDol4OyT9/N/Pb2bk9uNsR/acFSbLYthlUkYLCqOYWxCPwztL7tz/C3k7GcXynr8rK6Z0NX1aP3OmXlcGdvq/J6pk4jq+VlZ5GVg6NWxdD+oYunebNvq0Wbo3ev8XphYXtPWptV4DVIwM3y81tiZIogPDAxXrg41ZKVp3WeiU5ecN+cyGJWMqiaOBYPhbHN/vsvdA7vm2Xz8ZxPACQounrqBKRiIttZ4Nr82eoVJh+2cyHXFYIG4LzRJjRTVeuj5qFP7CFFeUet04guAl0W26SYlvrLBmUFU8PZuX6Sj0r36fenz/8fd89mly1K0dusAyW/7NhV65Y+1VrXQRQIpFhbVArUspp3ewv3+3jQnrHKa3f9TvNbUzral7DANmiijrxVbvURAAT4IaK5TUCFB70s2J68v/cO9UCXzBpVvhuUfzJARjDBSAlikvb7u5suLnh+FDA3HCkTCSoP7F1VMRKo4iVSBW4Rk30s1IYxlZO519ITkmaxkfrxcl1NDcRwZUYDm2AoHheiIOBFDoyuAIBh1zyJgBVE2CNqqhmVRY34IfFLnkftq5IH7gSA2vTHRmgEFUcFXlyAx4YWKMq+lmVsAMC6+z888w6dRfRiQdECeHQJqoyaCEqECl6AvCK+AEWAHbu9BG4Rp6VBvpZ6b+kU3zu9/7bL/zv3+nTQHunYgAprL90rjmASrnC7T7W5hdLTAkBCvFm56L9Kt5mOo6KTu5c7D2K4UuACa+afhvXyLMC8EAouzG4sNPPqoQftHQsjlt3+0W1tI7lY/H5K4/iAUqk04wf/uXIwKG0XOiuQ21yEWEtUOJHCNl6cu9Y3LoKk0UV9U7HrWsnIcAEVE10HTWyrAAwECfqWfH7moC2gO7LPa5343gnPwKakhsBJNQ7PtCWDve+3Fob2LyS37hbqW33lvYb0Lrnlaq8lcmP5LakboyZuj0cdKO2PZyNNGg8S3PWas9SGUypRBrGGKjtVVp4yI6CJm0m8Mm7zMAenjqjqgoqhc0F1mrlkDTMO5EHYzucbdq1msm3J6lf7OIkNEMzxTb2o/TS7N77L997saWrLTsKqg+gODFJnUDFPommweCnWAq6x8V2X4/KI6mHhbN6mm1hcCgig3D3LWMmaU7u8eSDnAb72KBK2SRlp8JskytRyezXXH8iY5iNWIbdd3PdNoC40dcBJeXSDpP3RmMK/JE2yApoD2dfR5Nu9HyTJwxeEi5JnZAX332a2m60YPdquebQLNhPomcpqYQwLFJIPktBQUipkX2RG08L/V+lw2jsAAt0X23avS+s/TgbiQBKSqW5vA7PNrk/08ZZce1C5E+vn/y1NuYJh09ywIxtzpSHRNNmAgB6/ElBTqgHT3bKxwRJ7YV2g1l0o7EApKRZGjVk56UTkBXWzgegfAjLT18QbOAYY15sIUV+RpP3oAN66GWAQzE0Y8cRgoVwubU3o9z14NvGGBFAybs0NUBWWBsAxq7Ad7CiI4hQcEg0pqR+NkSI4EpKiHaUATFWCOeJXM6OJ8PZ3/eNqImIoWkDJZ3S5C8ZGr2dZ2nVgB9En6a2MdtKDhjXS6a50mUi8jgVfuiJ4Y4vn6U062S/ARD59JN3ojZQ0ilN8oOAP9OGWSFtAEi4NJK6oXcU2thPigupp3nF75vsAn5gV22T1LKrrRFRwhdtQkj1dOjIQ6DS//vigGkD7DAyz/9WayMlldIE9zXQH2izrNAPQoCEy3nAG+Vb8LzSTzA3nfl4rxn60rstoO3yLRQ8G9TwAjaPvlG3oJHcTNHmkQt4587v6T9+25is/S2LNnYQDGzPUgi5Zbd//KI8QJ8CNBFgB6RNCwR9E4HkP+pTniBM6kBkcn1BtwWVhvode0TEWpUOiFchPJAg6L76OhtBeEu1NEAzAjURuAAC9E0kkkU/ic6zIbIF0kwXdFtAbwXP9pHJKKUmi1chIJAQODxdq7UR/6gH8GHEjkvCKkACmKmH5JTOPUq6hbJuS+7nnM+cpFavySItxBFIACT1cZEZ4K+1sn8maEaAY4cEHDtiSZs/kalHN7NNWbdlaiF0EMoWUrUmgLAQR3p60JYIw7m/WRQNKXtOiDcjFBBIouNTPHuBKnLCr8yyC1pICwGBBPLQoJc0Aezgwjx3hoYikQRPv82fHdBjxHFVhEGnnqgD4oM4olKBGmNadVJvs16ZGZc7TwqaEaCJAAR4o4EilaQTq89SB7Mt+7EZo8xAD4LbIvZ+k3vk55hOB8SrEN5tCYBhbkrfIIdnI9ZtyS7Qa4GSNtSMAE0EIEAbDSxeD0kyTDr4/1smW4CZgR4EsEXsi2hrXKMD4lkI6LYo4mgeof02SOBQRNJj9zWTtPK3EY6R9FvlRoagb7McLk5eAT9t2QLtFHTfMs+d//KcTR2s1Y3JFgKOqPxA5JJ4/qStU4hSVLRTUAJkHvLjbIR5wyySz61Vn5vVjSiAQKSSLlH/QvQnOsq6dWlM5dV2o3G4vzIUQCASSSf726JCKgWe65HzehQuAQQilYRqT1NZIVUCzVVmjpCKyQnKXn1iw6X8QGSSruexUiHVw4LfGBsa83wrYMoPxJ/uRKuQCgJFkv1ZwDsBBOJLsm+kVkhFvi1IFczRh/vtAALxlRxO9AqpyP8meDdVgAAC8ZVsjPUKUaXc6+61Gi0xuWT3akUGe9fJ7+aFSwCBeEiyLqpeIf44OwUl3TfiRGq8axIZ81z7X9WoR1RyIL6Sw6liId+Hbz/+X3ej4stthPRXGAPMNZy/K1rx5TbC+yuic2vdjdUjgyCQFOKBVw6KSp3W+pzg5A37TQMKVEJl190QKq0ci+PWTbjyxVxYbkMvIo+nyq67IVEifyLc9v6F3qfzYbkNtYh8/op+ZdfdECmtHiFnK2I+LLehE5HnaFrZdTdkSl82W1f7kPmw3IZfREpUdt0NoVJv6WzrGmI+LLfhGZHOTmXX3XArwaMOmA/LbehF5PGSyq67IVJa+UPf9vJzA6x8MR+W21CKyOsHVXjdDYnSyplmHD+4CFe+mA/LbahFVIVVNrTvy+ffchvzaJUN9XmlubfcxjfAKhsl8gvI62784v+6G7/4v+7GL/6vu/GL/+tuWGsBAA==" width="352" height="148" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="should-we-normalise-the-dataset">Should We Normalise the Dataset?<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r#should-we-normalise-the-dataset" class="hash-link" aria-label="Direct link to Should We Normalise the Dataset?" title="Direct link to Should We Normalise the Dataset?">​</a></h3>
<p>It really depends on the data. The nnet package generally performs fine without normalisation unless you have features in completely different scale. Normalisation is usually recommended for Neural Networks for better accuracy and faster training speed.</p>
<p>Well, let’s test it. nnet takes factor and numeric values as features. In the first example, all field types are numeric. Here, I converted categorical variables into factors and normalised other numeric fields.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Normalising data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index &lt;- c(12:17, 30:37, 59)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colnames(shares2[,index]) # checking the selected columns by index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmp_df1 &lt;- as.data.frame(scale(shares2[, -index]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmp_df2 &lt;- lapply(shares2[, index], as.factor)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shares_norm &lt;- cbind(tmp_df2, tmp_df1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create training and testing set. Use the partition created above</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set.seed(1000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inTrain &lt;- createDataPartition(shares2$Popularity, p=0.7, list=F)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_norm &lt;- shares_norm[inTrain, ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_norm &lt;- shares_norm[-inTrain, ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># train &amp; predict</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set.seed(1000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cl &lt;- makeCluster(4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">registerDoParallel(cl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">numFolds &lt;- trainControl(method = 'cv', number = 10, classProbs = TRUE, verboseIter = TRUE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         preProcOptions = list(thresh = 0.75, ICAcomp = 3, k = 5))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model_nnet_norm &lt;- train(Popularity~., data=train_norm, method='nnet', trace=F,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         preProcess = c('center', 'scale'), trControl = numFolds,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         tuneGrid=expand.grid(.size=c(1,5,10), .decay=c(0,0.001,0.1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model_nnet_norm # The final values used for the model were size = 1 and decay = 0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_pred_norm &lt;- predict(model_nnet_norm, newdata=train_norm, type="raw")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_pred_norm &lt;- predict(model_nnet_norm, newdata=test_norm, type="raw")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evaluate(train_pred_norm, train_norm)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evaluate(test_pred_norm, test_norm)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Testing accuracy is slightly worse. But, overall it is similar. I think it is still good to test on the normalised dataset when you are modelling with neural networks. Normalised data usually give us a different model. In this case, the final values used for the model were size = 1 and decay = 0.</p>
<p><img decoding="async" loading="lazy" alt="evaluation 3" src="data:image/webp;base64,UklGRlgLAABXRUJQVlA4TEwLAAAvbAElABfkNrZtVVnfcIvdaYTeKeNrxI9wTSnCbSNJjlP23+IieGUxBwbEJOmpKN6iVuZjzyTgNrZtVVlfcCd0pwh6pwQyUndIXWfmvwr179IdDyroYcuDCi7QNANb1RWaCltsuUDTKXIUBLdEQ3KDhD1BHwIFQR8SjWdescZSisSbQKEPAU2SG8b4v+e/wB7WUrzdqVxhha0zSFHfBCLFDAsuyD8viIzqX7t7SGpWSySJP4Vbg7lWUkNyhsSKDWb2MLGGGUZccCBdoOdd3xgT9CGhRvCLmfdS1dpNHWBGzwIG6HJnBgO0uTMDTR7YUmFm63insOaMeUIPLG7/57hNNCu6YxlkbXpT6Nh0MEIEF65KNHfNyrp17tJ7pEvPpupPn/39vjP7m9mlQ0T/JUGSJKlRjBksuiwq5wC6pK2//o1hOxjH8cd9UZYOL2wXZXn2476vDNx8JWv04fzBVhk/IMuV5lxf/1Sgu5da6xXC8uyqncXmOlcqRwCgxmC3K63NSuPgvK54XHL0zVdO15fFfXE812cHUHf/ul48GsfxKoAkSb+OKhGJON8Wtrk2v4dKuemFpnmyYYWwJx+THDOas+2sS83cH9jCiozHBwfseKsRmtCKWu/CYq8snGvOLTY/2Q7jrnv+xLt9+0VnTS/NzrNjc/Hzbb30vdZnW5tOcCV6KGNtkAlSMrTm+osf9XEh3f2U1nv9K811TGvN1LCKbFFFV+I1fbJpv/FWo8XkYOt7U9480r4Sz3194oNvZtnh6v/T3UMt8A+WBNuXF/MYD66C674DSIli09YXF7btzFueSDDzlisPkaD+xNZSESvNjrcaoQmxIXkB7SsL24snNs1lJZxL49Jh8w+XKwCJZvn1zfy022tMnOBKDIu2FRgSL8TCqiv0QmQLxOx/NzzXSGAHw5V4PfcqC/PwiejivOYntRNciYG16QM3QCGiWCpypmCN/gn4AUjvysK/j2zSDJy4EtPzHWHRJqpu0EJEoFIEXhHf2254rtH6wIVgv+RK/kqje6afh/LZx32abvdQDCBp9U8ea65CJaPwfh9r85doTAkBCinMwpY+G68zHUtFBxe2updiwsUYvAwsWKMQ6EtcCPcHndwXx62PaISkuMV98fHvL8WrAH2lGX/yt9lVi9JirrsJtcnLFq2BEk8W2Rbkw32x+SFIB1XUPRy3fjzoQNEaRQA/yAn2ZqqEW0DLBAVen8fxgjmEhK4I+7Getxq3q2uZQGstvgDmbRdIcfGDvnSCnhfAqnDzye8Yt96UUmps97DQiSa6kQ0lqN9ODCu124kbTMkjdaUU1C5UWni47QVvTJjAmy8yA90YW3MLDp8fqARWagHQq6sXogKkuv1ooFdqymw3k2L7wDkWyQRVvqXF8F6aPv3y45fu7shqu+0FfzegUoRVjUDF3ozGwVBM0QuyO0l37g/90ZsKGGsUNOjc4LWIXLg7zyk1SgzG4+Yrhjp7qqFK2ShhJ8mjAVeiktl1rj9yo50NWaCdF43uBEDc6NcBJeHSGuRAqY+BP9IGWQHt9qMvolEnujPgCYMvKQm9KYJJonMr0Z1oV5+uGc222tVvRrcTUgmhnUfS+28CCkJK9eyUMR7n+jeSdpRawAKdewN9+pTWb2RDJ4CSUGk2r8ajAfdn2jgrrp2LXL5/8++1lCdcMnozKtWGMU+MRs8EAPRgIAVZoR485jG/dLjUnmvXmUUnSh1ASqKlEQd2xloBWWFtc50yVzpzYoNgy4RS6u4OUuQnPjk6LdDjwA2wX9oqtewuWAiXW3kwNK6vPq+UcgIoFS5NDJAV1gaAS1yZHmBFSyqhYJGoj0n97EriBFcSwumBMCDGsmI93/08KEj70T/3DKmJE201AUoypbl/SVvJPbidlBr4TPZWouuPdnozyvYlY6P0AxH5f+L4rOkMd3x8O6HB96YVgMgnb74QTYCSTGkuPwj4M22YFdIGgIT9A1YH8muyNPrN/DXaLVP+yyp7hm/YC8JRotkLuSFRwq8HHSHV0yuMCYFKPzw1oyYA3Y7UnX/UJkhJpDSHN1PQH2izrNAPQoCEA7jBG+Xn9gLYH3E3mWZDofaD974SaDD93AUvW9VlgP2yn9ytHLi8laP9Mmfg0gJfdHjjeaWyyc8wJtChAHV1O4GQNQX99ikvgI4MaJfAXs+E1gY6RA6S/5oa2+IkjjORMvoOfSVUGursnCYiWov0egoVwgMJlM69L7IhhHedfQDaLqhdwgUQoEPkIpm30ejqICLbJb934NBXAl0kvEZJVs2E2kmFCgGBhEljbBZ6EP/yvA7JdlKPySMBzLiA5Jgun7p0TN36SsbPuiQ7SrRcO8m1EEsgQdKbSvMUAX+vefyZoO0CdiQSsDxwltTmjqye2nk0cOsrjTWEXquy3USsw+FYiCU9D9AuEMP98SCPAeGzncHbLgI4SKKdld8XAlVkhb/Wy55J4VgISi/Ymzp9peT3AS6u4IO2orhIgrur5t4C3WEcW0UYdFI69XqK4BxRYECflObQm5qwpqFKvS31grYLaJcAAd5SobhK0rXh24mFRzv6DZWi3EC3hdsiTl8zHubsk+n1FCqE95WCpG3c6fHTeDRknabsGX15Ib+htgtolwAB2lJhWReQJBdSC0+eU9kuzA10W4AtYk9Ef3FAotdTsBDQV/KBpV/m9HgCMnktInmyN1OjpMzvXSwX3Z+vG7lS/WymkZ/RDvwxaQu9FdJ5Tt0Z2vynlXr4HyBg/wMlz6XhhZeJx0DeiFT2TFLSKIUWNW2F+KAT7eYLp7Y3vDv69AYQsP8xmN/S8Jc+GPoKhC4+vKFSMcn8VyazYYBRr9Qmvt4v1ccI8Nct7n/m4q80K9MTf4GQVbneVCojafzoOpJw1GGCF6VgBmMu4LrQ6bU0fFjfSjwG0s7IEoqQ5EotpW/B5aIOF7Tcmg2h/I3pfC0ECNgfeyzNdp/6CySXzp6+kMqlR24eDWSjDh+HnhtovgVKZ+QzEN2bfhjdGYpJNvInlujRQDbqUnE7IavdQCBIenuGPgPJP9ybUqmUpM7PkZnbiXDUZfkweRKjz1BAIMgPt0deA2FXpNuJjCR/DpCOOvRvs5s0bidAIMhvq6deAzHx0mVnmfT4D5OOWgiPr++JNTmjybWyU5swAZcFxjBKuzfwG0j90U5+RZeS/N+OPm16muFEbW2FeHpbyeAm2TMkEM47V0h77DMQ9vYy2xWT/PL5/HWNdNS/O99+25qP429SS4n/E9JKnI9TQfj873Urfz7O8uyqf4RLEz1AW5sVy8F5Xdm4/5folTcfx1FpaV8ct+agktexOHKlhTINp/Lm47gokekBuvstOtz9jsURKy2YaTiVNx/HSWl5lpzHCL9jccRKC2YaTuXNx3FTutBsrfUhfsfiiJUWzDScypuP46jUPXm09SPC71gcsdKCmYZTefNx7ErwEAD4HYsjVlow03Aqbz6Ok9LSO+YnmbMGKPkdiyNWWijTcCpwPo6L0tKRZhx/ugWV/I7FESutsqfhSC8ThDsWp5zTcKpwPk6wY3F+rkzD8cifLM7H+cv/+Th/+T8f56/+5+OwdY1Hg+qZjwO0ZYfpSEddwvk4YIJN9czHAdrCw3SCiNrbS0KZYTGE6pmPg7VDHKYTLIWHxQAqZz6ORTu0YTpBU2SkBpwRs1IjKyjVMx+HaUsP0xGOugQ49dw0/avB6pmPQ7XFh+kIR10m4IwYdiJUz3wcoi0/TEc46tA+LDNZBiRSPfNxcm0fw3Rkow7t22Qmy4Cb6pmPk2uHOkwn0BupYTG9DX26djupnvk4RNvDMB3hqEs5H6dTU2qUVNJ8nPbYwzAd6aj/mLp9993vmNE=" width="365" height="149" class="img_ev3q"></p>
<p>Let’s Benchmark!</p>
<p>Here is the performance metric table from the paper (Fernandes et al. 2015). Our model has the same accuracy as AdaBoost and SVM. It preformed slightly worse then RF. We beat them in Precision (0.7). However, I don’t think our model is superior because we have quite low AUC compared to all the models in the paper. Overall, I am happy with what I got. You can really see what simple optimisation can make difference!</p>
<p><img decoding="async" loading="lazy" alt="benchmark" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/performance-benchmark-ea38c24d2c5f25bf7d3e11d4a48a41bd.webp" width="1030" height="243" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="further-grid-search">Further Grid Search<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r#further-grid-search" class="hash-link" aria-label="Direct link to Further Grid Search" title="Direct link to Further Grid Search">​</a></h3>
<p>My hyperparameter range for the size was (1, 5, 10) and 1 became the best hyperparameter. OK, 5 neuron was probably too over-fitting. But, Isn’t 1 neuron too simple? Surely, having a few extra neurons would lead to better performance? I decided to investigate it further by setting size range to (1, 2, 3, 4).</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set.seed(1000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cl &lt;- makeCluster(4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">registerDoParallel(cl)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">numFolds &lt;- trainControl(method = 'cv', number = 10, classProbs = TRUE, verboseIter = TRUE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         preProcOptions = list(thresh = 0.75, ICAcomp = 3, k = 5))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model_nnet&lt;- train(Popularity~., data=train, method='nnet', trace=F,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   preProcess = c('center', 'scale'), trControl = numFolds,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   tuneGrid=expand.grid(.size=c(1,2,3,4), .decay=c(0.001,0.01,0.1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model_nnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plotnet(model_nnet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plotnet(model2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">train_pred &lt;- predict(model_nnet, newdata=train, type="raw")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_pred &lt;- predict(model_nnet, newdata=test, type="raw")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evaluate(train_pred, train)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">evaluate(test_pred, test)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The best hyperparameters turned out to be size = 4 and decay = 0.1. With these parameters, I didn’t see any improvement on test dataset prediction. I even observed the model was overfitting. Generally speaking, complex neural networks tend to overfit. This exercise somehow reminded me of Occam’s razor. By paraphrasing it, the simplest is the best given everything is the same. I think Occam’s razor is often sited in machine learning as the reminder that simpler is often better.</p>
<p>Performance for size = 4 and decay = 0.1 is below:</p>
<p><img decoding="async" loading="lazy" alt="evaluation 4" src="data:image/webp;base64,UklGRnoLAABXRUJQVlA4TG0LAAAvfwElAAfktrZtRdkzg3vsJZCTeqf05PIiJsKhAIpw20qSrDybHf0AONciByzyxiaQfx+YX/NNJIeRABDIZy9gN0S7t4ht23fzX4X8t2nASMAVpowEtFAwAFPRQcHZFFNaKLhGioLgmTiQPCFhTtCEQEHQhMTBJ68YY+iAojeBQhMCCiRPdPF/n3+GD4wd8HOn4bHD1A3EOL+JGBUGtMg/M4R0mr/q6aHYJFWEFONP4XlAXyXJIblBYMXOt40b1yKqfs0bLU0IyJI894XK88B7aAoVV0ZwgwoDA7hBiYHABBQY8SIwMLUexnxR21w5jmihQ+XQomODVdsED9e2N26bbRvIdFlUQnFS3JneexSGqlcl0yi5DJHLvZOX4z7mdZnyRUrXb8ec5wHgBGbo7oj+S2LbSJIkNbZ7ay7YrjuiZ+L/h37QfwRib5Ik3/RFWdu/dNyX9cVv+oHY66ZXwqNFxpfHik0R4j7f+KyvSwzdOdvcmiGsL/bsrDa2gCS/RzQE8Xi+eXSmsfdzXT64RFN0lp0OTKtvJclnfbZNdt7e0qsHkyTpAUi49OuoJCIiyR9Lx7ls/gol5UpPN8yJixlhJzKTPFP0mW39nW3k+oFa6Mjo+PIdO+IewUvB6Zx595O+/Wi1qdcWP2db8OoPx/Xar1qfah51gkuiGzyWDTJFkgzNz/qrX/exkc7blOan/fONLUxz03joIbXI0flkU6807E/yHpm8rcIvdPY1wX9YOGz1nsuT3dsD5xAHkCSKTbY+t3TczueWkxLmc8shi4ig+olaiyNmzY68R35ILoEPr+03/3E5dJC01t87mu+cbxolTnBJDItsgEPI3IiFniv0CGYLxGwSboh6LDs+hyfFc2QTb/7q+sQlMbBsuuAGMCKKxZEz8h5LbAEEen7pnweO0oycOJ/0cklwwSKbSHWDGhGBiiJwR3wDcEPeY3l9yfn82qZzsp/n9P03fRp4Zx9aIAH2Vw41elCSkfBFH8vmF5VMEgIY8WbpmD6VbDE5Fkd7l451ziaEc8nnHHmPJfaDVt5KkubXJFWa1+pbyeFfzyY9gD7fSL79y2LPImk1l3sUyiYXSloDSXwNIrWefPVW0tyEaxA56uxPmr/vdUDcY1nf92mtI6p7eNw3JMmS2apkhHbe7knH4lD3KGPC1f2ktwApzn3Zl6ZM6n7FeQRkxtW9S7Hv8Lic7pxSaqi1TYeFdmWs69lUgtq11LBRvZa6wSQFpKaUgrK9rMWH21qIiTET8MHLTIGuD61RFgURY6XARjVOujX1UsWDiW6NdvVGVZnH1dRvtTgnJRmqyh8TP4Jb0ydevfnKjR1Z2W5rIaonYN4Kkkagwj6oDKPBT2IQZNebbt+ehqM7Vyys6dDscwVvVMhJoP2CUoPUYHRcfc1QY6ctKikbpGxXGu1ySVRkdpnLH7jRyqYs4/bLRu4YQLTRrwOShK3VybZTGwL9SDbICshujX6sDNqV67s8YfAlxaU7RzDhtP9MdbuyrU9UjcyW2tYfVK6lxAmhlafU/X8KDCFJtey+UTzM5V9JW5WJBSygfWtXn7iv9fvZ1AkgSciaTVd9tMv1M9k4Ky47F3Lh9tW/Vic84eLTXVATbRjyEOnaYAIAdPsghqxQHTz5IT/muHjPZdeYinZl4gCSJGqNaGD7tRWQFZZtDnDmEGl2fxBswVFK3dhBEvkRg2zDFuim4QZYVS01saxBaISL27gzNVpff1Ep5QSQ5G1NDJAVlg0Ax8aCL2CJlqBiwSKiNiT+2SHICS5JCKcFYUCMJYL1QBFmwZPW6O97plSJEy01BpJkrLl/SUvJLVxLywZ4ovww1bXRTndB2b5kaCT9RoT8O3U8KTvDNd68ltJ10Z1XACI+/eClyhhIkrHm8oOAfiYbZoVkA0DC0dKdU/SOSxr9QX6h+KdJ5FWV3cNP7Kp0kGp2NTklkvBFqSPEPT00mRCo6Lv3F9QYoFsVdf1v1TGSJGLN4b4P6geyWVboByFAwnE+4Qflwb/u9+Bf934aBZl+jVcHJ3i3DrTtHsDB1bqaDKgL+UCwUAxc7jppF9IZWCvhVZT3X1QqGz8YMsYafA6l11IIKZLoj+7HAuhzgSYU6KCBGgLouzmI/Mfc0JYw0bhQUUa+Q7cOWUP9shNEiNYiHTQvIzyQSGnf+jGbQvibACIBNLNQE4oLQIC+m4vIvF9J66SIbJu8WcShWwd6c7haS4qFQk06LyMgkDipD00xC/EPXpGNZ4GtN17pRQIwQw+RQ1pbdulWu3XrjD5rvXqQarkmnasRSyBRYoqAeYqAv1bHOiZAMwusWyTAsuAsUpsXUlq2M9p169YNNYQe5LLtVKxJ5GjEkl4AaG+N4b68m8cAGUYFb2YJ4CASrb/81QvkyAq/4MzuSeFqBAQS7VONXptFt4D9ei60FMVFJHi5aF4t0HXIsTnCoF3XqYPmg3NEkQH1TGgOpmHAurNqEhOgmQWaUEAAb1RRXEXSwvm11MJoR7+vJihK0MPiahEnLhkdZh+V6aB5GeHduihpGe10k6qPpqx/l90jVy9x/CDUzAJNKCCANqpY/B4iyUHZwn9eUNk2jBL0sIBaxJ4KfWuHRAfN0wjo1oXA0oV0Wh6DTN6okDzZfd9Amvhvs/AB/MG67kcOcQ/y1PNDgZ0H/77Dk8mEbjC1X1DXbdXe7rxSd//HS0D8VB+BI2CERRQwEK3fr6jsnqRII0lIJBAQBNpgCgCpM7+fTW236zv6xBG2ru5M2b8IHAEjLKJwgdBqyvtqIiYyfxttNpURCTKXXsDXpaFu7WpDhO03sebBa2BH2AiPKGAgpBjZnZvIiDT6aK3M35El88KAanHIri2RNnp3bFhHFiOckIG0MlIm8hYJinu0gODrCGVeKFAtOptC8Vfmwa/FzaM6ZASOuBFO0EDms/++NBESyWvFo10RkSDzQuLQ3CSqBjommBFAyEC683cr16diIuv5Saoy2hURCTIvOtdSdljo7pnGBTGCCBlIPW+LqolYevmetHAtlREJ1Bb4w/wc2cpp4dcYHBEjiICBsEPZtVQmPXA+kREJ1Bbw2+xK6kRO/vm4vq02gREFDMRopjV5mfTAD5MRCdRGj8tFOFFNDgXkuNuujmlbXIPFCBwRI5CQgdRGO/nZQUrkv3b0CdNPlomaCxD/sLXBFOjumMGU0Lvalv0iMLyj1tAaUZhA2M1xti0m8qcX8yspGZFAwIN/3e9pCx4JzB0LN+4qrr9yPBPnjkVIZH/le+bPHVtf7IVH0tr55tEZy97PdYngMeVh5s0dc5S0ls9m+AxKCjpuTM6ax8vMmzvmIomMTdGdn9H+EnbcmJg1nyk/M2/umJOk9UWytyPCjhuTseY5zGDmzR1zk3S60dzsQ8KOG/OzJsTMmzvmKKmzcrD5OyLsuDFPazILM2/umF0S3CoAYceNyVnz+JKZN3fMSdLax+YnmX0LSAo7bkzImtcPmoFzx1wkrR1oJMl3x6CksOPGxKzNjPs+rbV03SPecWMzu+6htRav+0U7bqz8635lOG7suf9zx57fNHfsuf9zx577P3dMb1Qd354cgTWfiWbS08Fkh5RJR10Oc8dcZo7FNYDM2ZXwdDDhIWUxR/1HiOtSmSFcDkQ4gCxIIEBApEPKioT3EC5HIhxAFjCQ2jDGIWVFw2cIEZy9tVHNq0R8OcIBZI6ByE4Hkx1SJhx1MXFqbmryq7Gx0h4EDAQkIzukTDjqggNnb9HdJUa8JpoJTweTHVImHHUBPiw1sQu2/SMcQBY0EJCM8JAy2agL8G0yE7ssTxEOIAsaCEgmwiFlxXmSGsLVPaJPOL1hMQJrXhPNhKeDCQ8pE466LOaOtavufx4gsDWviWbC08GEh5QJR/3gX/d7aoRffnk6Fg0A" width="384" height="149" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="your-turn">Your Turn<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r#your-turn" class="hash-link" aria-label="Direct link to Your Turn" title="Direct link to Your Turn">​</a></h3>
<p>Can we further optimise Neural Network model here by using different search or sampling methods?
R has other neural network packages like neuralnet or RSNNS. Do they perform better than nnet?
Check all the models supported by the caret package. We can basically do all the methods used in the paper. See if we can use these methods and benchmark against the results?</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(caret)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">names(getModelInfo())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Fun!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h3>
<p>Fernandes, P. Vinagre and P. Cortez. A Proactive Intelligent Decision Support System for Predicting the Popularity of Online News. Proceedings of the 17th EPIA 2015 – Portuguese Conference on Artificial Intelligence, September, Coimbra, Portugal (<a href="https://repositorium.sdum.uminho.pt/bitstream/1822/39169/1/main.pdf" target="_blank" rel="noopener noreferrer">https://repositorium.sdum.uminho.pt/bitstream/1822/39169/1/main.pdf</a>)</p>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Machine Learning" term="Machine Learning"/>
        <category label="caret" term="caret"/>
        <category label="Hyper Parameter Search" term="Hyper Parameter Search"/>
        <category label="Neural Networks" term="Neural Networks"/>
        <category label="nnet" term="nnet"/>
        <category label="R" term="R"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How To Save Machine Learning Models In R]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/how-to-save-machine-learning-models-in-r</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/how-to-save-machine-learning-models-in-r"/>
        <updated>2018-01-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Once you finish training the model and are happy with it, you may need to consider saving the model. Otherwise, you will loose the model once you close the session. The model you create in R session is not persistent, only existing in the memory temporarily. Most of the time, training is a time-consuming process. Without saving the model, you have to run the training algorithm again and again. This is especially not good to happen in production.]]></summary>
        <content type="html"><![CDATA[<p>Once you finish training the model and are happy with it, you may need to consider saving the model. Otherwise, you will loose the model once you close the session. The model you create in R session is not persistent, only existing in the memory temporarily. Most of the time, training is a time-consuming process. Without saving the model, you have to run the training algorithm again and again. This is especially not good to happen in production.</p>
<p>In production, it is ideal to have a trained model saved and your code are only loading and using it to predict the outcome on the new dataset.</p>
<p>There are two ways to save and load models in R. Let’s have a look at them.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="save-and-load">save() and load()<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/how-to-save-machine-learning-models-in-r#save-and-load" class="hash-link" aria-label="Direct link to save() and load()" title="Direct link to save() and load()">​</a></h3>
<p>You can save named object to a file and load it in the later session. With save(), you have to load it with the same name. Here is the example of saving the optimised neural networks model created in the previous post. The model name is model_nnet.</p>
<p>Let’s save the model. If you want to deploy it, you can push .rda file with your code to production.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">save(model_nnet, file = "/tmp/model_nnet.rda")</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once you successfully save it, close the current R session. Then, you can load it back in the new session. It’s ready for use.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">load(file = "/tmp/model_nnet.rda")</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="saverds-and-readrds">saveRDS() and readRDS()<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/machine-learning/how-to-save-machine-learning-models-in-r#saverds-and-readrds" class="hash-link" aria-label="Direct link to saveRDS() and readRDS()" title="Direct link to saveRDS() and readRDS()">​</a></h3>
<p>saveRDS() does not save the object name. Therefore, when you load it back, you can name it whatever you want (see below). While you can save many objects into a file with save(), saveRDS() only saves one object at a time as it is a lower-level function. saveRDS() also serialise an R object, which some people say better. But, most of the time, it really doesn’t matter. The model saved with save() and saveRDS() is the same. You will get the same predictive outcome.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">saveRDS(model_nnet, file = "/tmp/model_nnet2.rda")</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As mentioned above, you can load it with whatever name you want (in this case, loaded as model2).</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model2 &lt;- readRDS("/tmp/model_nnet2.rda")</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check to see if both models are loaded.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; ls()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; [1] "model_nnet" "model2"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; For sanity check, you can plot them.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plotnet(model_nnet)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plotnet(model2)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Common Warning Handling</p>
<p>When you try to save the model with either save() or saveRDS(), you may get the warnings such as ‘display list redraw incomplete’ and ‘invalid graphics state’ as below.</p>
<p>Warning messages:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1: In doTryCatch(return(expr), name, parentenv, handler) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">display list redraw incomplete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2: In doTryCatch(return(expr), name, parentenv, handler) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invalid graphics state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3: In doTryCatch(return(expr), name, parentenv, handler) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">invalid graphics state</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When you have these warnings, you need to reset your graphic device by running dev.off(). For example, if you have a plot in the R Studio viewer, you will probably get them. Once you reset it with dev.off(), you can save the model without warning.</p>
<p>Yep, now you are an expert in saving R models!</p>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Machine Learning" term="Machine Learning"/>
        <category label="Save Models" term="Save Models"/>
        <category label="R" term="R"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How To Deploy Spark Applications In AWS With EMR and Data Pipeline]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/infra/how-to-deploy-spark-applications-in-aws-with-emr-and-data-pipeline</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/infra/how-to-deploy-spark-applications-in-aws-with-emr-and-data-pipeline"/>
        <updated>2018-01-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Once you create an awesome data science application, it is time for you to deploy it. There are many ways to productionise them. The focus here is deploying Spark applications by using the AWS big data infrastructure. From my experience with the AWS stack and Spark development, I will discuss some high level architectural view and use cases as well as development process flow.]]></summary>
        <content type="html"><![CDATA[<p>Once you create an awesome data science application, it is time for you to deploy it. There are many ways to productionise them. The focus here is deploying Spark applications by using the AWS big data infrastructure. From my experience with the AWS stack and Spark development, I will discuss some high level architectural view and use cases as well as development process flow.</p>
<p>AWS offers a solid ecosystem to support Big Data processing and analytics, including EMR, S3, Redshift, DynamoDB and Data Pipeline. If you have a Spark application that runs on EMR daily, Data Pipleline enables you to execute it in the serverless manner.</p>
<p>The serverless architecture doesn’t strictly mean there is no server. When the code is running, you of course need a server to run it. The main difference from the traditional way is that you store your codes and models in a repository, launch the server only during execution and close it as soon as it finishes. In this architecture, you only pay for the cost for the length of code execution. The architecture is often used for real-time data streaming or integration. AWS Lambda and Kinesis are good examples.</p>
<p>What is good about Data Pipeline?</p>
<p>Data Pipleline is a great tool to use the serverless architecture for batch jobs that run on schedule. You can design the pipeline job to control resources, workflow, execution dependency, scheduling and error handling without the hustle of provisioning and managing servers and the cost of keeping them running all the time.</p>
<p>Another advantage is that you can create a job with parameters (e.g. DB connection URLs, credentials, target schema/table). Data Pipeline jobs are basically JSON files. You can easily export and edit it. With parameters, you can easily promote jobs from the development environment to the production as it is a matter of importing the JSON file from dev to prod (which of course can be coded up for automation).</p>
<p>I also found that debugging and updating Spark codes or models became simpler. We can simply update the repo without touching the pipeline.</p>
<p>The cost of running Data Pipeline jobs is affordable. For a low frequency job (once a day), it costs 60 cent per month as of today. See the link for the pricing information. Note that the cost of running EMR will be charged at hourly rate on top of the running cost of pipelines.</p>
<p>Let’s have a look at the use cases.</p>
<p>Use Case 1</p>
<p>Sourcing the data from different databases (application database, data lake and data warehouse) and joining them prior to running the algorithm.
The output needs to be presented in a BI tool.
Prerequisite</p>
<p>Save your Sqoop code (as .sh), Spark code and model to Bitbucet or GitHub (or S3, which is less preferable option).</p>
<p>Solution</p>
<p>Within the Data Pipeline, you can create a job to do below:</p>
<p>Launch a ERM cluster with Sqoop and Spark. Source the Sqoop code to EMR and execute it to move the data to S3.
Source the Spark code and model into EMR from a repo (e.g. Bitbucket, GitHub, S3). Execute the code, which transform the data and create output according to the pre-developed model.
Move the output of the Spark application to S3 and execute copy command to Redshift.
BI tools to fetch the output from Redshift for presentation.
Sqoop is a command line tool to transfer data between Hadoop and relational databases. EMR uses Hadoop for file management. So, it is the best tool to move the data from relational databases through Hadoop in EMR to S3. It is fast and easy to learn. I learned everything about Sqoop from a cookbook which you can download for free here.</p>
<p>Below image not working with docusaurus compilation 😢</p>
<p>Use Case 2</p>
<p>Ingesting data into Data Lake with an ETL tool.
Transforming data with ETL or ELT within the Redshift.
All the data required for the Spark application is in the data warehousing layer.
In the enterprise environment, it is common to have an ETL tool that manage the data ingestion and transformation. Accessing the application databases directly for analytics is not the best architectural practice, either. The first use case is suitable when you need to do data ingestion in an ad-hoc manner or cannot wait for ETL development for the sake of speedy delivery.</p>
<p>Prerequisite</p>
<p>The same as Use Case 1.</p>
<p>Solution</p>
<p>The figure shows Informatica as an ETL tool. There are heaps of options out there and any tool that suits your use case is fine. I compared DataStage, Informatica and Talend in the past and found Informatica best suited for the particular situation I was in. I especially liked the Redshift connector and I wrote a small review.</p>
<p>The workflow has two parts, managed by an ETL tool and Data Pipeline.</p>
<p>ETL Tool manages below:</p>
<p>ETL tool does data ingestion from source systems.
Do ETL or ELT within Redshift for transformation.
Unload any transformed data into S3.
Data Pipeline manages below:</p>
<p>Launch a cluster with Spark, source codes &amp; models from a repo and execute them. The output is moved to S3.
Copy data from S3 to Redshift (you can execute copy commands in the Spark code or Data Pipeline).
Then, you can source the output into a BI tool for presentation.</p>
<p><img decoding="async" loading="lazy" alt="informatica" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/informatica-8a801a27dd2eb6358318312536b15810.png" width="1264" height="604" class="img_ev3q"></p>
<p>Development Process Workflow</p>
<p>Finally, let’s have a look at development process workflow. Prior to Spark application deployment, we still need to develop and test the application in an EMR cluster. In this workflow, we only launch the cluster after prototyping on the local machine with a smaller dataset. This will save money as running an EMR cluster is expensive.</p>
<p>Once the code and models are developed, we can close the EMR cluster and move onto the serverless execution in batch. Codes and models can be source from S3 in the Data Pipeline. It is a standard practice to version control them in a git type repository. Sourcing them from a repo in Data Pipeline makes more sense.</p>
<p><img decoding="async" loading="lazy" alt="Data Science workflow with EMR" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/ds-workflow-with-emr-eab8a50459ebe8992e73c227abff7f0f.png" width="1110" height="650" class="img_ev3q"></p>
<p>Let us know your experience with data science application deployment!</p>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="Tools and Infrastructure" term="Tools and Infrastructure"/>
        <category label="AWS" term="AWS"/>
        <category label="Data Pipeline" term="Data Pipeline"/>
        <category label="EMR" term="EMR"/>
        <category label="Spark" term="Spark"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How To Do Sentiment Analysis On Your Favourite Book With R]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r"/>
        <updated>2018-01-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I love dissecting and analysing my favourite books by reading them again and again, discussing them with my like-minded friends, getting to know the authors and reading other people’s writings about them.  My obsession with books lead me to thinking, how can I visualise them in interesting ways? Making Word Cloud is an easy and fun way to visualise your favourite book as in the previous post. In this post, we will go down deeper into the world of text analytics by using sentiment analysis. I will show you how to split the text by sentence, conduct sentence-wise sentiment analysis and create an interactive plot that shows how sentiment changes as the story progresses.]]></summary>
        <content type="html"><![CDATA[<p>I love dissecting and analysing my favourite books by reading them again and again, discussing them with my like-minded friends, getting to know the authors and reading other people’s writings about them.  My obsession with books lead me to thinking, how can I visualise them in interesting ways? Making Word Cloud is an easy and fun way to visualise your favourite book as in the previous post. In this post, we will go down deeper into the world of text analytics by using sentiment analysis. I will show you how to split the text by sentence, conduct sentence-wise sentiment analysis and create an interactive plot that shows how sentiment changes as the story progresses.</p>
<p>There are many different ways to do sentiment analysis. The easiest way is to split the sentence by word and score each word by looking up word sentiment dictionary. The tidytext packages in R has a build in function to do a basic sentiment analysis. The package documentation from CRAN shows sentiment analysis on Jane Austin text. This one with Harry Potter is also fun to read. For more advanced Natural Language Processing (NLP), you can use Stanford CoreNLP, which is very powerful, but cumbersome to use and can be slow at a time.</p>
<p>In this post, I am using sentimentr. The package is fast and super easy to use. It does sentence-wise sentiment analysis by using dictionary lookup and valence shifter. With valence shifter, it updates the normal word sentiment dictionary look up score with the score by looking at polarised word (such as really or hardly). It reflects the sentiment more accurately than just scoring individual words. It also has the get_sentense function to splice the text into sentences by using regular expressions.</p>
<p>The <code>sentimentr</code> package really makes sentiment analysis pop and accessible. I really love using it.</p>
<p>Sentence analysis on literature is hard because of slang, unconventional style and expressions, unambiguous sentence separation, sarcasms, jokes and so on. Despite the outcome is not perfect, you’ll have a lot of fun!</p>
<p>As the continuation from the previous post, I am using one of my favourite book, On The Road by the greatest Beat hero Jack Kerouac.</p>
<p>Ok, let’s code!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="summary-steps">Summary Steps<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r#summary-steps" class="hash-link" aria-label="Direct link to Summary Steps" title="Direct link to Summary Steps">​</a></h3>
<ol>
<li>Download a pdf file and convert it into text.</li>
<li>Create a data frame with row per sentence and do clean up.</li>
<li>Further split the sentence by get_sentence() and create a new data frame</li>
<li>Get sentiment per sentence.</li>
<li>Plot the sentiment by <code>plotly</code>.</li>
<li>Check the results and have fun!</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r#steps" class="hash-link" aria-label="Direct link to Steps" title="Direct link to Steps">​</a></h3>
<p>(1) Get the pdf file of On The Road from <code>freeditorial.com</code> and use <code>pdftools</code> to convert it to text. This step is the same as in the previous post.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(pdftools)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">download.file("https://freeditorial.com/en/books/on-the-road/downloadbookepub/pdf",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">"/tmp/on_the_road.pdf", mode = "wb")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">txt &lt;- pdf_text('/tmp/on_the_road.pdf')</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(2) Create the first data frame with row by sentence. For sentiment analysis, cleaning up the text has to be a little bit more diligent than just making a word cloud. You just need to look at your text file to determine what is needed. The regular expression is the way to go to clean up the text data. Use online resource for detailed examples as well as a quick reference. Make sure to test your regex with a short example!</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lines &lt;- ''</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (i in 2:length(txt)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmp &lt;- gsub('\r\n', ' ', txt[i]) # \r\n for Windows, \n for Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines &lt;- paste(lines, tmp, sep=' ')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec &lt;- strsplit(lines, '\\.')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df &lt;- data.frame(vec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df &lt;- as.data.frame(df[-c(nrow(df), nrow(df)-1), ]) # Remove Last 2 lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colnames(df)[1] = 'line' # Rename Columns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- gsub("«", "", gsub("»", "", df$line))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- gsub('^\\s+PART\\s+[A-Z]+\\s+', '', df$line)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- as.character(trimws(df$line, 'both'))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- gsub('^[1-5]\\s{2,}', '',  df$line)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- gsub('- -, ', '',df$line)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(3) Further split the sentences by the power of get_sentences function. This step is necessary to get a sentiment score per sentence according to the <code>sentimentr</code> package. The sentiment function in <code>sentimentr</code> may returns more than one sentiment score per sentence if you do not do this.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(sentimentr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentence &lt;- c()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (line in df$line) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmp &lt;- get_sentences(line)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for(i in 1:length(tmp[[1]])) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentence_tmp &lt;- tmp[[1]][i]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentence &lt;- c(sentence, sentence_tmp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr &lt;- data.frame(sentence)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$sentence &lt;- as.character(df_sentr$sentence)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(4) Once your data frame is ready, do the scoring with sentiment(). Add negative, positive and neutral indicator for visualisation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentiment &lt;- sentiment(df_sentr$sentence)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$sentiment &lt;- as.numeric(sentiment$sentiment)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$pntag &lt;- ifelse(sentiment$sentiment == 0, 'Neutral',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ifelse(sentiment$sentiment &gt; 0, 'Positive',</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                ifelse(sentiment$sentiment &lt; 0, 'Negative', 'NA')))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(5) You can plot it with base R plot function. I like using Plotly because it becomes interactive. The x-axis shows the progress of the story and the y-axis shows the sentiment. Positive, negative and neutral sentiments are colour-coded. Once you hover the mouse over the dot, you can see the sentence. The <code>magrittr</code> package enables the magic of the pipe (%&gt;%) operation.</p>
<ul>
<li>base R plot</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">plot(df_sentr$sentiment, type='l', pch=3)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>plotly- more fun</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ax &lt;- list(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title = "Sentence",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zeroline = FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">showline = FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">showticklabels = FALSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(plotly)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(magrittr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot_ly(data = df_sentr, x = ~sentence, y = ~sentiment, color = ~pntag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = 'scatter', mode = 'markers') %&gt;% layout(xaxis = ax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot_ly(data = df_sentr, y = ~sentiment, color = ~pntag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = 'scatter', mode = 'markers') %&gt;% layout(xaxis = ax)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output Example</p>
<p><img decoding="async" loading="lazy" alt="Output" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/sentiment-graph-7fdc2d98047ceb7ee287a23f63a87c54.webp" width="941" height="846" class="img_ev3q"></p>
<p>(6) Let’s check what is the most positive and the most negative and calculate the average sentiment score. I also created csv files with sentiment score above 1 and below -1.</p>
<ul>
<li>Check max and min sentiments</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$sentence[which.max(df_sentr$sentiment)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$sentence[which.min(df_sentr$sentiment)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Get average</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mean(df_sentr$sentiment)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Check positive and negative sentences</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">check_pos &lt;- subset(df_sentr, df_sentr$sentiment &gt;= 1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_pos &lt;- check_pos[order(check_pos$sentiment, decreasing = T),]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write.csv(check_pos, "positive.csv")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_neg &lt;- subset(df_sentr, df_sentr$sentiment &lt;= -1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_neg &lt;- check_neg[order(check_neg$sentiment, decreasing = F),]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write.csv(check_neg, "negative.csv")</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="discussion">Discussion<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r#discussion" class="hash-link" aria-label="Direct link to Discussion" title="Direct link to Discussion">​</a></h2>
<p>The average sentiment score was 0.024. All the highs and lows must have cancelled each other out, coming out slightly positive just like life in general.</p>
<p>The most positive moment in the story according to sentimentr is absolutely gold.</p>
<ul>
<li>
<p>I think Marylou was very, very wise leaving you, Dean, said Galatea</p>
</li>
<li>
<p>Yeah, that’s pretty much the best decision! On a more serious note, this is the prime example of the effect of using valence shifter in the sentiment algorithm. It has two positive polarised words (very, very) on a positive word (wise). Very twice really amplified the positive sentiment on this sentence.</p>
</li>
<li>
<p>Not sure about the most negative one. But, this is also the fun part, getting misplaced sentiment by an algorithm.</p>
</li>
<li>
<p>He showed me rooming houses where he stayed, railroad hotels, poolhalls, diners, sidings where he jumped off the engine for grapes, Chinese restaurants where he ate, park</p>
</li>
</ul>
<p>Looking at the results, I think it performed well overall despite questionable sores here and there. To be fair, On The Road is a difficult one to run sentiment algorithm because it is written in a stream-of-consciousness style with many unique expressions and unclear sentence break points.</p>
<p>Here are the top 6 positive sentences. No.2 is the classic Dean Moriarty haunted by his own madness. No.4 and 5 are questionable. No.6 is absolutely yes, I think.</p>
<ol>
<li>I think Marylou was very, very wise leaving you, Dean, said Galatea</li>
<li>Hmm, ah, yes, excellent, splendid, harrumph, egad!</li>
<li>It certainly was pleasant, said Hingham, looking away</li>
<li>Doll, Dorothy and Roy Johnson, a girl from Buffalo, Wyoming, who was Dorothy’s friend, Stan, Tim Gray, Babe, me, Ed Dunkel, Tom Snark, and several others, thirteen in all</li>
<li>There’s one last thing I want to know – But, dear Sal, you’re listening, you’re sitting there, we’ll ask Sal</li>
<li>Absolutely, now, yes?</li>
</ol>
<p>Here are the bottom 6 negative sentences. Yeah, it certainly shows some low moments in the book despite of some questionable entries. No. 5 is another classic Dean Moriarty.</p>
<ol>
<li>He showed me rooming houses where he stayed, railroad hotels, poolhalls, diners, sidings where he jumped off the engine for grapes, Chinese restaurants where he ate, park benches where he met girls, and certain places where he’d done nothing but sit and wait around</li>
<li>There was something paralyzed about his movements, and he did nothing about leaving the doorway, but just stood in it, muttering, Stan, and Don’t go, and looking after us anxiously as we rounded the comer</li>
<li>Then the third day began having a terrible series of waking nightmares, and the were so absolutely horrible and grisly and green that I lay there doubled up with my hands around my knees, saying, ‘Oh, oh, oh, ah, oh</li>
<li>Offisah, I heard Dean say in the most unctuous and ridiculous tones, offisah, I was only buttoning my flah</li>
<li>And the one to my left here, older, more sure of himself but sad</li>
<li>But this foolish gang was bending onward</li>
</ol>
<p>Wow, what a fun I had!</p>
<p>Now, you are ready for sentiment analysis on your favourite book!</p>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="R" term="R"/>
        <category label="Sentiment Analysis" term="Sentiment Analysis"/>
        <category label="Text Analytics Visualisation" term="Text Analytics Visualisation"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How To Create a Word Cloud For Your Favourite Book With R]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-create-a-word-cloud-for-your-favourite-book-with-r</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-create-a-word-cloud-for-your-favourite-book-with-r"/>
        <updated>2018-01-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Making a word cloud is fun and easy. It is a way of looking at text data and gain a different perspective. For example, if you have a bunch of customer feedback about your product, you can quickly create a word cloud to get some ideas. When I work with text data, it is often the first step I do to quickly show business users something or to simply get the feeling before I get into more advanced analysis such as sentiment analysis or machine learning.]]></summary>
        <content type="html"><![CDATA[<p>Making a word cloud is fun and easy. It is a way of looking at text data and gain a different perspective. For example, if you have a bunch of customer feedback about your product, you can quickly create a word cloud to get some ideas. When I work with text data, it is often the first step I do to quickly show business users something or to simply get the feeling before I get into more advanced analysis such as sentiment analysis or machine learning.</p>
<p>Creating a word cloud for your favourite book is even more fun if you are a book lover. It is another way to get to know your book and gives you a new creative perspective. In this post, I am building a word cloud from On The Road by Jack Kerouac. This is one of my favourite books. It is beautiful, ragged and free.</p>
<p>The simplest way of building word cloud is counting individual words that appear in the document. The more frequent a word appears on the book, the bigger the size of the word becomes in the cloud. To accomplish this task, you first need to download your favourite book and read it into the memory, process it into an appropriate format, and visualise it. The process is relatively simple. In R, the tm package pretty much handles processing and formatting of text data and the wordcloud package handles the creation of word cloud.</p>
<p>There are heaps of instruction available online, too. Here is the super simple introduction to word cloud with R from R-bloggers. This post will go further into the customisation of the word cloud and the creation of a document term matrix.</p>
<p>OK, enough intro. Let’s get to coding.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-summary">Step Summary<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-create-a-word-cloud-for-your-favourite-book-with-r#step-summary" class="hash-link" aria-label="Direct link to Step Summary" title="Direct link to Step Summary">​</a></h3>
<ul>
<li>Obtain free pdf copy of On The Road online.</li>
<li>Convert pdf into text data.</li>
<li>Split it by a new line, convert it into data frame and do clean up.</li>
<li>Create corpus and do pre-processing with tm.</li>
<li>Build word cloud.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-create-a-word-cloud-for-your-favourite-book-with-r#steps" class="hash-link" aria-label="Direct link to Steps" title="Direct link to Steps">​</a></h3>
<p>(1) I used freeditorial.com to get a copy of On The Road. You can also check out Project Gutenberg, which offers heaps of free books for downloading. If you are into Jane Austin, R has a package (janeaustenr) that contains her complete works and prepped for text analytics. The harrypotter package offers the full text of the first seven Harry Potter books.</p>
<p>After downloading the pdf file, I used pdftools to convert it into text. It converts each page into a vector element. It is a great package to read pdf with R.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(pdftools)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">download.file("https://freeditorial.com/en/books/on-the-road/downloadbookepub/pdf",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              "/tmp/on_the_road.pdf", mode = "wb")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">txt &lt;- pdf_text('/tmp/on_the_road.pdf')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(2) Split the text by new line and create a data frame. Once you have a data frame, it becomes easier to do clean up. I removed the title page, chapter title and the last two lines which are not the part of the novel. I also removed some special characters. I kept the chapter number because this can be dealt with tm later. For this part, you really need to look at the pdf you download and decide what to remove. When you use strisplit, make sure to add carrage return with new line for Windows like \r\n. For Linux and Unix, \n is sufficient.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec &lt;- character()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for(i in 2:length(txt)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tmp &lt;- strsplit(txt[i], '\n') #\r\n for Windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(line in tmp){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec &lt;- c(vec, line)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines &lt;- data.frame(vec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">len &lt;- length(lines$vec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines &lt;- subset(lines, !grepl('PART', vec))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines$vec &lt;- as.character(trimws(lines$vec, 'both'))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines &lt;- as.data.frame(lines[-c(len, len-1),]) # Remove the last two lines (not part of the novel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colnames(lines) &lt;- c('vec')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines$vec &lt;- gsub("Â«", "", gsub("Â»", "", lines$vec))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(3) Create a corpus and do pre-processing (remove punctuation, numbers and stopwords and converting all words to lower case). Stemming is important for machine learning like spam identification. For a word cloud, it generates truncated words and looks wired. So, I always omit it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(tm)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(SnowballC)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(wordcloud)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">corpus &lt;- Corpus(VectorSource(lines$vec))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">corpus &lt;- tm_map(corpus, PlainTextDocument)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">corpus &lt;- tm_map(corpus, removePunctuation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">corpus &lt;- tm_map(corpus, removeNumbers)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">corpus &lt;- tm_map(corpus, content_transformer(tolower))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">corpus &lt;- tm_map(corpus, removeWords, stopwords('english'))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># corpus &lt;- tm_map(corpus, stemDocument) - skip this one!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">corpus &lt;- tm_map(corpus, stripWhitespace)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(4) To create a word cloud, you can simply pass corpus to the wordcloud function. For colour, I created my own colour vector and randomiser so that colour changes randomly every time I run it. You can use RColorBrewer (see Step 5), but I found none of them really gives me the colour combos that I want. I set min.freq = 80 and max.words = 100. 100 words per word cloud is a good place to start. I usually determine min.freq by looking at the document term matrix (see step 6). The example below creates a png file, which is better than generating the cloud in the viewer. By default, the file is saved by the path of the current R session (check it with the getwd function).</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">colors &lt;- c("blue", "blue3", "blue4", "blueviolet", "brown1", "brown2",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "brown3", "cyan3", "cyan4", "darkgoldenrod3", "darkgoldenrod4",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "chocolate2", "chocolate3", "chocolate1", "chartreuse3",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "chartreuse3", "coral2", "coral3", "coral4","cornflowerblue",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "darkmagenta", "darkorchid2", "darkorchid3", "darkorchid4",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "deeppink1", "deeppink2", "deeppink3","deepskyblue2", "deepskyblue3",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "deepskyblue4", "dodgerblue4", "dodgerblue3", "dodgerblue2",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "firebrick1", "firebrick2", "firebrick3", "green3", "green4",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "hotpink", "hotpink3", "hotpink4", "lightseagreen", "lightslateblue",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "purple", "purple1", "purple2", "purple3", "purple4", "red", "red1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "red2", "red3", "red4", "turquoise4", "turquoise2", "violetred1",</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            "violetred2", "violetred3", "violetred4")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">png("wordcloud_on_the_road.png", width=1280,height=800)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">color_vector1 &lt;- sample(colors, 20)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wordcloud(corpus, max.words = 100, min.freq = 80, random.order = FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          color = color_vector1, rot.per = 0.15, scale = c(10,1.5))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev.off()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print("Wordcloud png file has been generated.")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(5) Here is the example of using RColorBrewer for a word cloud.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">png("wordcloud_on_the_road2.png", width=1280,height=800)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">color_vector1 &lt;- sample(colors, 20)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wordcloud(corpus, max.words = 100, min.freq = 80, random.order = FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          color = brewer.pal(12, "Set3"), rot.per = 0.15, scale = c(10,1.5))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev.off()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print("Wordcloud png file with RColorBrewer has been generated.")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(6) A document term matrix has all the words in the text as columns and each line as rows. If a word appears in the row, it puts 1. To create a word count, you can simply aggregate it by columns. The wordcloud function takes column names and column sum as argument instead of corpus as below.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">png("wordcloud_on_the_road2.png", width=1280,height=800)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">color_vector1 &lt;- sample(colors, 20)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wordcloud(corpus, max.words = 100, min.freq = 80, random.order = FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          color = brewer.pal(12, "Set3"), rot.per = 0.15, scale = c(10,1.5))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev.off()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print("Wordcloud png file with RColorBrewer has been generated.")</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can sort the aggregated data frame to check if the word cloud looks right according to word frequencies.</p>
<p><img decoding="async" loading="lazy" alt="word count example" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/dtm_df_sum-c04531c07173a9bafaf26774dc427390.webp" width="299" height="160" class="img_ev3q"></p>
<p>I also use it to determin the min.freq parameter. 89 words exist for more than 80 frequencies. Hence, I used 80 as min.freq. Each text is different and it is best to check it so that you don’t miss out on words.</p>
<p>Creating DTM is the first step for machine learning on text data (but make sure to include stemming, which is the step I skipped for the word cloud).</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">frequencies &lt;- DocumentTermMatrix(corpus)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtm_df &lt;- as.data.frame(as.matrix(frequencies))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtm_df_sum &lt;- as.data.frame(apply(dtm_df, 2, sum))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colnames(dtm_df_sum) &lt;- c("Frequency_Count")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">words &lt;- rownames(dtm_df_sum)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rownames(dtm_df_sum) &lt;- NULL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtm_df_sum &lt;- cbind(dtm_df_sum, words)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dtm_df_sum &lt;- dtm_df_sum[order(dtm_df_sum$Frequency_Count, decreasing=T),]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nrow(subset(dtm_df_sum, Frequency_Count &gt;= 100))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nrow(subset(dtm_df_sum, Frequency_Count &gt;= 80))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nrow(subset(dtm_df_sum, Frequency_Count &gt;= 50))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here are the word cloud I generated. Most of the books, you will see the characters’ name appearing as the most frequently used word. As expected, you can see dean as the biggest word as the story is centred on the madman, Dean Moriarty. The word cloud sort of makes sense to me. A lot of talking in the book, hence said is the second most frequently used word. Dean always goes back or comes back, hence back comes third. They are always on the move traveling across America, hence the words like went, going, see, around, road, car, way, people, girls, everybody and miles are frequently used words. This is so cool!</p>
<p>Custom Colour</p>
<p><img decoding="async" loading="lazy" alt="word cloud 1" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/word-cloud-1-1ac19ac3e270143457c0d3fd8bc95f00.webp" width="673" height="589" class="img_ev3q"></p>
<p>RColorBrewer (Set3)</p>
<p><img decoding="async" loading="lazy" alt="word cloud 2" src="https://takahirohonda.github.io/mydatahack-old-blog/assets/images/word-cloud-2-4becd7076c880c2d81471caa6da24b9d.webp" width="785" height="696" class="img_ev3q"></p>
<p>I prefer using my own colour selections than any of the RColorBrewer palette as the palette sometimes give me the colours that are hard to read!</p>
<p>Now it’s your turn to create a word cloud for your favourite book!</p>
<p>The next step is learning how to do sentiment analysis on your favourite book!</p>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="R" term="R"/>
        <category label="Text Analytics" term="Text Analytics"/>
        <category label="Word Cloud" term="Word Cloud"/>
        <category label="Visualisation" term="Visualisation"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How To Customise ShinyApp With Bootstrap, Javascript And Plotly]]></title>
        <id>https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-customise-shinyapp-with-bootstrap-css-javascript-and-plotly</id>
        <link href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-customise-shinyapp-with-bootstrap-css-javascript-and-plotly"/>
        <updated>2017-12-22T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[What is the easiest way to make a data science product? My answer is to use Shiny. You can code both front-end and server-side in R to create beautiful interactive web applications.  You don’t even need to know any HTML. Shiny server is free, too. You sign up and get it started right away! Check out the shiny gallery for inspiration. To learn Shiny, there are heaps of online tutorials like this one.]]></summary>
        <content type="html"><![CDATA[<p>What is the easiest way to make a data science product? My answer is to use Shiny. You can code both front-end and server-side in R to create beautiful interactive web applications.  You don’t even need to know any HTML. Shiny server is free, too. You sign up and get it started right away! Check out the shiny gallery for inspiration. To learn Shiny, there are heaps of online tutorials like this one.</p>
<p>In my opinion, this is the area where the hurdle is higher for Python. Python doesn’t really have a specific framework to create data visualisation apps that run on a web server. Sure, you can use Django or Flask, but you really need to study web development before making anything. Most of us are interested in analysing data and delivering insights, not becoming a full-stack web developer. Shiny really enables us to focus on data analysis and insights creation rather than worrying about the web technologies.</p>
<p>Having said that, Shiny has its own limitations. It is not for creating a complex web application as you are coding the server-side with R. Certainly, this is not for an e-commerce platform. It is most suited for a one page web app with R logic behind it. If you are only coding the front-end with R, you will soon hit the wall in terms of how the page looks.</p>
<p>To customise Shiny App UI, the best approach is to use your own HTML, CSS and Javascripts. In this hack, I will show you how to customise ShinyApp UI with minimal effort. I will also show you how to make plotly work with custom HTML and import your own images, too.</p>
<p>Plotly API enables you to make your R visualisation interactive. R graphs produced by plot() function, for example, is just an image without interactivity. Plotly uses Javascript to make it interactive in both web browsers and R Studio viewer.</p>
<p>To use plotly, you can simply pass the data and parameters to the plot_ly() function. See the difference it makes even with such a simple scatter graph.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(plotly)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data(mtcars)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (1) Basic scatter graph with R plot function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot(mtcars$mpg, mtcars$hp, col='red', pch=16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (2) With plotly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot_ly(mtcars, x = ~mpg, y = ~hp)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>What makes Plotly even more powerful is that you can use it on top of ggplot. Plotly has a function called ggplotly which takes a ggplot function as an argument. This means you can create a complex visualisation with ggplot first and then simply pass the function to ggplotly() for interactivity. It’s the ggplot on steroids. Check out how easily this can be done.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(ggplot)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot &lt;- ggplot(data=mtcars, aes(x=mpg, y=hp)) + geom_point(color='purple')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (1) Scatter plot with ggplot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (2) Scatter plot with ggplot and plotly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ggplotly(plot)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As an example, I created the <a href="https://portf.shinyapps.io/diamondplotly/" target="_blank" rel="noopener noreferrer">diamond price predictor</a> app that predicts diamond price based on carat, cut, color and clarity by using diamond dataset that comes with base R. You probably need to press ‘Reload’ as the free version of Shiny server goes to sleep if it’s not in use. It also uses plotly for plot interactivity. There are a few tricks to customise your UI with HTML, CSS and make Plotly work on the customised UI.</p>
<p>The summary of the steps are:</p>
<p>Create the app with ui.R and server.R first.
Run it in the browser (Run App and Open in the browser) from R Studio and get HTML code by viewing the page source from the browser
Create a new folder structure that allows you to import your own images, CSS and Javascript.
Add images, CSS and Javascript files in the respective folder.
Edit the html file and save it as index.html in the app folder.
Deploy</p>
<p><strong>Steps</strong></p>
<p>(1) Create the app with ui.R, server.R, and global.R. I recommend to use global.R for package import. It makes package management easy. The basic UI look like this.</p>
<p><code>ui.R</code></p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shinyUI(fluidPage(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  titlePanel("Diamond Price"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sidebarLayout(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sidebarPanel(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      numericInput('carat', 'Enter Carat', min=0.1, max=5.0, step=0.1, value=1.0),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      selectInput('cut', 'Choose Cut', c('Ideal'='Ideal', "Premium"="Premium", "Very Good"="Very Good", "Good"="Good", "Fair"="Fair"),selected='Premium'),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      selectInput('color', 'Choose Color', c("J"="J", "I"="I", "H"="H", "G"="G", "F"="F", "E"="E", "D"="D"),selected='H'),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      selectInput('clarity', 'Choose Clarity', c("IF"="IF", "vvS1"="vvS1", "vvs2"="vvs2", "vs1"="vs1", "vs2"="vs2", "SI1"="SI1", "SI2"="SI2", "I1"="I1"),selected='VS1')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mainPanel(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      h2("Predicted Diamond Price"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      textOutput("predicted"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      h2("Plot Output"),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      plotlyOutput('plot')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>server.R</code></p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">shinyServer(function(input, output){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data(diamonds)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  output$plot &lt;- renderPlotly({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    carat_val = input$carat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cut_val = input$cut</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    color_val = input$color</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clarity_val = input$clarity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df &lt;- subset(diamonds, cut==cut_val &amp; color==color_val &amp; clarity==clarity_val)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model &lt;- loess(price ~ carat, df)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    predicted_price &lt;- predict(model, newdata=data.frame(carat=carat_val))[[1]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output$predicted &lt;- renderText({paste("$",round(predicted_price))})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plot &lt;- ggplot(data=df, aes(x=carat, y=price, alpha=0.5)) + geom_point(color="red") + geom_smooth(method="loess", color='green', alpha=0.5, size=0.7, se=F) +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      geom_point(x=carat_val, y=predicted_price, shape=3, color='blue', fill='blue', size=2.5, alpha=0.5) + ylab("$")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ggplotly(plot)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>global.R</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(shiny)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(require(UsingR)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print('Loading UsingR')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install.packages("UsingR")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if(require(UsingR)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print('Loading UsingR')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'Failed to install UsingR'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(require(ggplot2)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print('Loading ggplot2')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install.packages("ggplot2")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if(require(ggplot2)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print('Loading ggplot2')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'Failed to install ggplot2'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(require(plotly)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  print('Loading plotly')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  install.packages('plotly')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if(require(plotly)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print('Loading plotly')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    'Failed to install plotly'</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(2) Run the app and view the source code in the browser and get the source code and save it as index.html.</p>
<p>(3) Create a new folder structure. The app folder name becomes your app name when you deploy it to the server. In this case, I have an app folder called <code>diamondploty</code>. Within the main folder, create the www folder. Inside it, create img, plotly and style folder.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - plotly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - style</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(4) I have two header images for dynamic content. When it is viewed on mobile screen, the header image changes (you can try to scale down the browser width to see if the header image changes).</p>
<p>For CSS, I grabbed a customised bootstrap theme from . You can choose whichever theme you want to use and download it. Save the file in the style folder. This CSS will replace the default CSS in Shiny.</p>
<p>To make Plotly work with custom HTML, you need to add 3 Javascript files and 1 css file in the plotly folder. If you are using ui.R, you don’t need to import them. But, once you start using custom HTML, these files are required.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">htmlwidgets.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plogly.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plotly-htmlwidgets.css</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plotly-lastes.min</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You will find these files from the R library folder. Check your library path with .libPath(). You can either manually copy these files or use copy command from cmd or Unix equivalent. Make sure to copy them instead of moving them (mistake I have made so many times)!</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">copy &lt;app folder&gt;\www\plotly &lt;R lib path&gt;\htmlwidgets\www\htmlwidgets.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy &lt;app folder&gt;\www\plotly &lt;R lib path&gt;\plotly\htmlwidgets\plotly.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy &lt;app folder&gt;\www\plotly &lt;R lib path&gt;\plotly\htmlwidgets\lib\plotly-latest.min.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">copy &lt;app folder&gt;\www\plotly &lt;R lib path&gt;\plotly\htmlwidgets\lib\plotly-htmlwidgets.css</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can remove ui.R and keep both global.R and server.R. In the end, the app folder should look like this.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - global.R</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - server.R</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- www</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - diamong.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - diamond_small.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - plotly</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - htmlwidgets.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - plotly-htmlwidgets.css</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - plotly-latest.min.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - plotly.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - style</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - bootstrap.css</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(5) Move the html file that you made in Step 2 into www folder. First of all, you need to import files in the plotly folder in the head section as below. In the same way, you can import your own custom Javascript.</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">plotly/htmlwidgets.js</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">link</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">plotly/plotly-htmlwidgets.css</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">rel</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">stylesheet</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">plotly/plotly-latest.min.js</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">plotly/plotly.js</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To import your custom css file, replace the default css bootstrap link element with your own.</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- &lt;link href="shared/bootstrap/css/bootstrap.min.css" rel="stylesheet" /&gt; --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">link</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">style/bootstrap.css</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">rel</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">stylesheet</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the head section, you can also add your own style and java script.</p>
<p>Shiny UI uses bootsrap. The default class for the page div is set to “container-fluid”. This is the reason why you see the app wide. I changed this class to “container” so that I can have the app uses better looking width.</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">container</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">"</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">height</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:#36acaa">100</span><span class="token tag special-attr attr-value value css language-css unit" style="color:#e3116c">%</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For the rest, I updated HTML as I see fit. For example, I am making buttons more exciting by adding btn class to utilise bootstrap. I also added links for terms definition. I also have my own custom CSS and Javascript in the head section.</p>
<p>(6) Once you are happy with the look, you can deploy it. Deployment is the easiest part of Shiny. The rsconnect package will take care of everything. You can get the authentication credentials from the website. You can either run code below or hit Publish on R Studio. You can check deployment instruction for further details.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">install.packages('rsconnect')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(rsconnect)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rsconnect::setAccountInfo(name=&lt;&gt;;, token=&lt;&gt;;, secret=&lt;&gt;;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployApp()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now you have your own shiny Shiny App.</p>
<p>Epic!</p>]]></content>
        <category label="Data Science" term="Data Science"/>
        <category label="App" term="App"/>
        <category label="R" term="R"/>
        <category label="Shiny" term="Shiny"/>
        <category label="Visualisation" term="Visualisation"/>
    </entry>
</feed>