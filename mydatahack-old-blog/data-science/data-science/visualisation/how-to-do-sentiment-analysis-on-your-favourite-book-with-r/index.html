<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-data-science" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">How To Do Sentiment Analysis On Your Favourite Book With R | MyDatahack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="How To Do Sentiment Analysis On Your Favourite Book With R | MyDatahack"><meta data-rh="true" name="description" content="I love dissecting and analysing my favourite books by reading them again and again, discussing them with my like-minded friends, getting to know the authors and reading other people’s writings about them.  My obsession with books lead me to thinking, how can I visualise them in interesting ways? Making Word Cloud is an easy and fun way to visualise your favourite book as in the previous post. In this post, we will go down deeper into the world of text analytics by using sentiment analysis. I will show you how to split the text by sentence, conduct sentence-wise sentiment analysis and create an interactive plot that shows how sentiment changes as the story progresses."><meta data-rh="true" property="og:description" content="I love dissecting and analysing my favourite books by reading them again and again, discussing them with my like-minded friends, getting to know the authors and reading other people’s writings about them.  My obsession with books lead me to thinking, how can I visualise them in interesting ways? Making Word Cloud is an easy and fun way to visualise your favourite book as in the previous post. In this post, we will go down deeper into the world of text analytics by using sentiment analysis. I will show you how to split the text by sentence, conduct sentence-wise sentiment analysis and create an interactive plot that shows how sentiment changes as the story progresses."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2018-01-03T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="Data Science,R,Sentiment Analysis,Text Analytics Visualisation"><link data-rh="true" rel="icon" href="/mydatahack-old-blog/img/icon-circle.png"><link data-rh="true" rel="canonical" href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r"><link data-rh="true" rel="alternate" href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r" hreflang="en"><link data-rh="true" rel="alternate" href="https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r","mainEntityOfPage":"https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r","url":"https://takahirohonda.github.io/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r","headline":"How To Do Sentiment Analysis On Your Favourite Book With R","name":"How To Do Sentiment Analysis On Your Favourite Book With R","description":"I love dissecting and analysing my favourite books by reading them again and again, discussing them with my like-minded friends, getting to know the authors and reading other people’s writings about them.  My obsession with books lead me to thinking, how can I visualise them in interesting ways? Making Word Cloud is an easy and fun way to visualise your favourite book as in the previous post. In this post, we will go down deeper into the world of text analytics by using sentiment analysis. I will show you how to split the text by sentence, conduct sentence-wise sentiment analysis and create an interactive plot that shows how sentiment changes as the story progresses.","datePublished":"2018-01-03T00:00:00.000Z","author":[],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://takahirohonda.github.io/mydatahack-old-blog/data-science","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/blog/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/blog/atom.xml" title="MyDatahack Atom Feed">



<link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/web-technologies/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/web-technologies/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/data-engineering/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/data-engineering/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/data-science/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/data-science/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/infrastructure/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/infrastructure/atom.xml" title="MyDatahack Atom Feed"><link rel="stylesheet" href="/mydatahack-old-blog/assets/css/styles.2668ea1a.css">
<script src="/mydatahack-old-blog/assets/js/runtime~main.1231c025.js" defer="defer"></script>
<script src="/mydatahack-old-blog/assets/js/main.b1412c70.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mydatahack-old-blog/"><div class="navbar__logo"><img src="/mydatahack-old-blog/img/icon-circle.png" alt="MyDatahack Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/mydatahack-old-blog/img/icon-circle.png" alt="MyDatahack Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">MyDatahack</b></a><a class="navbar__item navbar__link" href="/mydatahack-old-blog/mydatahack-old-blog/">Blogs</a><a class="navbar__item navbar__link" href="/mydatahack-old-blog/web-technologies">Web Technologies</a><a class="navbar__item navbar__link" href="/mydatahack-old-blog/data-engineering">Data Engineering</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mydatahack-old-blog/data-science">Data Science</a><a class="navbar__item navbar__link" href="/mydatahack-old-blog/infrastructure">Infrastructure</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/takahirohonda" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/deep-learning/building-alexnet-with-keras">Building AlexNet with Keras</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/deep-learning/building-alexnet-with-tensorflow-and-running-it-with-aws-sagemaker">Building AlexNet with TensorFlow and Running it with AWS SageMaker</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/deep-learning/introduction-to-dense-net-with-keras/">Introduction to Dense Layers for Deep Learning with Keras</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/deep-learning/introduction-to-dense-net-with-tensorflow">Introduction to Dense Layers for Deep Learning with TensorFlow</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/infra/how-to-create-your-personal-data-science-computing-environment-in-aws">How To Create Your Own Personal Data Science Computing Environment In AWS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-python">Predict Internet Popularity By Optimising Neural Networks With Python</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/machine-learning/predict-internet-popularity-by-optimising-neural-networks-with-r">Predict Internet Popularity By Optimising Neural Networks With R</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/machine-learning/how-to-save-machine-learning-models-in-r">How To Save Machine Learning Models In R</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/infra/how-to-deploy-spark-applications-in-aws-with-emr-and-data-pipeline">How To Deploy Spark Applications In AWS With EMR and Data Pipeline</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/mydatahack-old-blog/data-science/data-science/visualisation/how-to-do-sentiment-analysis-on-your-favourite-book-with-r">How To Do Sentiment Analysis On Your Favourite Book With R</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/visualisation/how-to-create-a-word-cloud-for-your-favourite-book-with-r">How To Create a Word Cloud For Your Favourite Book With R</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/mydatahack-old-blog/data-science/data-science/visualisation/how-to-customise-shinyapp-with-bootstrap-css-javascript-and-plotly">How To Customise ShinyApp With Bootstrap, Javascript And Plotly</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">How To Do Sentiment Analysis On Your Favourite Book With R</h1><div class="container_mt6G margin-vert--md"><time datetime="2018-01-03T00:00:00.000Z">January 3, 2018</time> · <!-- -->8 min read</div></header><div id="__blog-post-container" class="markdown"><p>I love dissecting and analysing my favourite books by reading them again and again, discussing them with my like-minded friends, getting to know the authors and reading other people’s writings about them.  My obsession with books lead me to thinking, how can I visualise them in interesting ways? Making Word Cloud is an easy and fun way to visualise your favourite book as in the previous post. In this post, we will go down deeper into the world of text analytics by using sentiment analysis. I will show you how to split the text by sentence, conduct sentence-wise sentiment analysis and create an interactive plot that shows how sentiment changes as the story progresses.</p>
<p>There are many different ways to do sentiment analysis. The easiest way is to split the sentence by word and score each word by looking up word sentiment dictionary. The tidytext packages in R has a build in function to do a basic sentiment analysis. The package documentation from CRAN shows sentiment analysis on Jane Austin text. This one with Harry Potter is also fun to read. For more advanced Natural Language Processing (NLP), you can use Stanford CoreNLP, which is very powerful, but cumbersome to use and can be slow at a time.</p>
<p>In this post, I am using sentimentr. The package is fast and super easy to use. It does sentence-wise sentiment analysis by using dictionary lookup and valence shifter. With valence shifter, it updates the normal word sentiment dictionary look up score with the score by looking at polarised word (such as really or hardly). It reflects the sentiment more accurately than just scoring individual words. It also has the get_sentense function to splice the text into sentences by using regular expressions.</p>
<p>The <code>sentimentr</code> package really makes sentiment analysis pop and accessible. I really love using it.</p>
<p>Sentence analysis on literature is hard because of slang, unconventional style and expressions, unambiguous sentence separation, sarcasms, jokes and so on. Despite the outcome is not perfect, you’ll have a lot of fun!</p>
<p>As the continuation from the previous post, I am using one of my favourite book, On The Road by the greatest Beat hero Jack Kerouac.</p>
<p>Ok, let’s code!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="summary-steps">Summary Steps<a href="#summary-steps" class="hash-link" aria-label="Direct link to Summary Steps" title="Direct link to Summary Steps">​</a></h3>
<ol>
<li>Download a pdf file and convert it into text.</li>
<li>Create a data frame with row per sentence and do clean up.</li>
<li>Further split the sentence by get_sentence() and create a new data frame</li>
<li>Get sentiment per sentence.</li>
<li>Plot the sentiment by <code>plotly</code>.</li>
<li>Check the results and have fun!</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a href="#steps" class="hash-link" aria-label="Direct link to Steps" title="Direct link to Steps">​</a></h3>
<p>(1) Get the pdf file of On The Road from <code>freeditorial.com</code> and use <code>pdftools</code> to convert it to text. This step is the same as in the previous post.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(pdftools)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">download.file(&quot;https://freeditorial.com/en/books/on-the-road/downloadbookepub/pdf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;/tmp/on_the_road.pdf&quot;, mode = &quot;wb&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">txt &lt;- pdf_text(&#x27;/tmp/on_the_road.pdf&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(2) Create the first data frame with row by sentence. For sentiment analysis, cleaning up the text has to be a little bit more diligent than just making a word cloud. You just need to look at your text file to determine what is needed. The regular expression is the way to go to clean up the text data. Use online resource for detailed examples as well as a quick reference. Make sure to test your regex with a short example!</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lines &lt;- &#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (i in 2:length(txt)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmp &lt;- gsub(&#x27;\r\n&#x27;, &#x27; &#x27;, txt[i]) # \r\n for Windows, \n for Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lines &lt;- paste(lines, tmp, sep=&#x27; &#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vec &lt;- strsplit(lines, &#x27;\\.&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df &lt;- data.frame(vec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df &lt;- as.data.frame(df[-c(nrow(df), nrow(df)-1), ]) # Remove Last 2 lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colnames(df)[1] = &#x27;line&#x27; # Rename Columns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- gsub(&quot;«&quot;, &quot;&quot;, gsub(&quot;»&quot;, &quot;&quot;, df$line))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- gsub(&#x27;^\\s+PART\\s+[A-Z]+\\s+&#x27;, &#x27;&#x27;, df$line)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- as.character(trimws(df$line, &#x27;both&#x27;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- gsub(&#x27;^[1-5]\\s{2,}&#x27;, &#x27;&#x27;,  df$line)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df$line &lt;- gsub(&#x27;- -, &#x27;, &#x27;&#x27;,df$line)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(3) Further split the sentences by the power of get_sentences function. This step is necessary to get a sentiment score per sentence according to the <code>sentimentr</code> package. The sentiment function in <code>sentimentr</code> may returns more than one sentiment score per sentence if you do not do this.</p>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(sentimentr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentence &lt;- c()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (line in df$line) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmp &lt;- get_sentences(line)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for(i in 1:length(tmp[[1]])) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentence_tmp &lt;- tmp[[1]][i]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentence &lt;- c(sentence, sentence_tmp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr &lt;- data.frame(sentence)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$sentence &lt;- as.character(df_sentr$sentence)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(4) Once your data frame is ready, do the scoring with sentiment(). Add negative, positive and neutral indicator for visualisation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sentiment &lt;- sentiment(df_sentr$sentence)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$sentiment &lt;- as.numeric(sentiment$sentiment)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$pntag &lt;- ifelse(sentiment$sentiment == 0, &#x27;Neutral&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ifelse(sentiment$sentiment &gt; 0, &#x27;Positive&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                ifelse(sentiment$sentiment &lt; 0, &#x27;Negative&#x27;, &#x27;NA&#x27;)))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(5) You can plot it with base R plot function. I like using Plotly because it becomes interactive. The x-axis shows the progress of the story and the y-axis shows the sentiment. Positive, negative and neutral sentiments are colour-coded. Once you hover the mouse over the dot, you can see the sentence. The <code>magrittr</code> package enables the magic of the pipe (%&gt;%) operation.</p>
<ul>
<li>base R plot</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">plot(df_sentr$sentiment, type=&#x27;l&#x27;, pch=3)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>plotly- more fun</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ax &lt;- list(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">title = &quot;Sentence&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zeroline = FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">showline = FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">showticklabels = FALSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(plotly)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">library(magrittr)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot_ly(data = df_sentr, x = ~sentence, y = ~sentiment, color = ~pntag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &#x27;scatter&#x27;, mode = &#x27;markers&#x27;) %&gt;% layout(xaxis = ax)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plot_ly(data = df_sentr, y = ~sentiment, color = ~pntag,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type = &#x27;scatter&#x27;, mode = &#x27;markers&#x27;) %&gt;% layout(xaxis = ax)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Output Example</p>
<p><img decoding="async" loading="lazy" alt="Output" src="/mydatahack-old-blog/assets/images/sentiment-graph-7fdc2d98047ceb7ee287a23f63a87c54.webp" width="941" height="846" class="img_ev3q"></p>
<p>(6) Let’s check what is the most positive and the most negative and calculate the average sentiment score. I also created csv files with sentiment score above 1 and below -1.</p>
<ul>
<li>Check max and min sentiments</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$sentence[which.max(df_sentr$sentiment)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_sentr$sentence[which.min(df_sentr$sentiment)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Get average</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mean(df_sentr$sentiment)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Check positive and negative sentences</li>
</ul>
<div class="language-R language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">check_pos &lt;- subset(df_sentr, df_sentr$sentiment &gt;= 1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_pos &lt;- check_pos[order(check_pos$sentiment, decreasing = T),]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write.csv(check_pos, &quot;positive.csv&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_neg &lt;- subset(df_sentr, df_sentr$sentiment &lt;= -1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_neg &lt;- check_neg[order(check_neg$sentiment, decreasing = F),]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write.csv(check_neg, &quot;negative.csv&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="discussion">Discussion<a href="#discussion" class="hash-link" aria-label="Direct link to Discussion" title="Direct link to Discussion">​</a></h2>
<p>The average sentiment score was 0.024. All the highs and lows must have cancelled each other out, coming out slightly positive just like life in general.</p>
<p>The most positive moment in the story according to sentimentr is absolutely gold.</p>
<ul>
<li>
<p>I think Marylou was very, very wise leaving you, Dean, said Galatea</p>
</li>
<li>
<p>Yeah, that’s pretty much the best decision! On a more serious note, this is the prime example of the effect of using valence shifter in the sentiment algorithm. It has two positive polarised words (very, very) on a positive word (wise). Very twice really amplified the positive sentiment on this sentence.</p>
</li>
<li>
<p>Not sure about the most negative one. But, this is also the fun part, getting misplaced sentiment by an algorithm.</p>
</li>
<li>
<p>He showed me rooming houses where he stayed, railroad hotels, poolhalls, diners, sidings where he jumped off the engine for grapes, Chinese restaurants where he ate, park</p>
</li>
</ul>
<p>Looking at the results, I think it performed well overall despite questionable sores here and there. To be fair, On The Road is a difficult one to run sentiment algorithm because it is written in a stream-of-consciousness style with many unique expressions and unclear sentence break points.</p>
<p>Here are the top 6 positive sentences. No.2 is the classic Dean Moriarty haunted by his own madness. No.4 and 5 are questionable. No.6 is absolutely yes, I think.</p>
<ol>
<li>I think Marylou was very, very wise leaving you, Dean, said Galatea</li>
<li>Hmm, ah, yes, excellent, splendid, harrumph, egad!</li>
<li>It certainly was pleasant, said Hingham, looking away</li>
<li>Doll, Dorothy and Roy Johnson, a girl from Buffalo, Wyoming, who was Dorothy’s friend, Stan, Tim Gray, Babe, me, Ed Dunkel, Tom Snark, and several others, thirteen in all</li>
<li>There’s one last thing I want to know – But, dear Sal, you’re listening, you’re sitting there, we’ll ask Sal</li>
<li>Absolutely, now, yes?</li>
</ol>
<p>Here are the bottom 6 negative sentences. Yeah, it certainly shows some low moments in the book despite of some questionable entries. No. 5 is another classic Dean Moriarty.</p>
<ol>
<li>He showed me rooming houses where he stayed, railroad hotels, poolhalls, diners, sidings where he jumped off the engine for grapes, Chinese restaurants where he ate, park benches where he met girls, and certain places where he’d done nothing but sit and wait around</li>
<li>There was something paralyzed about his movements, and he did nothing about leaving the doorway, but just stood in it, muttering, Stan, and Don’t go, and looking after us anxiously as we rounded the comer</li>
<li>Then the third day began having a terrible series of waking nightmares, and the were so absolutely horrible and grisly and green that I lay there doubled up with my hands around my knees, saying, ‘Oh, oh, oh, ah, oh</li>
<li>Offisah, I heard Dean say in the most unctuous and ridiculous tones, offisah, I was only buttoning my flah</li>
<li>And the one to my left here, older, more sure of himself but sad</li>
<li>But this foolish gang was bending onward</li>
</ol>
<p>Wow, what a fun I had!</p>
<p>Now, you are ready for sentiment analysis on your favourite book!</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/mydatahack-old-blog/data-science/tags/data-science">Data Science</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/mydatahack-old-blog/data-science/tags/r">R</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/mydatahack-old-blog/data-science/tags/sentiment-analysis">Sentiment Analysis</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/mydatahack-old-blog/data-science/tags/text-analytics-visualisation">Text Analytics Visualisation</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/mydatahack-old-blog/data-science/data-science/infra/how-to-deploy-spark-applications-in-aws-with-emr-and-data-pipeline"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">How To Deploy Spark Applications In AWS With EMR and Data Pipeline</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mydatahack-old-blog/data-science/data-science/visualisation/how-to-create-a-word-cloud-for-your-favourite-book-with-r"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">How To Create a Word Cloud For Your Favourite Book With R</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary-steps" class="table-of-contents__link toc-highlight">Summary Steps</a></li><li><a href="#steps" class="table-of-contents__link toc-highlight">Steps</a></li><li><a href="#discussion" class="table-of-contents__link toc-highlight">Discussion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mydatahack-old-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/takahirohonda" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 MDH.</div></div></div></footer></div>
</body>
</html>