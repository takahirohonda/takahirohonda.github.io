<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-data-ingestion/lambda-s3-s3-python" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Event-Driven Data Ingestion with AWS Lambda (S3 to S3) | MyDatahack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://takahirohonda.github.io/mydatahack-old-blog/docs/data-ingestion/lambda-s3-s3-python"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Event-Driven Data Ingestion with AWS Lambda (S3 to S3) | MyDatahack"><meta data-rh="true" name="description" content="Let’s say you have data coming into S3 in your AWS environment every 15 minutes and want to ingest it as it comes. The best approach for this near real-time ingestion is to use AWS lambda function. To demonstrate how to develop and deploy lambda function in AWS, we will have a look at a simple use case of moving file from source S3 to target S3 as the file is created in the source."><meta data-rh="true" property="og:description" content="Let’s say you have data coming into S3 in your AWS environment every 15 minutes and want to ingest it as it comes. The best approach for this near real-time ingestion is to use AWS lambda function. To demonstrate how to develop and deploy lambda function in AWS, we will have a look at a simple use case of moving file from source S3 to target S3 as the file is created in the source."><link data-rh="true" rel="icon" href="/mydatahack-old-blog/img/icon-circle.png"><link data-rh="true" rel="canonical" href="https://takahirohonda.github.io/mydatahack-old-blog/docs/data-ingestion/lambda-s3-s3-python"><link data-rh="true" rel="alternate" href="https://takahirohonda.github.io/mydatahack-old-blog/docs/data-ingestion/lambda-s3-s3-python" hreflang="en"><link data-rh="true" rel="alternate" href="https://takahirohonda.github.io/mydatahack-old-blog/docs/data-ingestion/lambda-s3-s3-python" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/blog/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/blog/atom.xml" title="MyDatahack Atom Feed">



<link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/web-technologies/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/web-technologies/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/data-engineering/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/data-engineering/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/data-science/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/data-science/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/mydatahack-old-blog/infrastructure/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/mydatahack-old-blog/infrastructure/atom.xml" title="MyDatahack Atom Feed"><link rel="stylesheet" href="/mydatahack-old-blog/assets/css/styles.2668ea1a.css">
<script src="/mydatahack-old-blog/assets/js/runtime~main.65edbf1e.js" defer="defer"></script>
<script src="/mydatahack-old-blog/assets/js/main.ffa8a442.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mydatahack-old-blog/"><div class="navbar__logo"><img src="/mydatahack-old-blog/img/icon-circle.png" alt="MyDatahack Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/mydatahack-old-blog/img/icon-circle.png" alt="MyDatahack Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">MyDatahack</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mydatahack-old-blog/docs/">Blogs</a><a class="navbar__item navbar__link" href="/mydatahack-old-blog/web-technologies">Web Technologies</a><a class="navbar__item navbar__link" href="/mydatahack-old-blog/data-engineering">Data Engineering</a><a class="navbar__item navbar__link" href="/mydatahack-old-blog/data-science">Data Science</a><a class="navbar__item navbar__link" href="/mydatahack-old-blog/infrastructure">Infrastructure</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/takahirohonda" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mydatahack-old-blog/docs/">index</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mydatahack-old-blog/docs/category/etl">ETL</a><button aria-label="Expand sidebar category &#x27;ETL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/mydatahack-old-blog/docs/category/data-ingestion">Data Ingestion</a><button aria-label="Collapse sidebar category &#x27;Data Ingestion&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/s3-data-node-1">Event-Driven S3 Data Ingestion With Node.js Lambda Function and Deploy it with Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/s3-data-ruby">Uploading and Downloading Files in S3 with Ruby</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/s3-data-node-2">Uploading and Downloading Files in S3 with Node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/mongo-node-1">How to Ingest Data Into MongoDB with Node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/mong-node-2">How to Ingest Data From MongoDB with Node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/rest-api-node">REST API Data Ingestion with Node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/json-to-csv-to-pg-node">Converting JSON to CSV and Loading it to Postgres with Node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/csv-to-json-pg-node">Converting CSV to JSON and Loading it to Postgres with Node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/bulk-load-pg-node">Bulk Loading Postgres with Node.js</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/json-with-python">A Comprehensive Guide for Reading and Writing JSON with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/fullstory-data-python">How to Ingest FullStory Data Export Extracts with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/jdbc-python">How to Bulk Load Data with JDBC and Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/odbc-python">How to Bulk Load Data with ODBC and Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/mysql-python">How to Bulk Load Data into MySQL with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/pg-python">How to Bulk Load Data into PostgreSQL with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/lambda-s3-rds-python">Event-Driven Data Ingestion with AWS Lambda (S3 to RDS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/lambda-s3-s3-python">Event-Driven Data Ingestion with AWS Lambda (S3 to S3)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/s3-python">Comprehensive Guide to Download Files From S3 with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/pg-json">New JSON Data Ingestion Strategy by Using the Power of Postgres</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/aes-encrypted-data-python">How To Ingest AES Encrypted Data With Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/convert-non-utc-to-unix-python">How To Convert Non-UTC Timestamp Into UNIX Epoch Time In Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/monog-python">How To Get Data From MongoDB With Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/liveperson-data-r">How To Get Data From Liveperson And Create Aggregated Table With R</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/liveperson-python">How To Ingest Data From Liveperson With Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/sharepoint-python">How To Get Data From SharePoint With Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/qualtrics-python">How To Get Survey Response Data From Qualtrics With Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/s3-redshift-py">Data Engineering in S3 and Redshift with Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/ga-py">How To Get Data From Google Analytics With Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/facebook-py">How To Get Facebook Data With Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mydatahack-old-blog/docs/data-ingestion/twitter-py">How To Get Twitter Data With Python</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mydatahack-old-blog/docs/category/infrastructure">Infrastructure</a><button aria-label="Expand sidebar category &#x27;Infrastructure&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mydatahack-old-blog/docs/category/web">Web</a><button aria-label="Expand sidebar category &#x27;Web&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mydatahack-old-blog/docs/category/git">Git</a><button aria-label="Expand sidebar category &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mydatahack-old-blog/docs/category/chatgpt-generated">ChatGPT Generated</a><button aria-label="Expand sidebar category &#x27;ChatGPT Generated&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/mydatahack-old-blog/docs/doc-example/intro">doc-example</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mydatahack-old-blog/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/mydatahack-old-blog/docs/category/data-ingestion"><span itemprop="name">Data Ingestion</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Event-Driven Data Ingestion with AWS Lambda (S3 to S3)</span><meta itemprop="position" content="2"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>Event-Driven Data Ingestion with AWS Lambda (S3 to S3)</h1>
<p>Let’s say you have data coming into S3 in your AWS environment every 15 minutes and want to ingest it as it comes. The best approach for this near real-time ingestion is to use AWS lambda function. To demonstrate how to develop and deploy lambda function in AWS, we will have a look at a simple use case of moving file from source S3 to target S3 as the file is created in the source.</p>
<p>AWS lambda supports a few different programming languages. I will use Python for this example. To deploy lambda functions, you need to package the modules used in the function. For some reason, modules downloaded and packaged from Windows sometimes do not work (e.g. pyscopg2 never works even if I download the binary version). From my experience, Python lambda development is the best to be done in Linux or Mac.</p>
<p>In this example, we will use Amazon Linux EC2 instance to develop the package and deploy it from there. You can of course use your local Mac or Linux machine for this.</p>
<p>To deploy lambda functions, I usually use the deployment framework called Serverless, which makes deployment much easier. Here, I would like to use the manual deployment from the AWS documentation here. Doing the deployment manually will teach you how the lambda function works. I think it is good to try it at least once before using more automated solutions.</p>
<p>We will also cover the topic on setting the environment variables in order not to hard-code the parameters that change between environments (e.g. database connection url, access details, or bucket names).</p>
<p>Summary Steps</p>
<p>Launch Linux EC2 instance
Install Python 3 and create virtual environment
Install required packages
Code Lambda function
Package function &amp; modules into a zip file
Create Lambda Function Role
Deploy Lambda
Test function manually
Configure S3 source bucket as event source
Execute the function by pushing file to the source bucket
Steps</p>
<p>(1) Launch a Linux EC2 Instance</p>
<p>Micro instance is usually good enough for developing lambda function. After deployment, you can terminate the instance. Make sure to choose the right security group and subnet so that the instance can access the appropriate resources.</p>
<p>(2) Install Python 3 and create virtual environment</p>
<p>This step and the next step can be bootstrapped (How to Launch EC2 With Bootstrap in AWS). For Centos, Redhat or Amazon Linux, follow the steps here: How to Install Python 3 and Create Virtual Environment in Centos, Redhat and Amazon Linux. For Ubuntu, follow the steps here: How to Install Python 3 and Create Virtual Environment In Ubuntu.</p>
<p>(3) Install required packages</p>
<p>Make sure to activate the virtual environment where you want to develop the lambda function. The installed packages will be in the site-packages folder. You need to pack all the site-packages content into a zip file. AWS SDK for Python (like boto3 or botocore) is pre-installed for Lambda function and you do not need to pack them. Although we do not use any other package for this code example, let’s pack psycopg2 and import it in the function to make sure the packaged modules work.</p>
<p>Note that you need to install the binary version for psycopg2.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source your-virtual-environment-path/activate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install psycopg2-binary</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(4) Code Lambda Function</p>
<p>The PUT API call to the source S3 is the event to trigger the function. In Python, the event data is processed as dictionary. See how the input file looks in the AWS documentation here. Make sure to change the parameter for your environment. Save this as inputFile.txt.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;Records&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;eventVersion&quot;: &quot;2.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;eventSource&quot;: &quot;aws:s3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;awsRegion&quot;: &quot;us-west-2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;eventTime&quot;: &quot;1970-01-01T00:00:00.000Z&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;eventName&quot;: &quot;ObjectCreated:Put&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;userIdentity&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;principalId&quot;: &quot;AIDAJDPLRKLG7UEXAMPLE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;requestParameters&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sourceIPAddress&quot;: &quot;127.0.0.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;responseElements&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;x-amz-request-id&quot;: &quot;C3D13FE58DE4C810&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;x-amz-id-2&quot;: &quot;FMyUVURIY8/IgAtTv8xRjskZQpcIZ9KG4V5Wp6S7S/JRWeUWerMUE5JgHvANOjpD&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;s3&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;s3SchemaVersion&quot;: &quot;1.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;configurationId&quot;: &quot;testConfigRule&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;bucket&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;name&quot;: &quot;sourcebucket&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;ownerIdentity&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;principalId&quot;: &quot;A3NL1KOZZKExample&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;arn&quot;: &quot;arn:aws:s3:::sourcebucket&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;object&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;key&quot;: &quot;HappyFace.jpg&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;size&quot;: 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;eTag&quot;: &quot;d41d8cd98f00b204e9800998ecf8427e&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;versionId&quot;: &quot;096fKKXTRTtl3on89fVO.nfljtsv6qko&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>From the event input, you can grab bucket name and key to specify the newly created file in the source bucket.</p>
<p>The function grab the data from S3 and copy to a local tmp folder. Then, push it back to the target bucket. You can add transformation logic here if you need to.</p>
<p>Note that the target bucket name is taken from the environment variable. When we call the create lambda function API, we can set it. Alternatively, you can do it from the management console. This is recommended for the values that change between environment like database connection or access credentials. Make sure to import os to get environment variables.</p>
<p>PaAWS documentation about setting environment variables in Lambda functions is here. It uses Node.js as an example. It is the same in Python. You can also check out the blog about setting environment variables for Python here.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> boto3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> botocore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> psycopg2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> boto3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;s3&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">upload_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target_bucket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;targetBucket&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">upload_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Filename</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">local_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Bucket</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">target_bucket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Completed Uploading {} to {}/{}&#x27;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target_bucket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> record </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;Records&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bucket_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> record</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;s3&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;bucket&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> record</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;s3&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;object&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;key&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        local_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/tmp/&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">split</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">download_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bucket_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> local_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Downloaded s3 file, {}, to {}&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> local_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        upload_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">local_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once the function is created, use the input file (inputFile.txt) to test the function. You can add this for local testing.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">f </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;inputFile.txt&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;r&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_bucket </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;lambda.test.target&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">download_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;hello&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(5) Package function &amp; modules into a zip file</p>
<p>Now that your function is working, you can package the modules and code. You need to go to the site-packages folder for your virtual environment first then pack all the modules and then pack the python file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /home/ec2-user/python3/lambda/lib/python3.6/site-packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zip -r9 /tmp/MoveS3Data.zip *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zip -g MoveS3Data.zip MoveS3Data.py</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(6) Create Lambda Function Role</p>
<p>By using IAM, you need to create a role for Lambda function. Follow the steps in the documentation here.</p>
<p>(7) Deploy Lambda</p>
<p>Once you have the zip file and lambda role, you can deploy the function. Make sure that you have the correct role and region selected. Handler has to be your-python-file-name.main-function-name.</p>
<p>This is where you can define environment variables. In this example, we are getting the target bucket name from the environment variable.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /tmp/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws lambda create-function \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--region ap-southeast-2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--function-name MoveS3Data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--zip-file fileb://MoveS3Data.zip \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--role arn:aws:iam::&lt;account number&gt;:role/lambda-s3-test \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--environments Variables={targetBucket=lambda.test.target} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--handler MoveS3Data.handler \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--runtime python3.6 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--timeout 10 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--memory-size 1024</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you want to update the existing function, run the update script.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws lambda update-function-code \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--function-name MoveS3Data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--region ap-southeast-2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--zip-file fileb://MoveS3Data.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If you want to update the list of environment variables, run the update config script.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws lambda update-function-configuration \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--function-name MoveS3Data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--region ap-southeast-2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--environment Variables={targetBucket=lambda.prod.target}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(8) Test the function manually</p>
<p>When your deployment is successful, invoke the function with the input file (inputFile.txt) set as payload.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws lambda invoke \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--invocation-type Event \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--function-name MoveS3Data \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--region ap-southeast-2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--payload file://inputFile.txt \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outputfile.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(9) Configure S3 source bucket as event source</p>
<p>First of all, you need to add the permission to s3 (see here).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws lambda add-permission \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --function-name &lt;your function name&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region &lt;your region&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --statement-id Id-123 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --action &quot;lambda:InvokeFunction&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --principal s3.amazonaws.com \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --source-arn arn:aws:s3:::&lt;source-bucket&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --source-account &lt;account number&gt; \</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Go to the source bucket and configure event as below. In this example, my source bucket is lambda.test.source.</p>
<p>(10) Execute the function by pushing file to the source bucket</p>
<p>Let’s push a file to S3 with AWS console and check if the function moved the data into the target bucket. Here is the s3 copy command reference.</p>
<p>aws s3 cp your_file_name.json s3://lambda.test.source/2018-03-01/your_file_name.json
You can check the execution outcome in CloudWatch, too.</p>
<p>Yay!</p>
<p>(2018-03-04)</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mydatahack-old-blog/docs/data-ingestion/lambda-s3-rds-python"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Event-Driven Data Ingestion with AWS Lambda (S3 to RDS)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mydatahack-old-blog/docs/data-ingestion/s3-python"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Comprehensive Guide to Download Files From S3 with Python</div></a></nav></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mydatahack-old-blog/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/takahirohonda" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 MDH.</div></div></div></footer></div>
</body>
</html>