<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Infrastructure/Miscellaneous/serverless-python" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Advanced AWS Lambda Python Function Deployment with Serverless | MyDatahack</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mydatahack.com/docs/Infrastructure/Miscellaneous/serverless-python"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Advanced AWS Lambda Python Function Deployment with Serverless | MyDatahack"><meta data-rh="true" name="description" content="You can deploy lambda functions manually with hard-coded environment variables. But, that is not a good development practice. When we deploy the function to production, the deployment process eliminates the necessity of changing any input parameters or configuration. Serverless is a lambda function deployment tools that enable good development practice by automating packaging and controlling the parameters depending on which environment you are deploying."><meta data-rh="true" property="og:description" content="You can deploy lambda functions manually with hard-coded environment variables. But, that is not a good development practice. When we deploy the function to production, the deployment process eliminates the necessity of changing any input parameters or configuration. Serverless is a lambda function deployment tools that enable good development practice by automating packaging and controlling the parameters depending on which environment you are deploying."><link data-rh="true" rel="icon" href="/img/icon-circle.png"><link data-rh="true" rel="canonical" href="https://mydatahack.com/docs/Infrastructure/Miscellaneous/serverless-python"><link data-rh="true" rel="alternate" href="https://mydatahack.com/docs/Infrastructure/Miscellaneous/serverless-python" hreflang="en"><link data-rh="true" rel="alternate" href="https://mydatahack.com/docs/Infrastructure/Miscellaneous/serverless-python" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="MyDatahack Atom Feed">



<link rel="alternate" type="application/rss+xml" href="/web-technologies/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/web-technologies/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/data-engineering/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/data-engineering/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/data-science/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/data-science/atom.xml" title="MyDatahack Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/infrastructure/rss.xml" title="MyDatahack RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/infrastructure/atom.xml" title="MyDatahack Atom Feed"><link rel="stylesheet" href="/assets/css/styles.2668ea1a.css">
<script src="/assets/js/runtime~main.58181399.js" defer="defer"></script>
<script src="/assets/js/main.498d3b66.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon-circle.png" alt="MyDatahack Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/icon-circle.png" alt="MyDatahack Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">MyDatahack</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Blogs</a><a class="navbar__item navbar__link" href="/web-technologies">Web Technologies</a><a class="navbar__item navbar__link" href="/data-engineering">Data Engineering</a><a class="navbar__item navbar__link" href="/data-science">Data Science</a><a class="navbar__item navbar__link" href="/infrastructure">Infrastructure</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/takahirohonda" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">index</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/etl">ETL</a><button aria-label="Expand sidebar category &#x27;ETL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/data-ingestion">Data Ingestion</a><button aria-label="Expand sidebar category &#x27;Data Ingestion&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/infrastructure">Infrastructure</a><button aria-label="Collapse sidebar category &#x27;Infrastructure&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/aws">AWS</a><button aria-label="Expand sidebar category &#x27;AWS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/dba">DBA</a><button aria-label="Expand sidebar category &#x27;DBA&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/miscellaneous">Miscellaneous</a><button aria-label="Collapse sidebar category &#x27;Miscellaneous&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/local-dynamo-docker">How to Persist Data in Local DynamoDB Docker Container</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/custom-py-module">Create Custom Python Module and Distribute with Git</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/git-dual-auth">How to Set up Dual-Authentication to GitHub and AWS CodeCommit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Infrastructure/Miscellaneous/serverless-python">Advanced AWS Lambda Python Function Deployment with Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/serveless-python-intro">How to Deploy Python Lambda Function with Serverless in AWS (Introduction)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/serverless-docker">Setting up Docker and Serverless Development Environment in Ubuntu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/python-virtual-env">How to Install Python 3 and Create Virtual Environment In Ubuntu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/python-virtual-env-2">How To Install Python 3 and Create Virtual Environment in Centos, Redhat and Amazon Linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/docker-deamon-error">Resolving Docker Deamon Is Not Running Error From Command Prompt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/spark-on-windows">How To Install Apache Spark On Windows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/jupyter-error">How To Resolve Refusing to serve hidden directory, via 404 Error with Jupyter notebook.</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/py-package-text-file">How To Install a List of Python Packages From a Text File</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/package-not-found">Resolving PackageNotFoundError: Packages missing in current channels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Infrastructure/Miscellaneous/customise-py-module">How To Customize Python Module</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/opinions">Opinions</a><button aria-label="Expand sidebar category &#x27;Opinions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/web">Web</a><button aria-label="Expand sidebar category &#x27;Web&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/git">Git</a><button aria-label="Expand sidebar category &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/chatgpt-generated">ChatGPT Generated</a><button aria-label="Expand sidebar category &#x27;ChatGPT Generated&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/doc-example/intro">doc-example</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/infrastructure"><span itemprop="name">Infrastructure</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/miscellaneous"><span itemprop="name">Miscellaneous</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Advanced AWS Lambda Python Function Deployment with Serverless</span><meta itemprop="position" content="3"></li></ul></nav><div class="theme-doc-markdown markdown"><h1>Advanced AWS Lambda Python Function Deployment with Serverless</h1>
<p>You can deploy lambda functions manually with hard-coded environment variables. But, that is not a good development practice. When we deploy the function to production, the deployment process eliminates the necessity of changing any input parameters or configuration. Serverless is a lambda function deployment tools that enable good development practice by automating packaging and controlling the parameters depending on which environment you are deploying.</p>
<p>In the previous post, I wrote a quick deployment guide with Serverless (How to Deploy Python Lambda Fnction with Serverless in AWS). The post was intended to be a quick introduction for Python lambda function deployment. Once you got the basic, it is time for us to dive into the advanced features of this amazing deployment tool.</p>
<p>As an example, let’s use the use case from the previous blog (Event-Driven Data Ingestion with AWS Lambda S3 to RDS). The aim is to ingest S3 data into Postgres RDS trigged by the creation of a file in the source bucket.</p>
<p>Improvement from the previous post</p>
<p>With Serveless, we can improve the manual deployment we did here. Typing lengthy AWS CLI commands is no longer necessary.</p>
<p>Store connection details in Parameter Store and set them as environment variables
Automatically set the permission of the function.
Recursively reference properties in the serveless.yml config file to set parameters for different environments.
Retrieve Security Group IDs and Subnet Ids depending on the environment.
Retrieve correct parameters depending on the environment.
Set the correct source bucket depending on the environment.
Set the correct deployment bucket depending on the environment.
Steps</p>
<p>(1) Create parameters in Parameter Store</p>
<p>You can create parameters from Parameter Store in EC2 dashboard or by using AWS CLI. Parameter Store is a free AWS service where you can manage your parameters (such as connection details or encryption keys).</p>
<p>The key point here is to set the parameter with the prefix for the target environment. For example, <code>dev\_</code> for the development environment. The correct parameter names will be used by the serverless.yml config file depending on the environment.</p>
<p>Let’s use AWS CLI to create parameters. The recommended approach is to encrypt the parameter with AWS managed key.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aws ssm put-parameter --name &quot;dev_db_username&quot; --value &quot;db.username&quot; --type SecureString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ssm put-parameter --name &quot;dev_db_password&quot; --value &quot;db.password&quot; --type SecureString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ssm put-parameter --name &quot;dev_db_name&quot; --value &quot;db.name&quot; --type SecureString</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aws ssm put-parameter --name &quot;dev_db_endpoint&quot; --value &quot;db.endpoint&quot; --type SecureString</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can check your parameters in the console.</p>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="646" height="261" class="img_ev3q"></p>
<p>(2) Set up the correct folder structure</p>
<p>After running the serverless create command, you need to create a proper folder structure. You can set the folders as you like. You will be using the file path to retrieve values from different files in the main config file. My suggestion is to have a config folder with env.yml (for setting environment variable from Parameter Store) and permissions.yml (for setting permissions) with the subfolder vpc containing files for vpc parameters on different environment.</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/serverless-folder-structure-f0a267e7e95fdaae5d4e5ba048ae17a3.webp" width="264" height="245" class="img_ev3q"></p>
<p>(3) Update yml files</p>
<p>The most important point here is that we are using -s parameter to specify which stage (dev or prod). The stage parameter is initially set to tbc, which will be overridden when you call the serverless deploy command.</p>
<p>serverless.yml</p>
<p>This is the main file. It can use the parameter within the file recursively. This is how we propagate the value for which environment. Make sure to get pythonRequirements for Python.</p>
<p>Names for environment, vpc, deployment bucket and source bucket will be changed depending on the environment.</p>
<p>service: move-s3-to-pg</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">custom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">opt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stage</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">provider.stage</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">opt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">region</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">provider.region</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">opt</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">custom.stage</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pythonRequirements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">dockerizePip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">runtime</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> python3.6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">memorySize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tbc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ap</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">southeast</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">file(config/env.yml)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">vpc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">file(config/vpc/$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">custom.env</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.yml)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">iamRoleStatements</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">file(config/permissions.yml)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">deploymentBucket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">custom.env</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.lambda.function.bucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">serverSideEncryption</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AES256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">functions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hello</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> handler.handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">events</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">s3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">bucket</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">custom.env</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.source.lambda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">event</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> s3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">ObjectCreated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> serverless</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">python</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">requirements</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>env.yml</p>
<p>This will retrieve database connection parameters from Parameter Store. Each environment has parameters with the environment prefix.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ENV: ${self:custom.env}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PG_DATABASENAME: ${ssm:${self:custom.env}_db_name~true}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PG_USERNAME: ${ssm:${self:custom.env}_db_username~true}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PG_HOST: ${ssm:${self:custom.env}_db_endpoint~true}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PG_PASSWORD: ${ssm:${self:custom.env}_db_password~true}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>permissions.yml</p>
<p>Adding necessary permission to the function.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- Effect: Allow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - s3:GetObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - s3:ListBucket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - logs:CreateLogGroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - logs:CreateLogStream</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - logs:PutLogEvents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ec2:CreateNetworkInterface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ec2:DescribeNetworkInterfaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ec2:DeleteNetworkInterface</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Resource: &quot;*&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>vpc configuration files</p>
<p>The file name should be the environment name (e.g. dev.yml or prod.yml). Depending on the input parameter in serverless deploy command, it will pick the right vpc configuration based on the file name as specified in the main config file, <code>vpc: ${file(config/vpc/${self:custom.env}.yml)}</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">securityGroupIds:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - sg-xxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subnetIds:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - subnet-xxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - subnet-xxxxxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - subnet-xxxxxxxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>(4) Deploy with stage parameter</p>
<p>The stage parameter sets which environment the function is going to be deployed.</p>
<p><code>sls deploy -s dev</code>
When you are ready for production, you can simply change the stage value.</p>
<p><code>sls deploy -s prod</code></p>
<p>(2018-03-17)</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Infrastructure/Miscellaneous/git-dual-auth"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How to Set up Dual-Authentication to GitHub and AWS CodeCommit</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Infrastructure/Miscellaneous/serveless-python-intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to Deploy Python Lambda Function with Serverless in AWS (Introduction)</div></a></nav></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/takahirohonda" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 MDH.</div></div></div></footer></div>
</body>
</html>