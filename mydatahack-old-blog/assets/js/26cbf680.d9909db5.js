"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[9176],{29008:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var t=s(74848),o=s(28453);const r={sidebar_position:14},i="Sending Email After Form Submission with Node.js",a={id:"Web/Node.js/email-with-nodejs",title:"Sending Email After Form Submission with Node.js",description:"Nodemailer is for sending email without the hustle of writing many lines of code. It uses the existing email services (Outlook, Hotmail, Gmail and so on) to authenticate and send messages. Authentication is done by simply adding your email credentials as a mail option. It also handles various transport protocols (SMTP as default). In this post, we will use the nodemailer module to send email once the express app receives form submission.",source:"@site/docs/Web/Node.js/14.email-with-nodejs.md",sourceDirName:"Web/Node.js",slug:"/Web/Node.js/email-with-nodejs",permalink:"/mydatahack-old-blog/docs/Web/Node.js/email-with-nodejs",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:14,frontMatter:{sidebar_position:14},sidebar:"tutorialSidebar",previous:{title:"Using EditorConfig and ESLint in Node.js Project",permalink:"/mydatahack-old-blog/docs/Web/Node.js/editorconfig-eslint-nodejs"},next:{title:"Website Page Routing with Node.js Express and EJS",permalink:"/mydatahack-old-blog/docs/Web/Node.js/page-routing-nodejs-express-and-ejs"}},d={},l=[];function c(e){const n={code:"code",h1:"h1",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"sending-email-after-form-submission-with-nodejs",children:"Sending Email After Form Submission with Node.js"}),"\n",(0,t.jsx)(n.p,{children:"Nodemailer is for sending email without the hustle of writing many lines of code. It uses the existing email services (Outlook, Hotmail, Gmail and so on) to authenticate and send messages. Authentication is done by simply adding your email credentials as a mail option. It also handles various transport protocols (SMTP as default). In this post, we will use the nodemailer module to send email once the express app receives form submission."}),"\n",(0,t.jsx)(n.p,{children:"We will build the form submission mailer functionality on top of what we have done in the previous post (Website Page Routing with Node.js Express and EJS). The major changes are:"}),"\n",(0,t.jsx)(n.p,{children:"Adding contact form in contact.ejs.\nAdding different routers, including form post request handler and mailer.\nAdding redirect pages after sending emails.\nBefore we start, we should add the nodemailer module by running npm I nodemailer -SE. The rest of the dependencies are the same."}),"\n",(0,t.jsx)(n.p,{children:"OK, let\u2019s get started."}),"\n",(0,t.jsx)(n.p,{children:"Folder Structure"}),"\n",(0,t.jsx)(n.p,{children:"Adding different routers and a few new ejs pages."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"-- project_folder\n -- css\n    -- style.css\n -- html\n    -- about.ejs\n    -- contact.ejs\n    -- index.ejs\n    -- include\n        -- footer.ejs\n        -- head.ejs\n        -- nav.ejs\n        -- scripts.ejs\n        -- contact_send.ejs\n        -- contact_error.ejs\n -- routes\n    -- index.js\n    -- contact.js\n    -- pageRouter.js\n -- app.js\n -- package.json\n -- package-lock.json\n -- node_modules\n"})}),"\n",(0,t.jsx)(n.p,{children:"Adding or Updating EJS Files"}),"\n",(0,t.jsx)(n.p,{children:"contact.ejs"}),"\n",(0,t.jsx)(n.p,{children:"Simply adding the form to the existing contact.ejs. The form will be sent to contact/sent, which will be handled by the post request handler in contact.js."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n  <% include ./include/head %>\n  <body>\n    <% include ./include/nav %>\n    <div class="container">\n      <div class="row">\n        <h1>Contact</h1>\n      </div>\n      <hr />\n      <div class="row">\n        <form class="col-12 col-md-8" method="post" action="contact/send">\n          <div class="form-group">\n            <label for="name">Name</label>\n            <input type="text" class="form-control" id="name" name="name" />\n          </div>\n          <div class="form-group">\n            <label for="email">Email</label>\n            <input type="email" class="form-control" id="email" name="email" />\n          </div>\n          <div class="form-group">\n            <label for="enquiry">Enquiry</label>\n            <textarea\n              class="form-control"\n              id="enquiry"\n              name="enquiry"\n              rows="6"\n            ></textarea>\n          </div>\n          <div class="float-right">\n            \x3c!-- align button to the right --\x3e\n            <button type="submit" class="btn btn-primary btn-lg">Submit</button>\n          </div>\n        </form>\n      </div>\n      <div class="row">\n        <p></p>\n      </div>\n    </div>\n    <% include ./include/scripts %> <% include ./include/footer %>\n  </body>\n</html>\n'})}),"\n",(0,t.jsx)(n.p,{children:"contact_send.ejs"}),"\n",(0,t.jsx)(n.p,{children:"Redirected to this page after successful email send."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n  <% include ./include/head %>\n  <body>\n    <% include ./include/nav %>\n    <div class="container">\n      <div class="row">\n        <h1>Thank you for your Enquiry!</h1>\n      </div>\n      <hr />\n      <div class="row" style="height:300px;">\n        <p>\n          Thank you for contacting us. We will get back to you as soon as we\n          can.\n        </p>\n      </div>\n    </div>\n    <% include ./include/scripts %> <% include ./include/footer %>\n  </body>\n</html>\n'})}),"\n",(0,t.jsx)(n.p,{children:"contact_error.ejs"}),"\n",(0,t.jsx)(n.p,{children:"Redirected to this page after unsuccessful email send."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-html",children:'<!DOCTYPE html>\n<html lang="en">\n  <% include ./include/head %>\n  <body>\n    <% include ./include/nav %>\n    <div class="container">\n      <div class="row">\n        <h1>Thank you for your Enquiry!</h1>\n      </div>\n      <hr />\n      <div class="row" style="height:300px;">\n        <p>Thank you for contacting us.</p>\n        <p>We failed to send you an email. Please enter different one.</p>\n      </div>\n    </div>\n    <% include ./include/scripts %> <% include ./include/footer %>\n  </body>\n</html>\n'})}),"\n",(0,t.jsx)(n.p,{children:"Routers and Request Handlers"}),"\n",(0,t.jsx)(n.p,{children:"In the index file, we will define each router and they can be imported in the app.js. Within app.js, we can do a path-based routing. When you specify the router folder to import module in app.js, it looks for index.js by default. Therefore, you only need to add the folder name."}),"\n",(0,t.jsx)(n.p,{children:"index.js"}),"\n",(0,t.jsx)(n.p,{children:"This is for organising different request handlers so that importing them in the main app.js becomes cleaner."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'module.exports = {\n  pageRouter: require("./pageRouter.js"),\n  contact: require("./contact.js"),\n};\n'})}),"\n",(0,t.jsx)(n.p,{children:"contact.js"}),"\n",(0,t.jsx)(n.p,{children:"This handles post requests from the form. The example uses Hotmail. It supports all the major email service providers. See the documentation for further information about Nodemailer for your own implementation."}),"\n",(0,t.jsx)(n.p,{children:"After successful email send, it routes to the email success page. It redirects the traffic to the get method in pageRouter.js."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const express = require("express");\nconst url = require("url");\nconst nodemailer = require("nodemailer");\nconst router = express.Router();\n\nrouter.get("/", (req, res) => {\n  console.log("Request for contact page recieved");\n  res.render("contact");\n});\n\nrouter.post("/send", (req, res) => {\n  var name = req.body.name;\n  var email = req.body.email;\n  var enquiry = req.body.enquiry;\n\n  var emailMessage = `Hi ${name},\\n\\nThank you for contacting us.\\n\\nYour email is: ${email}.\\n\\nYour enquiry is: ${enquiry}\\n.`;\n\n  console.log(emailMessage);\n  res.redirect("/contact_send");\n\n  var transporter = nodemailer.createTransport({\n    service: "Hotmail",\n    auth: {\n      user: "your email address",\n      pass: "your password",\n    },\n  });\n\n  var emailOptions = {\n    from: "your name <your email address>",\n    to: email,\n    subject: "Node Mailer Test",\n    text: emailMessage,\n  };\n\n  transporter.sendMail(emailOptions, (err, info) => {\n    if (error) {\n      console.log(error);\n      res.redirect("/contact_send");\n    } else {\n      console.log("Message Sent: " + info.response);\n      console.log("Email Message: " + emailMessage);\n      res.redirect("/contact_error");\n    }\n  });\n});\n\nmodule.exports = router;\n'})}),"\n",(0,t.jsx)(n.p,{children:"pageRouter.js"}),"\n",(0,t.jsx)(n.p,{children:"Routing direct and redirect traffic."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const express = require("express");\nconst router = express.Router();\n\nrouter.get("/", (req, res) => {\n  console.log("Request for home recieved");\n  res.render("index");\n});\n\nrouter.get("/about", (req, res) => {\n  console.log("Request for about page recieved");\n  res.render("about");\n});\n\nrouter.get("/contact_send", (req, res) => {\n  console.log("Request for contact send page recieved");\n  res.render("contact_send");\n});\n\nrouter.get("/contact_error", (req, res) => {\n  console.log("Request for contact error page recieved");\n  res.render("contact_error");\n});\n\nmodule.exports = router;\n'})}),"\n",(0,t.jsx)(n.p,{children:"app.js"}),"\n",(0,t.jsx)(n.p,{children:"This is very similar to the previous example. The main difference is to import different routers and use each router according to the different path."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const express = require("express");\nconst path = require("path");\nconst bodyParser = require("body-parser");\nconst { pageRouter } = require("./routes");\nconst { contact } = require("./routes");\n\nconst app = express();\n// Set the default views directory to html folder\napp.set("views", path.join(__dirname, "html"));\n\n// Pass messages\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\n\n// Set the folder for css & java scripts\napp.use(express.static(path.join(__dirname, "css")));\napp.use(express.static(path.join(__dirname, "node_modules")));\n\n// Set the view engine to ejs\napp.set("view engine", "ejs");\n\napp.use("/contact", contact);\napp.use("/", pageRouter);\n\napp.listen(3000, () => {\n  console.log("Server is running at localhost:3000");\n});\n'})}),"\n",(0,t.jsx)(n.p,{children:"All done. This is a simple demonstration on how easy it is to implement automated email functionality by Node.js Express and Nodemailer. Now it is time for you implement your own!"}),"\n",(0,t.jsx)(n.p,{children:"(2081-06-09)"})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var t=s(96540);const o={},r=t.createContext(o);function i(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);