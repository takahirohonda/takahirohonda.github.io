"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[4452],{8152:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var o=t(74848),s=t(28453);const r={sidebar_position:5},i="How to Deploy Python Lambda Function with Serverless in AWS (Introduction)",a={id:"Infrastructure/Miscellaneous/serveless-python-intro",title:"How to Deploy Python Lambda Function with Serverless in AWS (Introduction)",description:"To deploy a AWS lambda function written in Python, you need to package all the modules that are used in your code before pushing it to your environment. Serverless is a great lambda deployment framework. It takes care of all the packaging and deployment.",source:"@site/docs/Infrastructure/Miscellaneous/5.serveless-python-intro.md",sourceDirName:"Infrastructure/Miscellaneous",slug:"/Infrastructure/Miscellaneous/serveless-python-intro",permalink:"/docs/Infrastructure/Miscellaneous/serveless-python-intro",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Advanced AWS Lambda Python Function Deployment with Serverless",permalink:"/docs/Infrastructure/Miscellaneous/serverless-python"},next:{title:"Setting up Docker and Serverless Development Environment in Ubuntu",permalink:"/docs/Infrastructure/Miscellaneous/serverless-docker"}},l={},c=[];function d(e){const n={code:"code",h1:"h1",img:"img",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"how-to-deploy-python-lambda-function-with-serverless-in-aws-introduction",children:"How to Deploy Python Lambda Function with Serverless in AWS (Introduction)"}),"\n",(0,o.jsx)(n.p,{children:"To deploy a AWS lambda function written in Python, you need to package all the modules that are used in your code before pushing it to your environment. Serverless is a great lambda deployment framework. It takes care of all the packaging and deployment."}),"\n",(0,o.jsx)(n.p,{children:"With Python, the best approach to develop lambda function is to use Linux or Mac. I found the module installed and packaged from Windows machine sometimes doesn\u2019t work once I pushed to AWS. Serverless needs Docker. Docker and Serverless do not work very well on Windows. I had so much trouble configuring my Windows machine to make them work together. So, my approach is to run a Linux machine in a virtual box from Windows and develop and deploy lambda functions from there. In this post, I am using Ubuntu 16.0.4 LTS."}),"\n",(0,o.jsx)(n.p,{children:"Prior to this, you have to set up the environment: Setting up Docker and Serverless Development Environment in Ubuntu."}),"\n",(0,o.jsx)(n.p,{children:"This post is based on the serverless blog (How to Handle your Python packaging in Lambda with Serverless plugins) with a few additional information. The instruction provided there is great. But, it is missing a few minor details which may become difficult if you have no idea what serverless does. Well, let\u2019s get started."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Steps"})}),"\n",(0,o.jsx)(n.p,{children:"(1) Create and Activate Virtual Environment for Lambda Development"}),"\n",(0,o.jsx)(n.p,{children:"Make sure that you have the latest Python 3. You can name your virtual environment whatever. Here, we are using the environment called lambda. You can change the path to lambda, depending on your installation. To install Python 3 and create virtual environments, see the post here."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.code,{children:"source /home/user/python3/lambda/bin/activate"})}),"\n",(0,o.jsx)(n.p,{children:"(2) Install Required Packages"}),"\n",(0,o.jsx)(n.p,{children:"In this exercise, we will use numpy. Let\u2019s also install psycopg2 and import it in the code to see how it works, too. For Lambda function, you need to install the binary version of psycopg2. Once you activate the virtual environment, pip will install the packages into that environment."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"pip install numpy\npip install psycopg2-binary\n"})}),"\n",(0,o.jsx)(n.p,{children:"(3) Go to the folder where you create Serverless project."}),"\n",(0,o.jsxs)(n.p,{children:["I created a tmp folder in my home path (",(0,o.jsx)(n.code,{children:"/home/user/"}),")."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"mkdir /home/user/tmp/"}),"\n(4) Create Python Serverless Project"]}),"\n",(0,o.jsx)(n.p,{children:"Go to the tmp folder created above and create project. If you set the path argument to numpy-test as in the example, it will create the folder. If you already have the folder with the same name, it will give you an error."}),"\n",(0,o.jsx)(n.p,{children:"Then, you can create a requirement file which contains the versions of the packages installed in your environment."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"cd /home/user/tmp/\n\nserverless create \\\n--template aws-python3 \\\n--name numpy-test \\\n--path numpy-test\n"})}),"\n",(0,o.jsx)(n.p,{children:"After creating the project go into the numpy-test folder and create a requirement file which contains the versions of the packages installed in your environment by using pip freeze."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"pip freeze > requirements.txt"}),"\n(5) Create Function"]}),"\n",(0,o.jsx)(n.p,{children:"After running serverless create command, you will see handler.py in the numpy-test folder. Let\u2019s edit it as in the example here with additional psycopg2 import statement. Test the function to see if it works."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import numpy as np\nimport psycogp2\n\ndef main(event, context):\n    a = np.arange(15).reshape(3, 5)\n\n    print(\"Your numpy array:\")\n    print(a)\n\nif __name__ == \"__main__\":\n    main('', '')\n"})}),"\n",(0,o.jsx)(n.p,{children:"(6) Add serverless-python-requirements plugin."}),"\n",(0,o.jsx)(n.p,{children:"You need to install the node package as below."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"npm init\nnpm install \u2013save serverless-python-requirements\n"})}),"\n",(0,o.jsx)(n.p,{children:"(7) Edit serverless.yml file"}),"\n",(0,o.jsx)(n.p,{children:"Once the function is working, you need to edit the config file for deployment. The file, serverless.yml, is in the lambda-test folder. You need to edit functions and add plugin information."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yml",children:"service: numpy-test\n\nprovider:\n  name: aws\n  runtime: python3.6\n\nfunctions:\n  numpy:\n    handler: handler.main\n\nplugins:\n  - serverless-python-requirements\n\ncustom:\n  pythonRequirements:\n    dockerizePip: non-linux\n"})}),"\n",(0,o.jsx)(n.p,{children:"(8) Deploy the function"}),"\n",(0,o.jsx)(n.p,{children:"The most important thing about this step is to specify the region. Without the region, it will deploy the function to US East (N. Virginia). See the further information on serverless deploy command here."}),"\n",(0,o.jsx)(n.p,{children:"Serverless deploy --region ap-southeast-2\nYou can see the deployment is complete."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"img",src:t(67237).A+"",width:"726",height:"515"})}),"\n",(0,o.jsx)(n.p,{children:"(9) Test the function from AWS Management Console"}),"\n",(0,o.jsx)(n.p,{children:"Go to AWS Management Console to see if you have numpy-test function. By default, it is tagged as dev, which means the name of your function is numpy-test-dev-numpy."}),"\n",(0,o.jsx)(n.p,{children:"Create an event with no parameter (and name it as numpy) and click Test."}),"\n",(0,o.jsx)(n.p,{children:"(2018-03-04)"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},67237:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/serverless-deploy-finished-57ffeae22513337607a9eff2a348ca89.webp"},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var o=t(96540);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);