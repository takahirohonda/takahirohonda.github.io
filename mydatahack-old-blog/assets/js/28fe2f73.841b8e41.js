"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[6940],{15189:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var r=t(74848),o=t(28453);const a={sidebar_position:43},s="Setting up Unit Tests for React with Mocha, JSDOM and Enzyme",i={id:"Web/Frontend/mocha-jsdom-enzyme-react",title:"Setting up Unit Tests for React with Mocha, JSDOM and Enzyme",description:"Before start coding your awesome React app, it is always a good idea to set up unit test infrastructure. Once test is set up, you can write tests whenever you feel necessary before waiting to complete the entire app development.",source:"@site/docs/Web/Frontend/43.mocha-jsdom-enzyme-react.md",sourceDirName:"Web/Frontend",slug:"/Web/Frontend/mocha-jsdom-enzyme-react",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/mocha-jsdom-enzyme-react",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:43,frontMatter:{sidebar_position:43},sidebar:"tutorialSidebar",previous:{title:"Calling Async Function in Action with Redux-Thunk",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/redux-thunc-async"},next:{title:"Refactoring React ES6 Class Components with Property Initialisers",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/property-initialiser-react-class"}},c={},l=[];function p(e){const n={code:"code",h1:"h1",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"setting-up-unit-tests-for-react-with-mocha-jsdom-and-enzyme",children:"Setting up Unit Tests for React with Mocha, JSDOM and Enzyme"}),"\n",(0,r.jsx)(n.p,{children:"Before start coding your awesome React app, it is always a good idea to set up unit test infrastructure. Once test is set up, you can write tests whenever you feel necessary before waiting to complete the entire app development."}),"\n",(0,r.jsx)(n.p,{children:"Mocha is a JavaScript test framework that runs on Node.js. JSDOM can mock the browser in the node execution environment. Enzyme is a React test utility, which simulate React component behaviours. With Enzyme, you can easily mount React component and write unit tests for the component\u2019s expected behaviours."}),"\n",(0,r.jsx)(n.p,{children:"This post is focused on JavaScript React. If you are interested in setting up unit tests with these tools, you can check out this post. The set up is slightly different, but quite similar between JavaScript and TypeScript. It is always good to know how to do it in both languages."}),"\n",(0,r.jsx)(n.p,{children:"I prefer Mocha to Jest. I even prefer using Jasmine to Jest. This is mainly because Jest runs slow. Or more precisely, I haven\u2019t really spent enough time to make Jest run fast. There must be a trick to run it faster by enabling caching or something. Check out this AirBnb blog about migrating from mocha to jest here. Jest is slow is probably not true. Jest also has nice features to write unit test for React. In fact, I wrote a small blog about it. Check it out here if you are more of a Jest person."}),"\n",(0,r.jsx)(n.p,{children:"Setting up"}),"\n",(0,r.jsx)(n.p,{children:"(1) Installation"}),"\n",(0,r.jsx)(n.p,{children:"First of all, we need babel register used as a reporter in Mocha command. This is because tests run in Node.js execution environment and it does not support all the newer syntax used in React like import statement. You probably have @babel/core already installed for your React project. If so, you only need to install @babel/register."}),"\n",(0,r.jsx)(n.p,{children:"If you are confused about babel, I wrote a blog about it. Check it out here."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm i --save-dev @babel/core @babel/register @babel/plugin-transform-runtime\n"})}),"\n",(0,r.jsx)(n.p,{children:"We can install all the testing tools. Enzyme needs adapter for the correct React version you are using."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm i --save-dev mocha chai fake jsdom sinon\nnpm i --save-dev enzyme enzyme-adapter-react-16\n"})}),"\n",(0,r.jsx)(n.p,{children:"Then, add @babel/transform-runtime plugin. This will enable Node.js execution environment to use React code. For example, export and import statements does not work without it."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "presets": ["@babel/preset-react", "@babel/preset-env"],\n  "plugins": [\n    "@babel/plugin-proposal-class-properties",\n    "@babel/transform-runtime"\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"(2) Mocha command in Package.json"}),"\n",(0,r.jsx)(n.p,{children:"You need to add @babel/register and the jsdom set up file path (here, I called it browser.js). npm test now can run the test."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:'"test": "mocha -r @babel/register -r ./browser.js  **/test/**/*.spec.js --recursive"'})}),"\n",(0,r.jsx)(n.p,{children:"(3) Adding jsdom config"}),"\n",(0,r.jsx)(n.p,{children:"Create a browser.js file in the root folder as below. All the code is from the documentation here. What is missing is enzyme configuration. You need to add it at the bottom of the file. It will set enzyme accessible from any test file."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'import React from "react";\nimport expect from "expect";\nimport { shallow, mount } from "enzyme";\nimport FormInput from "../form-elements/FormInput";\n\ndescribe("Form Component", () => {\n  it("should returns correct label for firstname", () => {\n    const wrapper = mount(\n      <FormInput\n        inputType="firstname"\n        changeHandler={() => {\n          return null;\n        }}\n      />\n    );\n    expect(wrapper.find("label").text()).toEqual("First name");\n  });\n\n  it("should return correct placeholder for firstname", () => {\n    const wrapper = mount(\n      <FormInput\n        inputType="firstname"\n        changeHandler={() => {\n          return null;\n        }}\n      />\n    );\n    const input = wrapper.find("input");\n    expect(input.prop("placeholder")).toEqual("Enter your first name");\n  });\n});\n'})}),"\n",(0,r.jsx)(n.p,{children:"That\u2019s it. npm test will execute tests when you add them. Now let\u2019s write some tests."}),"\n",(0,r.jsx)(n.p,{children:"Unit Test Examples"}),"\n",(0,r.jsx)(n.p,{children:"Simple UI test example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'import React from "react";\nimport expect from "expect";\nimport { shallow, mount } from "enzyme";\nimport FormInput from "../form-elements/FormInput";\n\ndescribe("Form Component", () => {\n  it("should returns correct label for firstname", () => {\n    const wrapper = mount(\n      <FormInput\n        inputType="firstname"\n        changeHandler={() => {\n          return null;\n        }}\n      />\n    );\n    expect(wrapper.find("label").text()).toEqual("First name");\n  });\n\n  it("should return correct placeholder for firstname", () => {\n    const wrapper = mount(\n      <FormInput\n        inputType="firstname"\n        changeHandler={() => {\n          return null;\n        }}\n      />\n    );\n    const input = wrapper.find("input");\n    expect(input.prop("placeholder")).toEqual("Enter your first name");\n  });\n});\n'})}),"\n",(0,r.jsx)(n.p,{children:"Spy onSubmit handler example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:'import React from "react";\nimport { expect } from "chai";\nimport { shallow, mount } from "enzyme";\nimport sinon from "sinon";\nimport Form from "../Form";\nimport initialState from "../../reducers/initialState";\n\ndescribe("<Form />", () => {\n  let state;\n  let spySubmitHandler;\n\n  beforeEach(() => {\n    state = initialState.information;\n    spySubmitHandler = sinon.spy();\n  });\n\n  it.only("should fire onSubmit function", () => {\n    const wrapper = mount(\n      <Form information={state} onSubmitHandler={spySubmitHandler} />\n    );\n    wrapper.find("button").simulate("click");\n    sinon.assert.calledOnce(spySubmitHandler);\n  });\n});\n'})}),"\n",(0,r.jsx)(n.p,{children:"(2019-07-06)"})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var r=t(96540);const o={},a=r.createContext(o);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);