"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[5554],{93695:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var i=t(74848),o=t(28453);const r={sidebar_position:3},s="Implementing Dependency Injection in Sitecore",c={id:"Web/Sitecore/di-in-sitecore",title:"Implementing Dependency Injection in Sitecore",description:"There are a few different ways to implement dependency injection in Sitecore. Once upon a time, the only way to implementing DI was to use third-party libraries like Simple Injector. Since Sitecore 8.2 release, Sitecore includes build in dependency injection based on Microsoft\u2019s Dependency Injection for ASP.NET Core. We can still use third-party modules for DI in the latest Sitecore and it is still a valid option with a few benefits over the out-of-the box DI solutions.",source:"@site/docs/Web/Sitecore/3.di-in-sitecore.md",sourceDirName:"Web/Sitecore",slug:"/Web/Sitecore/di-in-sitecore",permalink:"/docs/Web/Sitecore/di-in-sitecore",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Dependency Injection Lifetime Management",permalink:"/docs/Web/Sitecore/di-lifetime-mgmt"},next:{title:"sitecore-9-cert-quiz",permalink:"/docs/Web/Sitecore/sitecore-9-cert-quiz"}},d={},l=[];function a(e){const n={code:"code",h1:"h1",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"implementing-dependency-injection-in-sitecore",children:"Implementing Dependency Injection in Sitecore"}),"\n",(0,i.jsx)(n.p,{children:"There are a few different ways to implement dependency injection in Sitecore. Once upon a time, the only way to implementing DI was to use third-party libraries like Simple Injector. Since Sitecore 8.2 release, Sitecore includes build in dependency injection based on Microsoft\u2019s Dependency Injection for ASP.NET Core. We can still use third-party modules for DI in the latest Sitecore and it is still a valid option with a few benefits over the out-of-the box DI solutions."}),"\n",(0,i.jsx)(n.p,{children:"Choosing approach can be daunting. At the end of the day, whatever solution you implement is going to work. Just pick whatever feels right for the solution you are working on. Recently, I implemented DI in Sitecore 8.2 with the out-of-box Sitecore Dependency Injection. The reason for this choice is:"}),"\n",(0,i.jsx)(n.p,{children:"Sitecore is already using it. For that reason, it will be supported by Sitecore. All we need to do is to register our custom configurator.\nWe did not need to add extra third-party module dependency to the existing solution.\nThe performance is said to be as fast as the best performing third-party DI containers, like Simple Injector.\nHabitat implements it. All I needed to do is to take the example code and implement it in the existing solution. Although the solution is for Sitecore 9, it works for 8.2.\nThe DI container is referenced from the composition root with this solution (see details for this fantastic blog post).\nI implemented DI in an already matured Sitecore code base. Habitat implementation has the minimum disruption to the existing solution and allowed us to introduce DI slowly to the entire code base.\nWhen I implemented DI, I started with implementing it in a Feature project for my own humble Sitecore that I installed on my laptop for learning. There are heaps of posts that help you to implement DI in the real-world solution. This post gives you the example of implementing DI at a project level just to understand how it works."}),"\n",(0,i.jsx)(n.p,{children:"This is fairly quick and simple. But, I promise this is a fun and satisfying activity. Let\u2019s get started."}),"\n",(0,i.jsx)(n.p,{children:"Aim"}),"\n",(0,i.jsx)(n.p,{children:"In the previous post, we created a controller depending on repository. The dependency injection is done in the constructor. We want to register FrontEndTestController and FrontEndTestRepository in the DI container so that we can get rid of the line injecting the concrete implementation."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'public class FrontEndTestController : Controller\n{\n    private IFrontEndTestRepository frontEndTestRepository;\n\n    // Poor man\'s DI. We want to get rid of this.\n    public FrontEndTestController() : this(new FrontEndTestRepository())\n\n    public FrontEndTestController(IFrontEndTestRepository frontEndTestRepository)\n    {\n        this.frontEndTestRepository = frontEndTestRepository;\n    }\n    public ViewResult GetFrontEndTestView()\n    {\n        var dataSourceId = RenderingContext.Current?.Rendering?.DataSource;\n        var viewModel =\n            dataSourceId != null\n            ? frontEndTestRepository.GetFrontEndTestModel(dataSourceId)\n            : new FrontEndTest();\n\n        return View("FrontEndTest", viewModel);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"At the end of this post, the poor man\u2019s DI will be gone for good!"}),"\n",(0,i.jsx)(n.p,{children:"Steps"}),"\n",(0,i.jsx)(n.p,{children:"(1) Add dlls for Microsoft DI"}),"\n",(0,i.jsx)(n.p,{children:"We need to add two dlls for the project (in this example, SitecoreDev.Feature.Design). These dlls come with the software installation. I suggest to copy & paste from the web root bin directory and move them to the code base lib folder."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"Extensitons.DependencyInjection\nExtensions.DependencyInjection.Abstractions.\n"})}),"\n",(0,i.jsx)(n.p,{children:"(2) Register dependencies"}),"\n",(0,i.jsx)(n.p,{children:"Create RegisterDependencies.cs and register dependencies manually as below."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"using SitecoreDev.Feature.Design.Repository;\n\nnamespace SitecoreDev.Feature.Design\n{\n    using Microsoft.Extensions.DependencyInjection;\n    using Sitecore.DependencyInjection;\n    using SitecoreDev.Feature.Design.Controllers;\n\n    public class RegisterDependencies : IServicesConfigurator\n    {\n        public void Configure(IServiceCollection serviceCollection)\n        {\n            serviceCollection.AddTransient<FrontEndTestController>();\n            serviceCollection.AddTransient(typeof(IFrontEndTestRepository),\n                typeof(FrontEndTestRepository));\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"(3) Register service"}),"\n",(0,i.jsx)(n.p,{children:"Create a config file Feature.Design.config in App_Config/Include. This will allow Sitecore to register dependencies."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0"?>\n<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/">\n  <sitecore>\n    <services>\n      <configurator type="SitecoreDev.Feature.Design.RegisterDependencies,\n                    SitecoreDev.Feature.Design"/>\n    </services>\n  </sitecore>\n</configuration>\n'})}),"\n",(0,i.jsx)(n.p,{children:"(4) Remove the poor man\u2019s DI constructor"}),"\n",(0,i.jsx)(n.p,{children:"We can now remove the constructor instantiating the actual implementation."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'public class FrontEndTestController : Controller\n{\n    private IFrontEndTestRepository frontEndTestRepository;\n\n    public FrontEndTestController(IFrontEndTestRepository frontEndTestRepository)\n    {\n        this.frontEndTestRepository = frontEndTestRepository;\n    }\n    public ViewResult GetFrontEndTestView()\n    {\n        var dataSourceId = RenderingContext.Current?.Rendering?.DataSource;\n        var viewModel =\n            dataSourceId != null\n            ? frontEndTestRepository.GetFrontEndTestModel(dataSourceId)\n            : new FrontEndTest();\n\n        return View("FrontEndTest", viewModel);\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["That\u2019s it. You can also check the container registration from ",(0,i.jsx)(n.code,{children:"http://[instance]/sitecore/admin/showservicesconfig.aspx"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Next Steps"}),"\n",(0,i.jsx)(n.p,{children:"Now that you know how this works, all you need to do is to register dependencies when the application starts through Sitecore pipeline. Here are the steps I took."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Created a DependencyInjection project in Foundation and move the entire code from Habitat solution here."}),"\n",(0,i.jsx)(n.li,{children:"Cleaned up ServiceCollectionExtensions methods (removed unnecessary methods and turned unnecessary public methods to privates)."}),"\n",(0,i.jsx)(n.li,{children:"Added Scoped into Lifetime enum and ServiceCollectionExtensions methods for full lifetime management support."}),"\n",(0,i.jsx)(n.li,{children:"Wrote unit tests on ServiceCollectionExtensions."}),"\n",(0,i.jsx)(n.li,{children:"Added dependency registration attributes (as described here) to a few classes and implemented in one controller to start with."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Now, it\u2019s your turn to implement DI in your Sitecore solutions."}),"\n",(0,i.jsx)(n.p,{children:"(2019-09-25)"})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>c});var i=t(96540);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);