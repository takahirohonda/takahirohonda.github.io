"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[4968],{73116:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>a,contentTitle:()=>m,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var o=n(74848),i=n(28453);const r={sidebar_position:21},m="How To Convert Non-UTC Timestamp Into UNIX Epoch Time In Python",s={id:"data-ingestion/convert-non-utc-to-unix-python",title:"How To Convert Non-UTC Timestamp Into UNIX Epoch Time In Python",description:"When we ingest API data, the query URI string often takes Unix epoch time (or Unix time) in order to specify the datetime range. The epoch time is the way to represent timestamp as the number of seconds that have elapsed since 1970-01-01 0000 UTC.",source:"@site/docs/data-ingestion/21.convert-non-utc-to-unix-python.md",sourceDirName:"data-ingestion",slug:"/data-ingestion/convert-non-utc-to-unix-python",permalink:"/mydatahack-old-blog/mydatahack-old-blog/data-ingestion/convert-non-utc-to-unix-python",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:21,frontMatter:{sidebar_position:21},sidebar:"tutorialSidebar",previous:{title:"How To Ingest AES Encrypted Data With Python",permalink:"/mydatahack-old-blog/mydatahack-old-blog/data-ingestion/aes-encrypted-data-python"},next:{title:"How To Get Data From MongoDB With Python",permalink:"/mydatahack-old-blog/mydatahack-old-blog/data-ingestion/monog-python"}},a={},c=[];function h(t){const e={code:"code",h1:"h1",p:"p",pre:"pre",...(0,i.R)(),...t.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.h1,{id:"how-to-convert-non-utc-timestamp-into-unix-epoch-time-in-python",children:"How To Convert Non-UTC Timestamp Into UNIX Epoch Time In Python"}),"\n",(0,o.jsx)(e.p,{children:"When we ingest API data, the query URI string often takes Unix epoch time (or Unix time) in order to specify the datetime range. The epoch time is the way to represent timestamp as the number of seconds that have elapsed since 1970-01-01 00:00:00 UTC."}),"\n",(0,o.jsx)(e.p,{children:"When you have an input timestamp string and convert it to the epoch time, it is absolutely critical to understand the time zone of your input string as well as the default server time zone and deal with it correctly. This sounds complicated. But, do not worry. I will show you how to convert a timestamp string into the epoch time in different scenarios."}),"\n",(0,o.jsx)(e.p,{children:"Examples"}),"\n",(0,o.jsx)(e.p,{children:"Let\u2019s take Melbourne/Australia time zone (AEST) for example. 2018-02-15 00:00:00 in AEST is 2018-02-14 13:00:00 in UTC, which is 1518613200. You can check this with this online epoch time converter."}),"\n",(0,o.jsx)(e.p,{children:"So, when the input string is 2018-02-15 00:00:00 in AEST, the epoch output should be 1518613200."}),"\n",(0,o.jsx)(e.p,{children:"For a starter, you need to check the default time zone on your server. Here are the commands."}),"\n",(0,o.jsx)(e.h1,{id:"find-timezone-in-windows-server",children:"Find timezone in Windows Server:"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-bash",children:'> systeminfo | findstr /C:"Time Zone"\n\n# Find timezone in Linux Server:\n\n> date\n> Scenario 1: Server time zone is the same as the input string time zone (AEST)\n'})}),"\n",(0,o.jsx)(e.p,{children:"This is the easier scenario. You can use mktime() function from the time module. This takes struct_time in local time and convert to epoch. You need to format the string into the struct_time datatype with strptime() first and use it in mktime()."}),"\n",(0,o.jsx)(e.p,{children:"Assuming the server time zone is AEST, let\u2019s convert 2018-02-15 00:00:00 in AEST to epoch. When you use the input string as 2018-02-15, it assumes the time is 00:00:00. So, both functions below work. You will see the output of 1518613200."}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"from time import strptime, strftime, mktime, gmtime\n\ndef datetime_converter(datetime_string): # (1) Convert to datetime format\ntarget_timestamp = strptime(datetime_string, '%Y-%m-%d %H:%M:%S')\n\n    # (2) mktime creates epoch time from the local time\n    mktime_epoch = mktime(target_timestamp)\n    print(int(mktime_epoch)) # convert to integer to remove decimal\n\n    # (3) gmtime to convert epoch time into UTC time object\n    epoch_to_timestamp = strftime('%Y-%m-%d %H:%M:%S', gmtime(mktime_epoch))\n    print(epoch_to_timestamp)\n\ndef date_converter(date_string): # (1) Convert to date format\ntarget_timestamp = strptime(date_string, '%Y-%m-%d')\n\n    # (2) mktime creates epoch time from the local time\n    mktime_epoch = mktime(target_timestamp)\n    print(int(mktime_epoch)) # convert to integer to remove decimal\n\n    # (3) gmtime to convert epoch time into UTC time object\n    epoch_to_timestamp = strftime('%Y-%m-%d %H:%M:%S', gmtime(mktime_epoch))\n    print(epoch_to_timestamp)\n\ndatetime_converter('2018-02-15 00:00:00')\ndate_converter('2018-02-15')\n"})}),"\n",(0,o.jsx)(e.p,{children:"Scenario 2: Server time zone is UTC and the input string time zone is AEST."}),"\n",(0,o.jsx)(e.p,{children:"This scenario is slightly more complex. The mktime() uses the local time from the server. Therefore, you first need to convert AEST into UTC before passing it to mktime()."}),"\n",(0,o.jsx)(e.p,{children:"To convert local time to UTC, you can use the pytz module. To begin with, let\u2019s convert local time (2018-02-15 00:00:00) to UTC. You will get the output of 2018-02-14 13:00:00 from the function below."}),"\n",(0,o.jsx)(e.p,{children:"You first need to define your time zone with pytz.timezone() function. Then, add the time zone to the time_struct object with the localize() function. This can be converted to UTC with astimezone (pytz.utc)."}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"import pytz\nfrom datetime import datetime\nimport time\n\ndef convert_to_utc(timestamp_string, timezone):\n\n    local_tz = pytz.timezone(timezone)\n    ts = datetime.strptime(timestamp_string, '%Y-%m-%d %H:%M:%S')\n    ts = local_tz.localize(ts)\n    ts = str(ts.astimezone(pytz.utc))[0:19]\n    print('UTC timestamp is: {}'.format(ts))\n    return ts\n\nconvert_to_utc('2018-02-15 00:00:00',\"Australia/Melbourne\")\n"})}),"\n",(0,o.jsx)(e.p,{children:"Ok, once you get the hang of converting your local time to UTC, all you need to do is use mktime() to convert it to epoch. Remember mktime() uses the default local time in the server as UTC. Therefore, passing the time_struct object with UTC time will automatically converts to the right epoch time. In this case, 2018-02-15 00:00:00 in AEST gets converted to 1518613200."}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"import pytz\nfrom datetime import datetime\nimport time\n\ndef convert_timezone_to_utc_epoch(timestamp_string, timezone):\n\n    local_tz = pytz.timezone(timezone)\n    ts = datetime.strptime(timestamp_string, '%Y-%m-%d %H:%M:%S')\n    ts = local_tz.localize(ts)\n    ts = str(ts.astimezone(pytz.utc))[0:19]\n    print('UTC timestamp is: {}'.format(ts))\n    epoch = int(time.mktime(time.strptime(ts, '%Y-%m-%d %H:%M:%S')))\n    print('Epoch for API call is: {}'.format(epoch))\n    return epoch\n\nconvert_timezone_to_utc_epoch('2018-02-15',\"Australia/Melbourne\")\n"})}),"\n",(0,o.jsx)(e.p,{children:"Finally, if your input string is UTC time, you can convert it to epoch from UTC with the function below. When the input string is 2018-02-14 13:00:00 UTC, the function below will give us the same value as print int(time.mktime(time.strptime(\u20182018-02-15 00:00:00\u2032,\u2019%Y-%m-%d %H:%M:%S\u2019)))."}),"\n",(0,o.jsx)(e.p,{children:"To convert UTC to epoch, you can use timegm() from calender. Make sure to convert it to the right data type with utctimetuple() prior to using the timegm function."}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:"import calendar, time\nfrom datetime import datetime\n\ndef convert_utc_to_epoch(timestamp_string):\n'''Use this function to convert utc to epoch'''\ntimestamp = datetime.strptime(timestamp_string, '%Y-%m-%d %H:%M:%S')\nepoch = int(calendar.timegm(timestamp.utctimetuple()))\nprint epoch\nreturn epoch\n\nconvert_utc_to_epoch('2018-02-14 13:00:00')\nFinally, here is the quick function to convert epoch to local time.\n\nfrom time import strftime, localtime\n\ndef convert_epoch_to_local(epoch):\n'''Converting epoch to local time'''\nreturn strftime('%Y-%m-%d %H:%M:%S', localtime(epoch))\n\ncheck = convert_epoch_to_local(1522242000)\nprint(check)\n"})}),"\n",(0,o.jsx)(e.p,{children:"Now, you do not need to fear time zone!"}),"\n",(0,o.jsx)(e.p,{children:"(2018-02-15)"})]})}function p(t={}){const{wrapper:e}={...(0,i.R)(),...t.components};return e?(0,o.jsx)(e,{...t,children:(0,o.jsx)(h,{...t})}):h(t)}},28453:(t,e,n)=>{n.d(e,{R:()=>m,x:()=>s});var o=n(96540);const i={},r=o.createContext(i);function m(t){const e=o.useContext(r);return o.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function s(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(i):t.components||i:m(t.components),o.createElement(r.Provider,{value:e},t.children)}}}]);