"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[8075],{33979:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>r,toc:()=>h});var n=o(74848),a=o(28453);const i={sidebar_position:10},s="How to Solve \u2018Missing Authentication Token Error\u2019 with API Gateway Custom Domain",r={id:"Infrastructure/AWS/api-gateway-error",title:"How to Solve \u2018Missing Authentication Token Error\u2019 with API Gateway Custom Domain",description:"After setting up everything correctly, you may have \u2018Missing Authentication Token Error\u2019 when you call the custom domain while the endpoint from API gateway works.",source:"@site/docs/Infrastructure/AWS/10.api-gateway-error.md",sourceDirName:"Infrastructure/AWS",slug:"/Infrastructure/AWS/api-gateway-error",permalink:"/docs/Infrastructure/AWS/api-gateway-error",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"Deploying Multi-Container Applications to AWS Elastic Beanstalk",permalink:"/docs/Infrastructure/AWS/elastic-beanstalk"},next:{title:"Setting up Custom Domain Name with SSL Certificate for your S3 Website",permalink:"/docs/Infrastructure/AWS/custom-domain-name-ssl-cert-s3"}},c={},h=[];function u(e){const t={code:"code",h1:"h1",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"how-to-solve-missing-authentication-token-error-with-api-gateway-custom-domain",children:"How to Solve \u2018Missing Authentication Token Error\u2019 with API Gateway Custom Domain"}),"\n",(0,n.jsx)(t.p,{children:"After setting up everything correctly, you may have \u2018Missing Authentication Token Error\u2019 when you call the custom domain while the endpoint from API gateway works."}),"\n",(0,n.jsx)(t.p,{children:"Surprisingly, this is one of the most common errors I have seen, yet not very well documented. So, here it is. When you encounter this error, check out the suggestion here."}),"\n",(0,n.jsx)(t.p,{children:"The prerequisite is to have your lambda function working through the endpoint from API gateway. You also need to have the correct domain name and certificate set up. Setting up a lambda function, API gateway or domain name with a certificate is not the scope of this post."}),"\n",(0,n.jsx)(t.p,{children:"The root cause for this is not what the error message says. It is nothing to do with authentication token. It is to do with the incorrect endpoint."}),"\n",(0,n.jsx)(t.p,{children:"The raw API endpoint from API gateway contains the url, stage name and resource path as below."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.code,{children:"https://f84jseleds.execute-api.us-east-2.amazonaws.com/dev/myapi"})}),"\n",(0,n.jsx)(t.p,{children:"If your custom domain name is myapi.custom.domain.com with the base path as helloworld, your end point will be the base url, helloworld and the resource path as myapi."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.code,{children:"https:// myapi.custom.domain.com/helloworld/myapi"})}),"\n",(0,n.jsx)(t.p,{children:"The most common mistake I find is that setting the same path as the resource path in the Custom Domain Name and try to call the end point as below. Obviously, it does not work."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.code,{children:"https:// myapi.custom.domain.com/myapi"})}),"\n",(0,n.jsx)(t.p,{children:"If you have the same path in the base path mapping as the resource path, you can call it as below. But, obviously this is not a pretty endpoint. Ideally, you want to have different names so that the endpoint doesn\u2019t look repetitive."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.code,{children:"https:// myapi.custom.domain.com/myapi/myapi"})}),"\n",(0,n.jsx)(t.p,{children:"If you are using the serverless framework, make sure to configure these parameters correctly."}),"\n",(0,n.jsx)(t.p,{children:"The resource path comes under events in the function."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yml",children:"functions:\n  postApiTest:\n    handler: handler.check\n    name: post-api-test\n    events:\n      - http:\n          path: check\n          method: post\n          private: true\nThe base path mapping for the custom domain comes under the customDomain property in custom\n\ncustom:\n  customDomain:\n    domainName: myapi.custom.domain.com\n    stage: dev\n    basePath: helloworld\n    certificateName: myapi.custom.domain.com\n    createRoute53Record: true\n"})}),"\n",(0,n.jsx)(t.p,{children:"You can check out this blog for setting up Custom Domain with serverless. It is not really clear on the difference between resource path and base path mapping, though. It is also a good practice with setting the basePath parameter. In fact, if you leave it empty, serverless doesn\u2019t work."}),"\n",(0,n.jsx)(t.p,{children:"Now you can call your endpoint and it should work!"}),"\n",(0,n.jsx)(t.p,{children:"I hope this saves you a bit of time trouble shooting your API gateway. If you have any other problems with setting up API gateway with lambda functions, let me know. The chances are I have seen it before and know how to solve it!"}),"\n",(0,n.jsx)(t.p,{children:"(2018-10-22)"})]})}function m(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>r});var n=o(96540);const a={},i=n.createContext(a);function s(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);