"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[5845],{74305:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var t=n(74848),l=n(28453);const i={sidebar_position:26},r="Troubleshooting Promise Polyfill Not Working as Expected",s={id:"Web/Frontend/troubleshoot-polyfill-not-working",title:"Troubleshooting Promise Polyfill Not Working as Expected",description:"I had an interesting problem with Promise Polyfill to make promise and finally work on IE11. The page has multiple JS bundles. The existing JS bundles all had Promise polyfill from older version of core-js (babel-core@7.0.0-bridge.0).",source:"@site/docs/Web/Frontend/26.troubleshoot-polyfill-not-working.md",sourceDirName:"Web/Frontend",slug:"/Web/Frontend/troubleshoot-polyfill-not-working",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/troubleshoot-polyfill-not-working",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:26,frontMatter:{sidebar_position:26},sidebar:"tutorialSidebar",previous:{title:"Adding Polyfills in TypeScript App",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/polyfill-ts-app"},next:{title:"IE11 Support for amazon-connect-chatjs",permalink:"/mydatahack-old-blog/mydatahack-old-blog/Web/Frontend/ie11-support-amazon-connect-chatjs"}},a={},d=[];function c(e){const o={code:"code",h1:"h1",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h1,{id:"troubleshooting-promise-polyfill-not-working-as-expected",children:"Troubleshooting Promise Polyfill Not Working as Expected"}),"\n",(0,t.jsx)(o.p,{children:"I had an interesting problem with Promise Polyfill to make promise and finally work on IE11. The page has multiple JS bundles. The existing JS bundles all had Promise polyfill from older version of core-js (babel-core@7.0.0-bridge.0)."}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.code,{children:"import 'core-js/es6/promise';"})}),"\n",(0,t.jsx)(o.p,{children:"Then, I added another JS bundle with the latest Promise polyfill."}),"\n",(0,t.jsx)(o.p,{children:"The promise polyfill from the latest core-js (core-js@3.6.5) includes finally."}),"\n",(0,t.jsx)(o.p,{children:(0,t.jsx)(o.code,{children:"import 'core-js/features/promise';"})}),"\n",(0,t.jsx)(o.p,{children:"The new bundle uses finally on Promise. The promise polyfill from the latest core-js (core-js@3.6.5) includes finally. It should work all fine. But, I got this error."}),"\n",(0,t.jsx)(o.p,{children:"Unhandled promise rejection: TypeError: Object doesn\u2019t support property or method finally."}),"\n",(0,t.jsx)(o.p,{children:"It turned out the polyfill from the existing bundle was overriding the polyfill from the new bundle. There are 3 ways of fixing this issue. The second one is recommended."}),"\n",(0,t.jsx)(o.p,{children:"(1) Load the new bundle after the existing one."}),"\n",(0,t.jsx)(o.p,{children:"This will ensure to use the Promise polyfill from the latest one."}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-html",children:'<script type="text/javascript" src="existing-bundle.js"><\/script>\n<script type="text/javascript" src="new-bundle.js"><\/script>\n'})}),"\n",(0,t.jsx)(o.p,{children:"(2) Remove polyfills from all bundle and insert in head with polyfil.io."}),"\n",(0,t.jsx)(o.p,{children:"I think this is the best option. It is clean and removes unnecessary duplication."}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-html",children:'<script src="https://polyfill.io/v3/polyfill.min.js?Promise%2CPromise.prototype.finally"><\/script>\n'})}),"\n",(0,t.jsx)(o.p,{children:"(3) Add finally polyfill to the existing bundle with older core-js version."}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-js",children:'import "core-js/es6/promise";\nimport "core-js/fn/promise/finally";\n'})}),"\n",(0,t.jsx)(o.p,{children:"For further information regarding adding polyfills in TypeScript bundle, check out this post"}),"\n",(0,t.jsx)(o.p,{children:"(2020-05-28)"})]})}function p(e={}){const{wrapper:o}={...(0,l.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>r,x:()=>s});var t=n(96540);const l={},i=t.createContext(l);function r(e){const o=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),t.createElement(i.Provider,{value:o},e.children)}}}]);