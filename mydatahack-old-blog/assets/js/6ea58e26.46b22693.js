"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[427],{67817:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>d,contentTitle:()=>o,default:()=>g,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var n=s(74848),t=s(28453);const r={sidebar_position:15},o="How To Create User Credentials And Grant Privileges In Postgres",c={id:"Infrastructure/DBA/pg-user-credentials",title:"How To Create User Credentials And Grant Privileges In Postgres",description:"Creating user credentials and grand privileges in Postgres can be tricky. You have to make sure each user has the right access level to the right tables and schemas. Each database works differently even they all are relational databases.",source:"@site/docs/Infrastructure/DBA/15.pg-user-credentials.md",sourceDirName:"Infrastructure/DBA",slug:"/Infrastructure/DBA/pg-user-credentials",permalink:"/mydatahack-old-blog/docs/Infrastructure/DBA/pg-user-credentials",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"tutorialSidebar",previous:{title:"How Postgres JSON Query Handles Missing Key",permalink:"/mydatahack-old-blog/docs/Infrastructure/DBA/pg-json-query-missing-key"},next:{title:"How To Format Output in Pretty JSON With Postgres",permalink:"/mydatahack-old-blog/docs/Infrastructure/DBA/format-output-postgres"}},d={},l=[];function i(e){const a={code:"code",h1:"h1",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.h1,{id:"how-to-create-user-credentials-and-grant-privileges-in-postgres",children:"How To Create User Credentials And Grant Privileges In Postgres"}),"\n",(0,n.jsx)(a.p,{children:"Creating user credentials and grand privileges in Postgres can be tricky. You have to make sure each user has the right access level to the right tables and schemas. Each database works differently even they all are relational databases."}),"\n",(0,n.jsx)(a.p,{children:"Postgres has its own way of creating users and granting privileges. It took me a few goes to work it out. If you just grant privileges for a user, the access privileges do not work for the table created in the future. The trickiest part is to run the alter default privilege statement so that the user can have the same privileges for the newly created tables, which is stated in the Postgres documentation on ALTER DEFAULT PRIVILEGES."}),"\n",(0,n.jsx)(a.p,{children:"Ok, let\u2019s have a look at a scenario and script to make the magic happen!"}),"\n",(0,n.jsx)(a.p,{children:"Scenarios"}),"\n",(0,n.jsx)(a.p,{children:"I launched a Postgres RDS instance in AWS and created schemas with root account in the database called mydatahack. If you sign up for AWS, you have 12 months of free RDS access as Amazone RDS Free Tier, which is pretty cool. Of course, you can download and install it locally."}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-sql",children:"CREATE schema playground;\nCREATE schema datamart;\nCREATE schema staging;\nCREATE schema usermanaged;\nCREATE schema wordpress;\nCREATE schema googleanalytics;\n"})}),"\n",(0,n.jsx)(a.p,{children:"I need to create 3 different users."}),"\n",(0,n.jsx)(a.p,{children:"developer: All access to all tables in all schemas\nreadonly: Read only access to all tables in all schemas\ndatahack: All access to all tables in the playground and usermanaged schemas and readonly for the rest\nSteps"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-sql",children:"Create a group with CREATE ROLE statement\nGrant Usage on Schema with GRANT USAGE ON SCHEMA statement\nGrant Privileges on Exisiting Tables with GRANT <> On ALL TABLES statement\nSet set the privileges that will be applied to objects created in the future with ALTER DEFAULT PRIVILEGES\n"})}),"\n",(0,n.jsx)(a.p,{children:"Great a user with password and add to the user group\nScripts"}),"\n",(0,n.jsx)(a.p,{children:"developer user"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-sql",children:"DROP ROLE IF EXISTS developeraccess;\nCREATE ROLE developeraccess;\n\nGRANT USAGE ON SCHEMA\nplayground, datamart, staging, usermanaged, wordpress, googleanalytics\nTO developeraccess;\n\nGRANT ALL ON ALL TABLES IN SCHEMA\nplayground, datamart, staging, usermanaged, wordpress, googleanalytics\nTO developeraccess;\n\nALTER DEFAULT PRIVILEGES IN SCHEMA\nplayground, datamart, staging, usermanaged, wordpress, googleanalytics\nGRANT ALL ON TABLES TO developeraccess;\n\nDROP USER IF EXISTS developer;\nCREATE USER developer WITH PASSWORD '';\nGRANT developeraccess TO developer;\nreadonly user\n\nDROP ROLE IF EXISTS readaccess;\nCREATE ROLE readaccess;\n\nGRANT USAGE ON SCHEMA\nplayground, datamart, staging, usermanaged, wordpress, googleanalytics\nTO readaccess;\n\nGRANT SELECT ON ALL TABLES IN SCHEMA\nplayground, datamart, staging, usermanaged, wordpress, googleanalytics\nTO readaccess;\n\nALTER DEFAULT PRIVILEGES IN SCHEMA\nplayground, datamart, staging, usermanaged, wordpress, googleanalytics\nGRANT SELECT ON TABLES TO readaccess;\n\nDROP USER IF EXISTS readonly;\nCREATE USER readonly WITH PASSWORD '';\nGRANT readaccess TO readonly;\ndatahack user\n\nDROP ROLE IF EXISTS datahackaccess;\nCREATE ROLE datahackaccess;\n\nGRANT USAGE ON SCHEMA\nplayground, datamart, staging, usermanaged, wordpress, googleanalytics\nTO datahackaccess;\n\nGRANT ALL ON ALL TABLES IN SCHEMA\nplayground, usermanaged\nTO datahackaccess;\n\nALTER DEFAULT PRIVILEGES IN SCHEMA\nplayground, usermanaged\nGRANT ALL ON TABLES TO datahackaccess;\n\nGRANT SELECT ON ALL TABLES IN SCHEMA\ndatamart, staging, wordpress, googleanalytics\nTO datahackaccess;\n\nALTER DEFAULT PRIVILEGES IN SCHEMA\ndatamart, staging, wordpress, googleanalytics\nGRANT SELECT ON TABLES TO datahackaccess;\n\nDROP USER IF EXISTS datahack;\nCREATE USER datahack WITH PASSWORD '';\nGRANT datahackaccess TO datahack;\n"})}),"\n",(0,n.jsx)(a.p,{children:"You have successfully created the users that meet the requirements!"}),"\n",(0,n.jsx)(a.p,{children:"(2018-01-25)"})]})}function g(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(i,{...e})}):i(e)}},28453:(e,a,s)=>{s.d(a,{R:()=>o,x:()=>c});var n=s(96540);const t={},r=n.createContext(t);function o(e){const a=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);