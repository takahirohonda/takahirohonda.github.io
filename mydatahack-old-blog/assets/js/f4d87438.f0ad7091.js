"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[3729],{36640:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var n=o(74848),r=o(28453);const a={sidebar_position:6},i="How to Troubleshoot FakeDb Errors \u2013 Sitecore 8.2",s={id:"Web/Sitecore/troubleshoot-fake-db-error",title:"How to Troubleshoot FakeDb Errors \u2013 Sitecore 8.2",description:"A NuGet package, Sitecore.FakeDb helps us to test functions that use Sitecore API. It is a mock memory database where you can remove the dependencies and isolate the code. When you create a brand-new test project, setting up FakeDb can be tricky.",source:"@site/docs/Web/Sitecore/6.troubleshoot-fake-db-error.md",sourceDirName:"Web/Sitecore",slug:"/Web/Sitecore/troubleshoot-fake-db-error",permalink:"/docs/Web/Sitecore/troubleshoot-fake-db-error",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Creating DbItem with Item ID \u2013 Sitecore FakeDb",permalink:"/docs/Web/Sitecore/create-dbitem-sitecore-fakedb"},next:{title:"How to Mock Rendering Parameters in Unit Test",permalink:"/docs/Web/Sitecore/mock-rendering-param"}},c={},l=[];function d(e){const t={code:"code",h1:"h1",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"how-to-troubleshoot-fakedb-errors--sitecore-82",children:"How to Troubleshoot FakeDb Errors \u2013 Sitecore 8.2"}),"\n",(0,n.jsx)(t.p,{children:"A NuGet package, Sitecore.FakeDb helps us to test functions that use Sitecore API. It is a mock memory database where you can remove the dependencies and isolate the code. When you create a brand-new test project, setting up FakeDb can be tricky."}),"\n",(0,n.jsx)(t.p,{children:"Installing FakeDb and adding the usual two Sitecore dll, Sitecore.Kernel.dll and Sitecore.Mvc.dll will not work. The best resources for getting FakeDb up and running for Sitecore 8.2 are:"}),"\n",(0,n.jsx)(t.p,{children:"FakeDb Installation\nSitecore 8.2 \u2013 No constructor found error\nThese documentations are great. But, what really helps us is the checklist that we can go through whenever we creates test projects that use FakeDb."}),"\n",(0,n.jsx)(t.p,{children:"FakeDb configuration checklist"}),"\n",(0,n.jsx)(t.p,{children:"When you set up a test project with FakeDb, ask yourself these questions. It will save time for troubleshooting."}),"\n",(0,n.jsx)(t.p,{children:"(1) Did you add references to the assemblies below?"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"Lucene.Net.dll\nSitecore.Analytics.dll\nSitecore.Kernel.dll\nSitecore.Logging.dll\nSitecore.Nexus.dll\n"})}),"\n",(0,n.jsx)(t.p,{children:"(2) Did you set the correct path to your license file in App.config (in the root of the test project)?"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-xml",children:'<sitecore>\n    <settings>\n      <setting name="LicenseFile" value="..\\..\\..\\libs\\license.xml" />\n    </settings>\n\t\u2026\n</sitecore>\n'})}),"\n",(0,n.jsx)(t.p,{children:"(3) For Sitecore 8.2 (or maybe 9 and above), did you add Sitecore.FakeDb.config in the App_Config/Include folder?"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-xml",children:'<?xml version="1.0" encoding="utf-8"?>\n<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/">\n  <sitecore>\n    <databases>\n      <database id="core">\n        <patch:attribute name="type">Sitecore.Data.DefaultDatabase, Sitecore.Kernel</patch:attribute>\n      </database>\n      <database id="master">\n        <patch:attribute name="type">Sitecore.Data.DefaultDatabase, Sitecore.Kernel</patch:attribute>\n      </database>\n      <database id="web">\n        <patch:attribute name="type">Sitecore.Data.DefaultDatabase, Sitecore.Kernel</patch:attribute>\n      </database>\n    </databases>\n    <eventing defaultProvider="sitecore">\n      <providers>\n        <clear />\n        <add name="sitecore" type="Sitecore.Eventing.EventProvider, Sitecore.Kernel" systemDatabaseName="core" />\n      </providers>\n    </eventing>\n  </sitecore>\n</configuration>\n'})}),"\n",(0,n.jsx)(t.p,{children:"Ok, If you have done all of the steps above, FakeDb should work. Just in case you forgot, these are the possible errors."}),"\n",(0,n.jsx)(t.p,{children:"Potential Errors"}),"\n",(0,n.jsx)(t.p,{children:"(1) Object reference set to null"}),"\n",(0,n.jsx)(t.p,{children:"When you try to instantiate FakeDb without the correct dependencies, you will get object reference set to null error with no helpful nested error message. Don\u2019t freak out. Just add the references."}),"\n",(0,n.jsx)(t.p,{children:"(2) License required error"}),"\n",(0,n.jsx)(t.p,{children:"FakeDb requires Sitecore license to run. This error may not be obvious. If your path to the license file is wrong, you get this error when the function calls Sitecore API like GetItem()."}),"\n",(0,n.jsx)(t.p,{children:"If you wrap the block where you are calling Sitecore API with a try-catch block, this error may not appear when you run unit test. Instead, your unit test will fail from the actual different from the expected. When you put a debugger, you will see it is failing at Sitecore API call and is being caught by the catch clause. Tricky, but easy to fix. Just correct the license path."}),"\n",(0,n.jsx)(t.p,{children:"(3) No matching constructor was found"}),"\n",(0,n.jsx)(t.p,{children:"You may get the error as below:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"Sitecore.Exceptions.ConfigurationException\n: Could not create instance of type\n: Sitecore.Data.Database. No matching constructor was found.\nTo fix this, you need to add the below config file in App_Config/Include/Sitecore.FakeDb.config as described here.\n"})}),"\n",(0,n.jsx)(t.p,{children:"The better option is to add this config file in Foundation.Testing project and refer it from all the test projects. This is exactly what Habitat does. You can actually see it has the FakeDb config file in the foundation project."}),"\n",(0,n.jsx)(t.p,{children:"I would like to hear from you if you still have trouble running FakeDb. I can probably help you!"}),"\n",(0,n.jsx)(t.p,{children:"(2019-08-17)"})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>i,x:()=>s});var n=o(96540);const r={},a=n.createContext(r);function i(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);