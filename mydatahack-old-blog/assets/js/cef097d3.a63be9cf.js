"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[4230],{38692:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var o=n(74848),i=n(28453);const s={sidebar_position:4},r="How to Deploy ASP.NET Core Application to Windows with IIS",a={id:"Web/DotNet/deploy-with-iis",title:"How to Deploy ASP.NET Core Application to Windows with IIS",description:"An ASP.NET Core application is hosted on Kestrel on both Windows and Linux. Kestrel is a web application server (just like Tomcat or NodeJS). It is included by default in ASP.NET Core project templates.",source:"@site/docs/Web/DotNet/4.deploy-with-iis.md",sourceDirName:"Web/DotNet",slug:"/Web/DotNet/deploy-with-iis",permalink:"/docs/Web/DotNet/deploy-with-iis",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Implementing Dependency Injection in ASP.NET Core",permalink:"/docs/Web/DotNet/dependency-injection"},next:{title:"Quickest Way to Enable CORS for ASP.NET Core Web API application",permalink:"/docs/Web/DotNet/enbale-cors"}},l={},d=[];function c(e){const t={a:"a",code:"code",h1:"h1",img:"img",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"how-to-deploy-aspnet-core-application-to-windows-with-iis",children:"How to Deploy ASP.NET Core Application to Windows with IIS"}),"\n",(0,o.jsx)(t.p,{children:"An ASP.NET Core application is hosted on Kestrel on both Windows and Linux. Kestrel is a web application server (just like Tomcat or NodeJS). It is included by default in ASP.NET Core project templates."}),"\n",(0,o.jsx)(t.p,{children:"Although ASP.NET Core application can run solely run on Kestrel, it is recommended to use it with a reverse proxy server. This is a typical web application pattern where the request first hits the reverse proxy server and then gets forwarded to the application server in the background. The popular examples of the reverse proxy servers are IIS, Nginx, or Apache."}),"\n",(0,o.jsx)(t.p,{children:"In a Window\u2019s environment, IIS is the one that forwards requests to Kestrel. In a Linux environment, we can configure Nginx as a reverse proxy and use Kestrel to run the application."}),"\n",(0,o.jsx)(t.p,{children:"The ASP.NET Core Module (ANCM) handles this request forwarding process management. You can see ANCM is configured in web.config file in the web root folder under handlers in system.webServer."}),"\n",(0,o.jsx)(t.p,{children:"Here is the simple diagram for ASP.NET core application hosting architecture."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"img",src:n(22161).A+"",width:"768",height:"526"})}),"\n",(0,o.jsx)(t.p,{children:"In this post, let\u2019s deploy an ASP.NET Core application to the local Window\u2019s IIS server. Deploying it to IIS is very simple on Window\u2019s machine."}),"\n",(0,o.jsx)(t.p,{children:"Summary Steps"}),"\n",(0,o.jsx)(t.p,{children:"Here are what you need to do."}),"\n",(0,o.jsx)(t.p,{children:"Enable IIS if it is not enabled already on your machine.\nInstall .NET Core Windows server hosting bundle.\nAdd website to IIS\nUpdate an app pool config\nPublish code to web root\nSteps"}),"\n",(0,o.jsx)(t.p,{children:"(1) Enable IIS"}),"\n",(0,o.jsx)(t.p,{children:"This step is often referred to as installing IIS. On the Windows machine, it is just ticking a few boxes."}),"\n",(0,o.jsx)(t.p,{children:"Go to Turn Windows features on or off and select IIS and IIS Management Console. See IIS configuration on this documentation for further details."}),"\n",(0,o.jsx)(t.p,{children:"(2) Install .NET Core Windows server hosting bundle"}),"\n",(0,o.jsx)(t.p,{children:"The package includes .NET Core runtime as well as the ASP.NET Core module for IIS. For .NET Core 2.2, go to this page to install Hosting Bundle."}),"\n",(0,o.jsx)(t.p,{children:"You need to make sure you have SDK for 2.2 and your app is on the same version as the hosting bundle. If the version is different, the app will not run."}),"\n",(0,o.jsx)(t.p,{children:"Once the bundle is installed, run iisreset to restart IIS."}),"\n",(0,o.jsx)(t.p,{children:"(3) Add Website to IIS"}),"\n",(0,o.jsx)(t.p,{children:"Open IIS Manager and add website. Physical path is the one where you want to publish your visual studio project. For now, we can leave IP address as All Unassigned with port 80. Host name can be a local host."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"img",src:n(62900).A+"",width:"756",height:"441"})}),"\n",(0,o.jsx)(t.p,{children:"(4) Configure App Pool option"}),"\n",(0,o.jsx)(t.p,{children:"Once the website is added, IIS also create a new app pool. For a dotnet core application, we need to modify the setting for this new app pool."}),"\n",(0,o.jsx)(t.p,{children:"As mentioned at the start, IIS is not running the app for ASP.NET Core. It is simply forwarding the request and running .NET code is handled by Kestrel. Therefore, you need to set .NET CLR version to No Managed Code."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"img",src:n(85911).A+"",width:"641",height:"426"})}),"\n",(0,o.jsx)(t.p,{children:"(5) Publish your app from Visual Studio"}),"\n",(0,o.jsxs)(t.p,{children:["Publishing your app from Visual Studio to the web root folder is all you need to do. Then, you can go to ",(0,o.jsx)(t.a,{href:"http://localhost:80",children:"http://localhost:80"}),". You will see your website."]}),"\n",(0,o.jsx)(t.p,{children:"Yay!"}),"\n",(0,o.jsx)(t.p,{children:"Wait\u2026"}),"\n",(0,o.jsx)(t.p,{children:"Here is more"}),"\n",(0,o.jsx)(t.p,{children:"(6) Create data protection registry key (optional)"}),"\n",(0,o.jsx)(t.p,{children:"Another thing you may need to consider is to set up data protection. ASP.NET Core uses the data protection API to encrypt and store keys for authentication in your app. When hosting app with IIS, you need to run a PowerShell script to create a registry hive for these keys. Otherwise, the key will be regenerated when you restart your app. It will invalidate any user sessions or cookies that were encrypted with the previous key."}),"\n",(0,o.jsx)(t.p,{children:"The script is a GitHub repo, which is linked from the Create Data Protection Registry Keys section in the official documentation. You can run the script with the name of the script with the name of the website you created as an argument. It will set everything up for you."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:".\\Provision-AutoGenKeys.ps1 NameOfMyWebsite\n"})}),"\n",(0,o.jsx)(t.p,{children:"Additional Tips"}),"\n",(0,o.jsx)(t.p,{children:"Publishing with PowerShell Command"}),"\n",(0,o.jsx)(t.p,{children:"It is nice to know how to use commands to publish an application for automation. First go to the project directory. Once you run the publish command, you will see all the binaries are build in the bin/Release folder. This can be moved to the web root folder for deployment."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"# restore the packages\ndotnet restore\n\n# check if it builds\u2026\ndotnet build\n\n# build application to bin/Release folder.\ndotnet publish -c Release\n"})}),"\n",(0,o.jsx)(t.p,{children:"What is Web.config file for?"}),"\n",(0,o.jsx)(t.p,{children:"ASP.NET Core does not use Web.config. It was used in the older versions. .NET Core now uses a new configuration model based on appsettings.json. However, the file is still needed because it is used for IIS to configure ASP.NET Core module. Otherwise, IIS cannot forwards the request correctly to Kestrel."}),"\n",(0,o.jsx)(t.p,{children:"When you publish your app, Web.config is generated automatically in the web root folder. You do not need to touch it."}),"\n",(0,o.jsx)(t.p,{children:"(2019-11-24)"})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},22161:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/img-1-f75bc4e7d97bb50effce6809b9a66389.webp"},62900:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/img-2-df2c88560de18017d218c78157162596.webp"},85911:(e,t,n)=>{n.d(t,{A:()=>o});const o=n.p+"assets/images/img-3-a9bcb2ead618efb3d1325fdb0a7787eb.webp"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var o=n(96540);const i={},s=o.createContext(i);function r(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);