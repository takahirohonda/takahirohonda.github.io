"use strict";(self.webpackChunkmydatahack_blog_site=self.webpackChunkmydatahack_blog_site||[]).push([[7801],{46519:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var a=n(74848),o=n(28453);const s={sidebar_position:23},r="How To Get Data From Liveperson And Create Aggregated Table With R",i={id:"data-ingestion/liveperson-data-r",title:"How To Get Data From Liveperson And Create Aggregated Table With R",description:"In the previous post, we discussed how to ingest data from Liveperson with Python. In this post, I want to use R to make the same API call and create an aggregated table instead of preparing data for ingestion. The code is based on the example here. For further information on Liveperson API, you can have a look here.",source:"@site/docs/data-ingestion/23.liveperson-data-r.md",sourceDirName:"data-ingestion",slug:"/data-ingestion/liveperson-data-r",permalink:"/mydatahack-old-blog/mydatahack-old-blog/data-ingestion/liveperson-data-r",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:23,frontMatter:{sidebar_position:23},sidebar:"tutorialSidebar",previous:{title:"How To Get Data From MongoDB With Python",permalink:"/mydatahack-old-blog/mydatahack-old-blog/data-ingestion/monog-python"},next:{title:"How To Ingest Data From Liveperson With Python",permalink:"/mydatahack-old-blog/mydatahack-old-blog/data-ingestion/liveperson-python"}},d={},c=[];function l(e){const t={a:"a",code:"code",h1:"h1",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"how-to-get-data-from-liveperson-and-create-aggregated-table-with-r",children:"How To Get Data From Liveperson And Create Aggregated Table With R"}),"\n",(0,a.jsx)(t.p,{children:"In the previous post, we discussed how to ingest data from Liveperson with Python. In this post, I want to use R to make the same API call and create an aggregated table instead of preparing data for ingestion. The code is based on the example here. For further information on Liveperson API, you can have a look here."}),"\n",(0,a.jsx)(t.p,{children:"Making a REST call with R is as easy as Python. The httr package makes REST call easy like the requests module in Python. The jsonlite package makes it easy for transforming json into data frame."}),"\n",(0,a.jsx)(t.p,{children:"Once you have a data frame, you can use a bunch of amazing packages to do transformation, aggregation, statistics, machine learning and so on with a few lines of code. This is what I love about R."}),"\n",(0,a.jsx)(t.p,{children:"In this example, I used the dplyr package to aggregate the total number of interactive chats per agent during the specified period of time. The output looks like this."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(27939).A+"",children:"data"})}),"\n",(0,a.jsx)(t.p,{children:"The key points in this program are the same as the previous post. You need to loop the REST call because the max record number is 100. You also need to convert to epoch time."}),"\n",(0,a.jsx)(t.p,{children:"Now feel the power of R programming!"}),"\n",(0,a.jsx)(t.p,{children:"Code"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-R",children:'library(httr)\nlibrary(jsonlite)\nlibrary(dplyr)\n\ngetLPData <- function(start, end){\n\n  # Convert date into epoch time in milliseconds\n  start <- as.numeric(as.POSIXct(start)) * 1000\n  end <- as.numeric(as.POSIXct(end)) * 1000\n\n  # Define header values\n  key <- \'<api key>\'\n  secret <- \'<api secret>\'\n  tokenURL <- \'null\'\n  accessTokenURL <- \'null\'\n  authorizeURL <- \'null\'\n\n  app <- oauth_app(\'LP\',key,secret)\n\n  sig <- sign_oauth1.0(app,\n                       token="<token>",\n                       token_secret="<token secret>")\n\n  body <- sprintf(\'{"start":{"from":%s,"to":%s}}\', start, end)\n\n  row_count <- 100\n  offset <- 0\n  combined <- data.frame()\n\n  while (row_count == 100){\n    url_string <- sprintf("https://sy.enghist.liveperson.net/interaction_history/api/account/<account number>/\\\n   interactions/search?offset=%s&limit=100", offset)\n    postRequest <- POST(url_string,sig, body = body,add_headers("Content-Type"="application/json"))\n    chatRecords <- content(postRequest,"parsed")\n    json <- httr::content(postRequest, as = "text")\n    data <- fromJSON(json)\n    df <- as.data.frame(data$interactionHistoryRecords$info)\n    df <- df[, c("agentFullName", "agentLoginName", "duration", "ended",\n                 "endReason", "endReasonDesc", "startTime", "endTime",\n                 "interactive", "visitorName", "engagementId")]\n    row_count = nrow(df)\n    offset = offset + 100\n\n    combined <- rbind(combined, df)\n\n  } # End of while loop\n  combined$startLocal <- format(as.POSIXct(substr(combined$startTime, 1, 19), tz = "GMT"), tz="Australia/Sydney")\n  combined$endLocal <- format(as.POSIXct(substr(combined$endTime, 1, 19), tz = "GMT"), tz="Australia/Sydney")\n  combined\n\n} # End of function\n\ndata <- getLPData(\'<start date e.g. 2017-11-01>\', \'<end date e.g. 2017-11-02>\')\n\n# Select interactive chat and aggregate per agent\ndata$count <- ifelse(data$interactive=="TRUE", 1, 0)\npivot <- data %>% group_by(agentFullName) %>% summarise(chatNumber=sum(count))\nprint(pivot)\n'})}),"\n",(0,a.jsx)(t.p,{children:"(2017-11-18)"})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},27939:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/files/output-example-3734e97b6457e8fcc783058ba6e5f1d0.webp"},28453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>i});var a=n(96540);const o={},s=a.createContext(o);function r(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);